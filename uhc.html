<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
    <title>UHC Premium - Umrah & Hac Companion</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#5D5CDE">
    <meta name="msapplication-TileColor" content="#5D5CDE">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="UHC Premium">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="UHC Premium">
    
    <!-- SEO & Social Meta Tags -->
    <meta name="description" content="Umrah ve Hac yolculuğunuzun dijital rehberi. Kıble pusulası, namaz vakitleri, tespih, manasik rehberi ve premium tur hizmetleri.">
    <meta name="keywords" content="umrah, hac, kıble, namaz vakitleri, tespih, manasik, rehber, premium">
    <meta name="author" content="UHC Premium">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Turkish">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://uhc-premium.com">
    <meta property="og:title" content="UHC Premium - Umrah & Hac Companion">
    <meta property="og:description" content="Manevi yolculuğunuzun en iyi dijital rehberi. Premium özellikler ile Umrah ve Hac deneyiminizi destekleyin.">
    <meta property="og:image" content="https://uhc-premium.com/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="UHC Premium">
    <meta property="og:locale" content="tr_TR">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://uhc-premium.com">
    <meta property="twitter:title" content="UHC Premium - Umrah & Hac Companion">
    <meta property="twitter:description" content="Manevi yolculuğunuzun en iyi dijital rehberi. Premium özellikler ile Umrah ve Hac deneyiminizi destekleyin.">
    <meta property="twitter:image" content="https://uhc-premium.com/twitter-image.jpg">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="60x60" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="72x72" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="76x76" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="114x114" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="120x120" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="144x144" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="152x152" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM1RDVDREUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM5MzU1RjYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0idXJsKCNhKSIgcng9IjEyOCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAwIiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7YpTwvdGV4dD48L3N2Zz4=">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlVIQyBQcmVtaXVtIC0gVW1yYWggJiBIYWMgQ29tcGFuaW9uIiwKICAic2hvcnRfbmFtZSI6ICJVSEMgUHJlbWl1bSIsCiAgImRlc2NyaXB0aW9uIjogIlVtcmFoIHZlIEhhYyB5b2xjdWx1xJ91bnV6dW4gZGlqaXRhbCByZWhiZXJpLiBLxLFibGUgcHVzdWxhc8SxLCBuYW1heiB2YWtpdGxlcmksIHRlc3BpaCwgbWFuYXNpayByZWhiZXJpIHZlIHByZW1pdW0gdHVyIGhpem1ldGxlcmkuIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBhMGUxNCIsCiAgInRoZW1lX2NvbG9yIjogIiM1RDVDREUiLAogICJjYXRlZ29yaWVzIjogWyJsaWZlc3R5bGUiLCAiZWR1Y2F0aW9uIiwgInJlbGlnaW9uIiwgInRyYXZlbCJdLAogICJsYW5nIjogInRyIiwKICAiZGlyIjogImx0ciIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owdWFIUjBjRG92TDJRM1pIY3Vkek11YjNKbkx6SXdNREF2YzNabklpQjJhV1YzUW05NGVUMHVNQ0F4TURJNExnM3dNakJOTVNBMU1URWFSazEzZFdocGREb2lOVEU0SU1RNUREPSIsCiAgICAgICJzaXplcyI6ICI3Mng3MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owdWFIUjBjRG92TDJRM1pIY3VkM010YjNKbUx6SXdNRWd1YzNabklpQjJhV1YzUW05NGVUMHVNQ0F5TlRZdWQzUDNuZElTMXdNekZOTVNBMU1USTlFRT0iLAogICAgICAic2l6ZXMiOiAiOTZ4OTYiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0YldsdWN6MHVhSFIwY0RvdkwyUTNaSGN1ZURNdWIzSm5Mekl3TURBdmMzWm5JaUI5YVdWM1FtOTRlVDBpTUNBeE5UWXlNUzN3TWpaTU9VSTBPVEc5IiwKICAgICAgInNpemVzIjogIjEyOHgxMjgiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0YldsdWN6MGlhSFIwY0RvdkwyUTNaSGN1ZERNdWIzSm5Mekl3TURBdmMzWm5JaUI5YVdWM1FtOTRlVDBpTUNBeE5UWXlNUzN3TWpFME1RPSIsCiAgICAgICJzaXplcyI6ICIxNDR4MTQ0IiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM1I3WEhZdWQzMXViM0puTHpJd01EQXZjM1puSWlCOWFXVjNRbT45ZVQwaU1DQXlObVl5UVRFM01RPT0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owdWFIUjBjRG92TDJpd1pIY3VkM011YjNKbkx6SXdNREF2YzNabklpQjlhV1YzUW05NGVUMGlNQ0F5TlRZdWQzUHZmaWd3TWo2Mk1RPT0iLAogICAgICAic2l6ZXMiOiAiMjU2eDI1NiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owdWFIUjBjRG92TDNSMUxXN3Vkemc1VGpndFRYQXVkM011YjNKbkx6SXdNREF2YzNabklpQjlhV1YzUW05NGVUMGlNQ0EyUVRJdWQzVDFOa3d3TXpZNU1RPT0iLAogICAgICAic2l6ZXMiOiAiMzg0eDM4NCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owdWFIUjBjRG92TDJkellyNzBaMjh2Y1c1M1oyNWJMekl3TURBdmMzWm5JaUI5YVdWM1FtOTRlVDBpTUNBeE1UazBNUTN3NVRNPSIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdLAogICJzY3JlZW5zaG90cyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0YldsdWN6MGlhSFIwY0RvdkwyUTNaSGN1ZERNdWIzSm5Mekl3TURBdmMzWm5JaUI5YVdWM1FtOTRlVDBpTUNBeU5tWXlRVEUzTVE9PSIsCiAgICAgICJzaXplcyI6ICIzMjB4NjQwIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJmb3JtX2ZhY3RvciI6ICJuYXJyb3ciCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owdWFIUjBjRG92TDJpd1pIY3VkM011YjNKbkx6SXdNREF2YzNabklpQjlhV1YzUW05NGVUMGlNQ0F5TlRZdWQzUHZmaWd3TWo2Mk1RPT0iLAogICAgICAic2l6ZXMiOiAiNTQweDcyMCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAiZm9ybV9mYWN0b3IiOiAibmFycm93IgogICAgfQogIF0sCiAgInNob3J0Y3V0cyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiS8SxYmxlIFB1c3VsYXPEsSIsCiAgICAgICJzaG9ydF9uYW1lIjogIEvEsWJsZSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJIYXNzYXMga8SxYmxlIHB1c3VsYXPEsSBpbGUgS2FiZSBuaW1pcnVudSBidWx1biIsCiAgICAgICJ1cmwiOiAiLyNxaWJsYSIsCiAgICAgICJpY29ucyI6IFt7InNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0YldsdWN6MGlhSFIwY0RvdkwyUTNaSGN1ZERNdWIzSm5Mekl3TURBdmMzWm5JaUI5YVdWM1FtOTRlVDBpTUNBeE5UWXlNUzN3TWpaTU9VSTBPVEc5Iiwic2l6ZXMiOiI5Nng5NiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJEaWppdGFsIFRlc3BpaCIsCiAgICAgICJzaG9ydF9uYW1lIjogIlRlc3BpaCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEb2t1bmFyYWsgemlja2lyIHlhcMSxbiwgaWxlcmxlbWVuaXppIHRha2lwIGVkaW4iLAogICAgICAidXJsIjogIi8jdGVzcGloIiwKICAgICAgImljb25zIjogW3sic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owdWFIUjBjRG92TDJRM1pIY3VkM011YjNKbkx6SXdNREF2YzNabklpQjlhV1YzUW05NGVUMGlNQ0F5TlRZdWQzUHZmaWd3TWo2Mk1RPT0iLCJzaXplcyI6Ijk2eDk2IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV0KICAgIH0KICBdCn0=">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://api.aladhan.com">
    <link rel="preconnect" href="https://api.openweathermap.org">
    
    <!-- Optimized font loading -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
      /* Critical CSS - Above the fold */
      :root{
        --bg:#0a0e14;--bg2:#101621;--bg3:#0e1521;--tx:#f5f7fb;--tx2:#aab1bd;
        --gold:#c9a86a;--acc:linear-gradient(135deg,#e8c36a,#c9a86a);--border:#2a3441;
        --card:#171d2a;--card2:#1c2333;--r:16px;--qibla:#4ade80;--mosque:#3b82f6;
        --tour:#f97316;--market:#8b5cf6;--dua:#1e40af;--social:#ec4899;
        --hotel:#92400e;--friends:#dc2626;--tespih:#10b981;--namaz:#7c3aed;
        --shadow:0 4px 12px rgba(0,0,0,.15);--transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      }
      
      *{box-sizing:border-box;margin:0;padding:0}
      
      html,body{height:100%;font-family:Inter,system-ui,-apple-system,sans-serif}
      
      body{
        background:radial-gradient(1100px 520px at 50% -10%,rgba(232,195,106,.08),transparent 70%),var(--bg);
        color:var(--tx);display:flex;align-items:center;justify-content:center;
        min-height:100vh;min-height:100svh;overflow:hidden;font-size:13px;line-height:1.4;
        -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
        margin:0;padding:0;position:fixed;inset:0;
      }
      
      /* Enhanced phone container with better mobile support */
      .phone{
        width:min(400px,100vw);height:100vh;
        background:var(--bg2);border:1px solid var(--border);
        border-radius:28px;overflow:hidden;position:relative;
        box-shadow:0 25px 80px rgba(0,0,0,.4),0 8px 32px rgba(0,0,0,.2);
        backdrop-filter:blur(20px);
      }
      
      /* Optimized header */
      .header{
        height:50px;display:flex;align-items:center;justify-content:space-between;
        padding:0 12px;border-bottom:1px solid var(--border);
        background:rgba(16,22,33,.9);backdrop-filter:blur(20px);
        position:sticky;top:0;z-index:100;
      }
      
      .header .brand{
        display:flex;align-items:center;gap:10px;font-weight:800;
        font-size:16px;
      }
      .header .brand i{color:var(--gold);font-size:18px}
      
      /* Enhanced buttons with better feedback */
      .btn{
        display:inline-flex;align-items:center;gap:8px;justify-content:center;
        min-height:44px;padding:12px 16px;border-radius:12px;
        border:1px solid var(--border);background:var(--card2);
        color:var(--tx);cursor:pointer;transition:var(--transition);
        font-weight:600;text-decoration:none;user-select:none;
        position:relative;overflow:hidden;
      }
      
      .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
      .btn:active{transform:translateY(0);transition:transform 0.1s}
      
      .btn.primary{
        background:var(--acc);color:#0a0e14;border:none;
        box-shadow:0 4px 16px rgba(232,195,106,.3);
      }
      .btn.primary:hover{box-shadow:0 6px 20px rgba(232,195,106,.4)}
      
      /* Improved navigation */
      .content{
        position:absolute;inset:60px 0 86px 0;overflow:hidden;
      }
      
      .view{
        position:absolute;inset:0;padding:16px;overflow:auto;
        opacity:0;transform:translateY(12px);visibility:hidden;
        transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
        scroll-behavior:smooth;
      }
      
      .view.active{
        opacity:1;transform:translateY(0);visibility:visible;
      }
      
      /* Enhanced cards with glassmorphism */
      .card{
        background:linear-gradient(135deg,rgba(23,29,42,.8),rgba(16,22,33,.9));
        backdrop-filter:blur(10px);border:1px solid var(--border);
        border-radius:var(--r);padding:16px;margin-bottom:16px;
        box-shadow:var(--shadow);transition:var(--transition);
      }
      
      .card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.2)}
      
      /* Enhanced grid system */
      .grid{display:grid;gap:12px}
      .g2{grid-template-columns:repeat(2,1fr)}
      .g3{grid-template-columns:repeat(3,1fr)}
      .g4{grid-template-columns:repeat(4,1fr)}
      
      /* Improved form inputs */
      .input{
        width:100%;padding:12px 16px;border-radius:12px;
        border:1px solid var(--border);background:var(--card2);
        color:var(--tx);font-size:16px;transition:var(--transition);
        outline:none;
      }
      
      .input:focus{
        border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,168,106,.1);
      }
      
      /* Premium Modern Navigation */
      .tabs{
        position:absolute;left:8px;right:8px;bottom:8px;height:80px;
        background:linear-gradient(135deg,rgba(23,29,42,.98),rgba(16,22,33,.95));
        backdrop-filter:blur(28px);border:1px solid rgba(201,168,106,.2);
        border-radius:28px;display:flex;align-items:center;justify-content:space-evenly;
        padding:6px;box-shadow:0 12px 40px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.1);
        overflow:hidden;
      }
      
      .tabs::before{
        content:'';position:absolute;inset:0;border-radius:28px;
        background:linear-gradient(45deg,transparent,rgba(201,168,106,.05),transparent);
        pointer-events:none;
      }
      
      .tab{
        position:relative;display:flex;flex-direction:column;
        align-items:center;justify-content:center;gap:2px;
        padding:8px 6px;cursor:pointer;color:var(--tx2);
        transition:all 0.4s cubic-bezier(0.23,1,0.32,1);
        border-radius:18px;flex:1;max-width:55px;min-height:60px;
        background:transparent;border:none;overflow:hidden;
      }
      
      .tab::before{
        content:'';position:absolute;inset:2px;border-radius:18px;
        background:transparent;transition:all 0.4s ease;opacity:0;
        transform:scale(0.8);
      }
      
      .tab i{
        font-size:20px;transition:all 0.4s cubic-bezier(0.23,1,0.32,1);
        margin-bottom:1px;position:relative;z-index:2;
      }
      
      .tab .tab-label{
        font-size:9px;font-weight:700;letter-spacing:0.3px;
        transition:color 0.3s ease;
        white-space:nowrap;position:relative;z-index:2;
        opacity:1;visibility:visible;
      }
      
      .tab:hover{
        color:var(--tx);
      }
      
      .tab:hover::before{
        opacity:1;transform:scale(1);
        background:rgba(255,255,255,.05);
      }
      
      .tab:hover i{
        transform:translateY(-1px) scale(1.05);
      }
      
      .tab.active{
        color:var(--gold);
      }
      
      .tab.active::before{
        opacity:1;transform:scale(1);
        background:linear-gradient(135deg,rgba(201,168,106,.25),rgba(232,195,106,.15));
        box-shadow:0 4px 12px rgba(201,168,106,.3),inset 0 1px 0 rgba(255,255,255,.2);
      }
      
      .tab.active i{
        transform:translateY(-2px) scale(1.1);
        text-shadow:0 2px 8px rgba(201,168,106,.4);
      }
      
      .tab.active .tab-label{
        font-weight:800;
        text-shadow:0 1px 2px rgba(0,0,0,.3);
      }
      
      /* Tab specific colors */
      .tab.home.active{color:#4ade80}
      .tab.home.active::before{background:linear-gradient(135deg,rgba(74,222,128,.25),rgba(34,197,94,.15))}
      .tab.home.active i{text-shadow:0 2px 8px rgba(74,222,128,.4)}
      
      .tab.tespih.active{color:#10b981}
      .tab.tespih.active::before{background:linear-gradient(135deg,rgba(16,185,129,.25),rgba(5,150,105,.15))}
      .tab.tespih.active i{text-shadow:0 2px 8px rgba(16,185,129,.4)}
      
      .tab.qibla.active{color:#3b82f6}
      .tab.qibla.active::before{background:linear-gradient(135deg,rgba(59,130,246,.25),rgba(37,99,235,.15))}
      .tab.qibla.active i{text-shadow:0 2px 8px rgba(59,130,246,.4)}
      
      .tab.market.active{color:#8b5cf6}
      .tab.market.active::before{background:linear-gradient(135deg,rgba(139,92,246,.25),rgba(124,58,237,.15))}
      .tab.market.active i{text-shadow:0 2px 8px rgba(139,92,246,.4)}
      
      .tab.tours.active{color:#f97316}
      .tab.tours.active::before{background:linear-gradient(135deg,rgba(249,115,22,.25),rgba(234,88,12,.15))}
      .tab.tours.active i{text-shadow:0 2px 8px rgba(249,115,22,.4)}
      
      .tab.social.active{color:#ec4899}
      .tab.social.active::before{background:linear-gradient(135deg,rgba(236,72,153,.25),rgba(219,39,119,.15))}
      .tab.social.active i{text-shadow:0 2px 8px rgba(236,72,153,.4)}
      
      .tab.profile.active{color:#c9a86a}
      .tab.profile.active::before{background:linear-gradient(135deg,rgba(201,168,106,.25),rgba(232,195,106,.15))}
      .tab.profile.active i{text-shadow:0 2px 8px rgba(201,168,106,.4)}
      
      /* Loading states */
      .loading{
        display:inline-flex;align-items:center;gap:8px;
        color:var(--tx2);font-size:14px;
      }
      
      .spinner{
        width:16px;height:16px;border:2px solid var(--border);
        border-top:2px solid var(--gold);border-radius:50%;
        animation:spin 1s linear infinite;
      }
      
      @keyframes spin{to{transform:rotate(360deg)}}
      
      /* Enhanced prayer times */
      .prayer-times-grid{
        display:grid;grid-template-columns:repeat(3,1fr);gap:8px;
        margin:12px 0;
      }
      
      .prayer-time-card{
        display:flex;flex-direction:column;align-items:center;gap:6px;
        padding:12px 8px;border:1px solid var(--border);
        border-radius:12px;background:var(--card2);
        transition:var(--transition);position:relative;
      }
      
      .prayer-time-card.active{
        background:rgba(124,58,237,.15);border-color:var(--namaz);
        transform:scale(1.05);box-shadow:0 4px 12px rgba(124,58,237,.2);
      }
      
      .prayer-time-card.next{
        background:rgba(201,168,106,.1);border-color:var(--gold);
      }
      
      /* Enhanced tespih counter */
      .tespih-container{
        display:flex;flex-direction:column;align-items:center;
        margin:20px 0;
      }
      
      .tespih-counter{
        position:relative;width:280px;height:280px;border-radius:50%;
        background:radial-gradient(circle at 30% 30%, rgba(23,29,42,.9), rgba(14,21,33,.9));
        border:3px solid var(--border);display:flex;align-items:center;
        justify-content:center;cursor:pointer;transition:var(--transition);
        user-select:none;box-shadow:inset 0 4px 12px rgba(0,0,0,.3),
        0 8px 32px rgba(0,0,0,.2);
      }
      
      .tespih-counter:hover{transform:scale(1.02)}
      .tespih-counter:active{transform:scale(0.98)}
      
      .count-display{
        font-size:48px;font-weight:800;color:var(--tespih);
        text-shadow:0 2px 8px rgba(16,185,129,.3);
      }
      
      /* Enhanced compass */
      .compass-container{
        display:flex;flex-direction:column;align-items:center;
        margin:20px 0;
      }
      
      .compass-ring{
        position:relative;width:300px;height:300px;border-radius:50%;
        background:radial-gradient(circle at 30% 30%, rgba(23,29,42,.9), rgba(14,21,33,.9));
        border:3px solid var(--border);transition:var(--transition);
        box-shadow:inset 0 4px 12px rgba(0,0,0,.3), 0 12px 40px rgba(0,0,0,.3);
      }
      
      /* Responsive design improvements */
      @media(max-width:480px){
        .phone{width:100vw;height:100vh;border-radius:0;border:none;max-height:100vh}
        .compass-ring,.tespih-counter{width:260px;height:260px}
        .prayer-times-grid{grid-template-columns:repeat(2,1fr)}
        .tabs{height:70px;padding:6px}
        .tab{min-width:45px;max-width:55px;padding:6px 4px}
        .tab i{font-size:18px}
        .tab .tab-label{font-size:8px}
        .content{inset:60px 0 76px 0}
        .header{height:55px;padding:0 12px}
        .header .brand{font-size:15px}
        .view{padding:12px}
        .card{padding:14px;margin-bottom:14px}
      }
      
      /* Accessibility improvements */
      @media(prefers-reduced-motion:reduce){
        *,::before,::after{
          animation-duration:0.01ms !important;
          animation-iteration-count:1 !important;
          transition-duration:0.01ms !important;
        }
      }
      
      .sr-only{
        position:absolute;width:1px;height:1px;padding:0;margin:-1px;
        overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
      }
      
      /* Focus indicators */
      .btn:focus-visible,.input:focus-visible,.tab:focus-visible{
        outline:2px solid var(--gold);outline-offset:2px;
      }
      
      /* Toast notifications */
      .toast{
        position:fixed;top:80px;left:50%;transform:translateX(-50%);
        background:rgba(23,29,42,.95);backdrop-filter:blur(20px);
        border:1px solid var(--border);padding:12px 20px;
        border-radius:12px;z-index:2000;max-width:320px;
        text-align:center;color:var(--tx);font-weight:600;
        box-shadow:0 8px 32px rgba(0,0,0,.3);
        animation:slideInDown 0.3s ease-out;
      }
      
      @keyframes slideInDown{
        from{opacity:0;transform:translate(-50%,-20px)}
        to{opacity:1;transform:translate(-50%,0)}
      }
      
      /* Enhanced modal */
      .modal{
        position:fixed;inset:0;display:none;align-items:center;
        justify-content:center;background:rgba(0,0,0,.8);
        backdrop-filter:blur(10px);z-index:1000;padding:20px;
      }
      
      .modal.show{display:flex}
      
      .modal-content{
        width:100%;max-width:450px;
        background:linear-gradient(135deg,rgba(23,29,42,.95),rgba(16,22,33,.95));
        backdrop-filter:blur(20px);border:1px solid var(--border);
        border-radius:20px;padding:24px;max-height:90vh;overflow-y:auto;
        box-shadow:0 20px 60px rgba(0,0,0,.5);
        animation:modalSlideIn 0.3s ease-out;
      }
      
      @keyframes modalSlideIn{
        from{opacity:0;transform:scale(0.9) translateY(20px)}
        to{opacity:1;transform:scale(1) translateY(0)}
      }
    </style>
</head>
<body>
    <div class="phone">
        <header class="header">
            <div class="brand">
                <i class="fa-solid fa-kaaba" aria-hidden="true"></i> 
                <span>UHC Premium</span>
            </div>
            <nav style="display:flex;gap:8px;align-items:center" role="navigation">
                <button class="btn" onclick="socialActions.openWhatsApp('🕌 Merhaba! Destek almak istiyorum.')" 
                        style="padding:8px;min-height:40px" aria-label="WhatsApp Desteği">
                    <i class="fab fa-whatsapp" style="color:#25D366" aria-hidden="true"></i>
                </button>
                <button class="btn" onclick="socialActions.openInstagram()" 
                        style="padding:8px;min-height:40px" aria-label="Instagram">
                    <i class="fab fa-instagram" style="color:#E4405F" aria-hidden="true"></i>
                </button>
                <button class="btn" onclick="locationService.requestLocation()" aria-label="Konum Al">📍</button>
                <div class="lang-selector">
                    <button class="btn" onclick="languageManager.toggleMenu()" id="langBtn" aria-label="Dil Seçimi">
                        <span id="currentLangFlag">🇹🇷</span>
                    </button>
                    <div id="langMenu" class="lang-menu" style="display:none" role="menu">
                        <div class="lang-option" onclick="languageManager.setLanguage('tr')" role="menuitem">🇹🇷 Türkçe</div>
                        <div class="lang-option" onclick="languageManager.setLanguage('en')" role="menuitem">🇺🇸 English</div>
                        <div class="lang-option" onclick="languageManager.setLanguage('ar')" role="menuitem">🇸🇦 العربية</div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="content">
            <!-- AUTH VIEW -->
            <section id="auth" class="view" role="main">
                <div class="card" style="background:linear-gradient(135deg,rgba(201,168,106,.1),rgba(232,195,106,.05));border:1px solid rgba(201,168,106,.3)">
                    <div style="text-align:center;margin-bottom:20px">
                        <div style="font-size:48px;margin-bottom:12px">🕌</div>
                        <h1 style="margin:0 0 8px;font-size:24px;color:var(--gold)">Umrah & Hac Companion</h1>
                        <p style="margin:0;color:var(--tx2)">Premium manevi yolculuğunuz başlasın</p>
                    </div>
                    
                    <div class="grid g2" style="margin-bottom:12px">
                        <button class="btn primary" onclick="authManager.auth('google')" aria-label="Google ile giriş">
                            <i class="fab fa-google" aria-hidden="true"></i> Google
                        </button>
                        <button class="btn primary" onclick="authManager.auth('apple')" aria-label="Apple ile giriş">
                            <i class="fab fa-apple" aria-hidden="true"></i> Apple
                        </button>
                    </div>
                    <div class="grid g2">
                        <button class="btn" onclick="authManager.showEmailAuth()" aria-label="Email ile giriş">
                            <i class="fa-solid fa-envelope" aria-hidden="true"></i> E-posta
                        </button>
                        <button class="btn" onclick="authManager.auth('guest')" aria-label="Misafir girişi">
                            <i class="fa-solid fa-user" aria-hidden="true"></i> Misafir
                        </button>
                    </div>
                </div>
            </section>

            <!-- HOME VIEW -->
            <section id="home" class="view active" role="main">
                <!-- Hac Rehberi Kartı -->
                <div class="card" style="background:linear-gradient(135deg,rgba(249,115,22,.1),rgba(251,146,60,.05));border:1px solid rgba(249,115,22,.3)">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(249,115,22,.2);color:var(--tour);border:1px solid var(--tour);padding:8px 12px;border-radius:20px;font-weight:700">
                            <i class="fa-solid fa-mosque" aria-hidden="true"></i> Hac Rehberi
                        </div>
                        <div style="background:var(--tour);color:#fff;font-size:12px;padding:4px 8px;border-radius:12px;font-weight:700">14 ADIM</div>
                    </div>
                    
                    <h3 style="margin:0 0 8px;color:var(--tour);font-size:18px">Büyük Hac Menasiki</h3>
                    <p style="color:var(--tx2);margin:0 0 12px;font-size:14px">İslam'ın beş şartından biri olan hac ibadeti için eksiksiz rehber</p>
                    
                    <div style="margin-bottom:16px">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
                            <div style="font-size:13px;line-height:1.6">
                                📋 Hac Hazırlığı<br>
                                🕌 İhram & Mikat<br>
                                🏃‍♂️ Tavaf-ı Kudûm<br>
                                🏔️ Sa'y (Safa-Merve)<br>
                                🌙 Mina'ya Çıkış<br>
                                ⛰️ Arafat Vakfesi<br>
                                🌌 Müzdelife Konaklaması
                            </div>
                            <div style="font-size:13px;line-height:1.6">
                                🪨 Cemre Atma (3 gün)<br>
                                🐑 Kurban & Tıraş<br>
                                🕌 Tavaf-ı Ziyaret<br>
                                🏃‍♂️ Sa'y-ı Ziyaret<br>
                                🏨 Mina'da Konaklama<br>
                                🕌 Tavaf-ı Vedâ<br>
                                ✈️ Medine Ziyareti
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="contentManager.openManasikGuide('hac')" style="background:var(--tour);color:#fff;border:none;width:100%;min-height:48px;font-weight:700">
                        <i class="fa-solid fa-book-open" aria-hidden="true"></i> Hac Rehberini Başlat
                    </button>
                </div>

                <!-- Umre Rehberi Kartı -->
                <div class="card" style="background:linear-gradient(135deg,rgba(201,168,106,.1),rgba(232,195,106,.05));border:1px solid rgba(201,168,106,.3)">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(201,168,106,.2);color:var(--gold);border:1px solid var(--gold);padding:8px 12px;border-radius:20px;font-weight:700">
                            <i class="fa-solid fa-kaaba" aria-hidden="true"></i> Umre Rehberi
                        </div>
                        <div style="background:var(--gold);color:#000;font-size:12px;padding:4px 8px;border-radius:12px;font-weight:700">10 ADIM</div>
                    </div>
                    
                    <h3 style="margin:0 0 8px;color:var(--gold);font-size:18px">Küçük Hac Menasiki</h3>
                    <p style="color:var(--tx2);margin:0 0 12px;font-size:14px">Yılın her zamanında yapılabilir, sünnet olan umre ibadeti rehberi</p>
                    
                    <div style="margin-bottom:16px">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
                            <div style="font-size:13px;line-height:1.6">
                                📚 Umre Hazırlığı<br>
                                🕌 Mikat & İhram<br>
                                🏃‍♂️ Harem'e Giriş<br>
                                🕌 Tavaf (7 şavt)<br>
                                🤲 Makam-ı İbrahim Duası
                            </div>
                            <div style="font-size:13px;line-height:1.6">
                                🏔️ Sa'y (Safa-Merve)<br>
                                ✂️ Tıraş/Kısaltma<br>
                                🕌 Tavaf-ı Vedâ<br>
                                🏨 Medine Ziyareti<br>
                                ✅ Umre Tamamlama
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="contentManager.openManasikGuide('umrah')" style="background:var(--gold);color:#000;border:none;width:100%;min-height:48px;font-weight:700">
                        <i class="fa-solid fa-book-open" aria-hidden="true"></i> Umre Rehberini Başlat
                    </button>
                </div>

                <!-- Canlı Kabe & Medine Yayınları -->
                <div class="card" style="background:linear-gradient(135deg,rgba(201,168,106,.15),rgba(232,195,106,.08));border:1px solid rgba(201,168,106,.3)">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                        <div class="badge" style="background:rgba(220,38,38,.15);color:#dc2626;border:1px solid #dc2626">
                            <i class="fa-solid fa-broadcast-tower" aria-hidden="true"></i> Canlı Yayınlar
                        </div>
                        <div style="display:flex;align-items:center;gap:6px">
                            <div style="width:8px;height:8px;border-radius:50%;background:#dc2626;animation:pulse 2s infinite"></div>
                            <span style="color:#dc2626;font-weight:700;font-size:12px">CANLI</span>
                        </div>
                    </div>
                    
                    <div class="grid g2" style="gap:12px;margin-bottom:16px">
                        <!-- Kabe Canlı Yayını -->
                        <div style="position:relative;background:linear-gradient(135deg,#059669,#10b981);border-radius:12px;overflow:hidden;aspect-ratio:16/9;cursor:pointer" onclick="liveStreams.openKabaStream()">
                            <iframe 
                                src="https://www.youtube.com/embed/fSMct2kvDcw?autoplay=0&mute=1&controls=0&showinfo=0&rel=0&modestbranding=1&loop=1&playlist=fSMct2kvDcw"
                                style="width:100%;height:100%;border:none;pointer-events:none"
                                allowfullscreen>
                            </iframe>
                            <div style="position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,0.8));padding:12px 8px 8px;color:white">
                                <div style="font-weight:800;font-size:13px;margin-bottom:2px">🕋 Kabe-i Şerif</div>
                                <div style="font-size:10px;opacity:0.9">Mescid-i Haram • Mekke</div>
                                <div style="display:flex;align-items:center;justify-content:space-between;margin-top:4px">
                                    <span style="font-size:9px;opacity:0.8">🔴 Canlı</span>
                                    <span style="font-size:9px;opacity:0.8">👥 1.2M</span>
                                </div>
                            </div>
                            <div style="position:absolute;top:8px;right:8px;background:rgba(220,38,38,.9);color:white;padding:4px 8px;border-radius:12px;font-size:10px;font-weight:700">
                                <i class="fa-solid fa-play" style="font-size:8px" aria-hidden="true"></i> İZLE
                            </div>
                        </div>
                        
                        <!-- Medine Canlı Yayını -->
                        <div style="position:relative;background:linear-gradient(135deg,#7c3aed,#a855f7);border-radius:12px;overflow:hidden;aspect-ratio:16/9;cursor:pointer" onclick="liveStreams.openMedinaStream()">
                            <iframe 
                                src="https://www.youtube.com/embed/TpT8b8JFZ6E?autoplay=0&mute=1&controls=0&showinfo=0&rel=0&modestbranding=1&loop=1&playlist=TpT8b8JFZ6E"
                                style="width:100%;height:100%;border:none;pointer-events:none"
                                allowfullscreen>
                            </iframe>
                            <div style="position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,0.8));padding:12px 8px 8px;color:white">
                                <div style="font-weight:800;font-size:13px;margin-bottom:2px">🕌 Mescid-i Nebevi</div>
                                <div style="font-size:10px;opacity:0.9">Ravza-i Mutahhara • Medine</div>
                                <div style="display:flex;align-items:center;justify-content:space-between;margin-top:4px">
                                    <span style="font-size:9px;opacity:0.8">🔴 Canlı</span>
                                    <span style="font-size:9px;opacity:0.8">👥 850K</span>
                                </div>
                            </div>
                            <div style="position:absolute;top:8px;right:8px;background:rgba(220,38,38,.9);color:white;padding:4px 8px;border-radius:12px;font-size:10px;font-weight:700">
                                <i class="fa-solid fa-play" style="font-size:8px" aria-hidden="true"></i> İZLE
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding:12px;background:rgba(220,38,38,.1);border:1px solid #dc2626;border-radius:12px;text-align:center">
                        <div style="font-weight:700;color:#dc2626;margin-bottom:4px">
                            📺 7/24 Kesintisiz Canlı Yayın
                        </div>
                        <div style="font-size:12px;color:var(--tx2);line-height:1.4">
                            Kutsal topraklara canlı bağlantı • Manevi huzur • Namaz vakitleri gözlemi
                        </div>
                    </div>
                </div>

                <!-- Hicri Takvim -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div class="badge" style="background:rgba(124,58,237,.15);color:var(--namaz);border:1px solid var(--namaz)">
                            <i class="fa-solid fa-calendar-days" aria-hidden="true"></i> Hicri Takvim
                        </div>
                        <div style="text-align:right">
                            <div style="font-weight:700;color:var(--namaz)" id="hijriDate">1446/06/15</div>
                            <div style="font-size:13px;color:var(--tx2)" id="hijriMonth">Cemâziyelâhir</div>
                        </div>
                    </div>
                    <div style="margin-top:12px;padding:12px;background:rgba(124,58,237,.1);border:1px solid var(--namaz);border-radius:12px;text-align:center">
                        <div style="font-weight:700;color:var(--namaz)" id="hijriEvent">Özel Gün Bilgisi</div>
                        <div style="font-size:13px;color:var(--tx2);margin-top:4px" id="hijriEventDesc">Bugün özel bir İslami gün bulunmuyor</div>
                    </div>
                </div>

                <!-- Enhanced Prayer Times Card -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                        <div class="badge" style="background:rgba(124,58,237,.15);color:var(--namaz);border:1px solid var(--namaz);padding:8px 12px;border-radius:20px;font-weight:700">
                            <i class="fa-solid fa-mosque" aria-hidden="true"></i> Namaz Vakitleri
                        </div>
                        <div style="text-align:right">
                            <div style="font-weight:700;color:var(--namaz)" id="currentCity">İstanbul</div>
                            <div style="font-size:13px;color:var(--tx2)" id="currentTime">--:--</div>
                        </div>
                    </div>
                    
                    <div class="prayer-times-grid" id="prayerTimesContainer">
                        <!-- Prayer times will be dynamically loaded -->
                    </div>
                    
                    <div style="margin-top:16px;padding:12px;background:rgba(124,58,237,.1);border:1px solid var(--namaz);border-radius:12px;text-align:center">
                        <div style="font-weight:700;color:var(--namaz);margin-bottom:4px">
                            Sonraki: <span id="nextPrayerName">Yükleniyor...</span>
                        </div>
                        <div style="font-size:13px;color:var(--tx2)">
                            Kalan: <span id="remainingTime" style="font-weight:700;color:var(--namaz)">--:--</span>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Weather Card -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div style="display:flex;gap:12px;align-items:center">
                            <i id="weatherIcon" class="fa-solid fa-sun" style="color:var(--gold);font-size:24px" aria-hidden="true"></i>
                            <div>
                                <div style="font-weight:700" id="weatherLocation">İstanbul</div>
                                <div style="font-size:13px;color:var(--tx2)" id="weatherDesc">Güneşli</div>
                            </div>
                        </div>
                        <div style="text-align:right">
                            <div style="font-size:24px;font-weight:800;color:var(--gold)" id="temperature">24°</div>
                            <div style="font-size:12px;color:var(--tx2)" id="weatherUpdate">--:--</div>
                        </div>
                    </div>
                </div>

                <!-- Döviz Kurları -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(34,197,94,.15);color:#22c55e;border:1px solid #22c55e">
                            <i class="fa-solid fa-coins" aria-hidden="true"></i> Döviz Kurları
                        </div>
                        <button class="btn" onclick="currencyService.refreshRates()" style="padding:6px 8px;min-height:32px" aria-label="Kurları Yenile">
                            <i class="fa-solid fa-refresh" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <div id="currencyRates" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px">
                        <!-- Currency rates will be loaded here -->
                    </div>
                    
                    <div style="padding:8px 12px;background:rgba(34,197,94,.1);border:1px solid #22c55e;border-radius:8px;text-align:center">
                        <div style="font-size:11px;color:var(--tx2)">
                            Son güncelleme: <span id="currencyUpdate" style="font-weight:700;color:#22c55e">--:--</span>
                        </div>
                    </div>
                </div>

                <!-- Kabul Saatleri -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(147,51,234,.15);color:#9333ea;border:1px solid #9333ea">
                            <i class="fa-solid fa-hands-praying" aria-hidden="true"></i> Kabul Saatleri
                        </div>
                        <div style="text-align:right">
                            <div style="font-weight:700;color:#9333ea;font-size:12px" id="nextKabulTime">--:--</div>
                            <div style="font-size:10px;color:var(--tx2)">Sonraki</div>
                        </div>
                    </div>
                    
                    <div id="kabulSaatleri" style="margin-bottom:12px">
                        <!-- Kabul saatleri will be loaded here -->
                    </div>
                    
                    <div style="padding:12px;background:rgba(147,51,234,.1);border:1px solid #9333ea;border-radius:12px;text-align:center">
                        <div style="font-weight:700;color:#9333ea;margin-bottom:4px" id="currentKabulStatus">
                            📿 Müstecab Vakit Kontrolü
                        </div>
                        <div style="font-size:12px;color:var(--tx2)" id="kabulAdvice">
                            Dualarınızın kabul olması için en müstecab vakitleri takip edin
                        </div>
                    </div>
                </div>

                <!-- Daily Content -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge">
                            <i class="fa-solid fa-quote-right" aria-hidden="true"></i> Günün Hadisi
                        </div>
                        <button class="btn" onclick="shareManager.shareDaily('hadith')" aria-label="Hadisi Paylaş">
                            <i class="fa-solid fa-share-nodes" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div id="dailyHadith" style="font-weight:600;margin-bottom:8px">Yükleniyor...</div>
                    <div id="dailyHadithSource" style="font-size:13px;color:var(--tx2)">--</div>
                </div>

                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(30,64,175,.15);color:var(--dua);border:1px solid var(--dua)">
                            <i class="fa-solid fa-hands-praying" aria-hidden="true"></i> Bugünün Duası
                        </div>
                        <button class="btn" onclick="shareManager.shareDaily('dua')" aria-label="Duayı Paylaş">
                            <i class="fa-solid fa-share-nodes" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div id="dailyDua" style="font-weight:600;font-style:italic;margin-bottom:8px">Yükleniyor...</div>
                    <div id="dailyDuaEffect" style="font-size:13px;color:var(--tx2)">--</div>
                </div>

                <!-- Quick Actions -->
                <div class="grid g3" style="margin-bottom:16px">
                    <button class="btn" onclick="appNavigation.go('quran')" aria-label="Kur'an">
                        <i class="fa-solid fa-book-quran" aria-hidden="true"></i>
                        <span>Kur'an</span>
                    </button>
                    <button class="btn" onclick="appNavigation.go('dualar')" aria-label="Dualar">
                        <i class="fa-solid fa-hands-praying" aria-hidden="true"></i>
                        <span>Dua</span>
                    </button>
                    <button class="btn" onclick="appNavigation.go('hadisler')" aria-label="Hadisler">
                        <i class="fa-solid fa-quote-right" aria-hidden="true"></i>
                        <span>Hadis</span>
                    </button>
                </div>

                <!-- Location-based Services -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(59,130,246,.15);color:var(--mosque);border:1px solid var(--mosque)">
                            <i class="fa-solid fa-mosque" aria-hidden="true"></i> Yakındaki Camiler
                        </div>
                        <button class="btn" onclick="locationService.refreshMosques()" style="padding:6px 8px" aria-label="Camileri Yenile">
                            <i class="fa-solid fa-refresh" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div id="nearbyMosques">
                        <div class="loading">
                            <div class="spinner"></div>
                            <span>Camiler yükleniyor...</span>
                        </div>
                    </div>
                </div>

                <!-- Tours Preview -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(249,115,22,.15);color:var(--tour);border:1px solid var(--tour)">
                            <i class="fa-solid fa-plane" aria-hidden="true"></i> Öne Çıkan Turlar
                        </div>
                    </div>
                    <div style="display:flex;gap:12px;overflow-x:auto;margin-bottom:12px" id="homeTours">
                        <!-- Tours will be loaded here -->
                    </div>
                    <button class="btn" onclick="appNavigation.go('tours')" style="width:100%;background:linear-gradient(135deg,#fb923c,#f97316);color:#fff;border:none">
                        <i class="fa-solid fa-plane" aria-hidden="true"></i> Tüm Turları Görüntüle
                    </button>
                </div>
            </section>

            <!-- TESPIH VIEW -->
            <section id="tespih" class="view">
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">
                        <i class="fa-solid fa-prayer-rug" aria-hidden="true"></i> Dijital Tespih
                    </h2>
                    <p style="color:var(--tx2);margin:0">Dokunarak zikir yapın, ilerlemenizi takip edin</p>
                </div>

                <div class="card">
                    <div class="grid g2" style="margin-bottom:16px" id="tespihTypes">
                        <!-- Tespih types will be loaded here -->
                    </div>

                    <div class="tespih-container">
                        <div class="tespih-counter" onclick="tespihManager.increment()" id="tespihCounter" 
                             role="button" tabindex="0" aria-label="Tespih sayacı">
                            <div class="count-display" id="countDisplay">0</div>
                            <div style="position:absolute;bottom:30px;font-weight:600" id="tespihText">Sübhanallah</div>
                        </div>
                    </div>

                    <div class="grid g3">
                        <button class="btn" onclick="tespihManager.reset()" aria-label="Sıfırla">
                            <i class="fa-solid fa-rotate" aria-hidden="true"></i> Sıfırla
                        </button>
                        <button class="btn" onclick="tespihManager.togglePause()" id="pauseBtn" aria-label="Duraklat">
                            <i class="fa-solid fa-pause" aria-hidden="true"></i> Duraklat
                        </button>
                        <button class="btn" onclick="shareManager.shareTespihProgress()" aria-label="İlerlemeyi Paylaş">
                            <i class="fa-solid fa-share" aria-hidden="true"></i> Paylaş
                        </button>
                    </div>

                    <div style="text-align:center;margin-top:16px;color:var(--tx2)" id="tespihProgress">
                        Hedef: <span id="targetCount">33</span> • Kalan: <span id="remainingCount">33</span>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="card">
                    <h3 style="margin:0 0 16px">İstatistikler</h3>
                    <div class="grid g3">
                        <div style="text-align:center;padding:16px;background:var(--card2);border-radius:12px">
                            <div style="font-size:24px;font-weight:800;color:var(--tespih)" id="totalTespih">0</div>
                            <div style="font-size:12px;color:var(--tx2);margin-top:4px">Toplam</div>
                        </div>
                        <div style="text-align:center;padding:16px;background:var(--card2);border-radius:12px">
                            <div style="font-size:24px;font-weight:800;color:var(--gold)" id="todayTespih">0</div>
                            <div style="font-size:12px;color:var(--tx2);margin-top:4px">Bugün</div>
                        </div>
                        <div style="text-align:center;padding:16px;background:var(--card2);border-radius:12px">
                            <div style="font-size:24px;font-weight:800;color:var(--namaz)" id="streakDays">0</div>
                            <div style="font-size:12px;color:var(--tx2);margin-top:4px">Seri</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- QIBLA VIEW -->
            <section id="qibla" class="view">
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">
                        <i class="fa-solid fa-compass" aria-hidden="true"></i> Akıllı Kıble Pusulası
                    </h2>
                    <p id="qiblaStatus" style="color:var(--tx2);margin:0">Konum ve pusula izni bekleniyor...</p>
                    
                    <div class="compass-container">
                        <div class="compass-ring" id="compassRing">
                            <div id="qiblaNeedle" style="position:absolute;top:50%;left:50%;width:4px;height:120px;transform:translate(-50%,-50%) rotate(0deg);transform-origin:50% 50%;transition:transform 0.5s ease;z-index:10">
                                <div style="position:absolute;top:10px;left:50%;transform:translateX(-50%);width:32px;height:32px;background:var(--qibla);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800">
                                    <i class="fa-solid fa-kaaba" aria-hidden="true"></i>
                                </div>
                                <div style="position:absolute;top:42px;left:50%;transform:translateX(-50%);width:4px;height:70px;background:linear-gradient(to bottom,var(--qibla),rgba(74,222,128,.3));border-radius:2px"></div>
                            </div>
                            <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:16px;height:16px;border-radius:50%;background:var(--qibla);z-index:15"></div>
                        </div>
                    </div>
                    
                    <div style="text-align:center;margin-top:20px;padding:16px;background:var(--card2);border:1px solid var(--border);border-radius:16px">
                        <div style="font-size:32px;margin-bottom:8px" id="compassStatusIcon">🧭</div>
                        <div style="font-weight:600;margin-bottom:4px" id="compassStatusText">Pusulayı etkinleştirin</div>
                        <div style="font-size:18px;font-weight:800;color:var(--qibla)" id="qiblaAngle">--°</div>
                    </div>
                    
                    <div class="grid g2" style="margin-top:16px">
                        <button class="btn primary" onclick="qiblaManager.enable()" aria-label="Pusulayı Etkinleştir">
                            <i class="fa-solid fa-location-crosshairs" aria-hidden="true"></i> Etkinleştir
                        </button>
                        <button class="btn" onclick="qiblaManager.calibrate()" aria-label="Pusulayı Kalibre Et">
                            <i class="fa-solid fa-sync" aria-hidden="true"></i> Kalibre Et
                        </button>
                    </div>
                </div>
            </section>

            <!-- NAMAZ VIEW -->
            <section id="namaz" class="view">
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">
                        <i class="fa-solid fa-hands-praying" aria-hidden="true"></i> Namaz Rehberi
                    </h2>
                    <p style="color:var(--tx2);margin:0">Adım adım görsel rehber ile doğru namaz öğrenin</p>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 16px">Bugünün Namazları</h3>
                    <div id="dailyPrayerTracker">
                        <!-- Daily prayer tracker will be loaded here -->
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 16px">Namaz Türü Seçin</h3>
                    <div style="display:flex;gap:8px;overflow-x:auto;margin-bottom:16px" id="namazTypeSelector">
                        <!-- Prayer type chips will be loaded here -->
                    </div>
                    <div id="namazStepsContainer">
                        <!-- Prayer steps will be loaded here -->
                    </div>
                </div>
            </section>
        </main>

            <!-- TOURS VIEW -->
            <section id="tours" class="view">
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">🌟 Umrah & Hac Turları</h2>
                    <p style="color:var(--tx2);margin:0 0 16px">Kampanya ve kontenjanlar sınırlıdır</p>
                    <div style="display:flex;gap:8px;overflow-x:auto;margin-bottom:16px" id="tourFilters">
                        <button class="btn primary" onclick="contentManager.filterTours('all')" data-filter="all">Tümü</button>
                        <button class="btn" onclick="contentManager.filterTours('hac')" data-filter="hac">Hac</button>
                        <button class="btn" onclick="contentManager.filterTours('umre')" data-filter="umre">Umre</button>
                    </div>
                </div>
                <div id="tourList">
                    <!-- Tours will be loaded here -->
                </div>
            </section>

            <!-- MARKET VIEW -->
            <section id="market" class="view">
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">🛍️ Umrah & Hac Market</h2>
                    <p style="color:var(--tx2);margin:0 0 16px">Premium ürünler ve özel fiyatlarla</p>
                    <div style="display:flex;gap:8px;overflow-x:auto;margin-bottom:16px" id="marketFilters">
                        <button class="btn primary" onclick="contentManager.filterMarket('all')" data-filter="all">Tümü</button>
                        <button class="btn" onclick="contentManager.filterMarket('ihram')" data-filter="ihram">İhram</button>
                        <button class="btn" onclick="contentManager.filterMarket('teknoloji')" data-filter="teknoloji">Teknoloji</button>
                        <button class="btn" onclick="contentManager.filterMarket('namaz')" data-filter="namaz">Namaz</button>
                        <button class="btn" onclick="contentManager.filterMarket('zikir')" data-filter="zikir">Zikir</button>
                    </div>
                </div>
                <div id="marketContent">
                    <!-- Market items will be loaded here -->
                </div>
            </section>

            <!-- QURAN VIEW -->
            <section id="quran" class="view">
                <div class="card">
                    <h2 style="margin:0 0 16px;font-size:20px">📖 Kur'ân-ı Kerîm</h2>
                    <input id="quranSearch" class="input" placeholder="Sûre ara (Bakara, Yâsîn…)" 
                           oninput="contentManager.filterQuran(this.value)" style="margin-bottom:16px">
                </div>
                <div id="quranList">
                    <!-- Quran suras will be loaded here -->
                </div>
            </section>

            <!-- HADISLER VIEW -->
            <section id="hadisler" class="view">
                <div class="card">
                    <h2 style="margin:0 0 16px;font-size:20px">📜 Hadisler</h2>
                    <div style="display:flex;gap:8px;overflow-x:auto;margin-bottom:16px" id="hadithFilters">
                        <button class="btn primary" onclick="contentManager.filterHadith('all')" data-filter="all">Tümü</button>
                        <button class="btn" onclick="contentManager.filterHadith('sabir')" data-filter="sabir">Sabır</button>
                        <button class="btn" onclick="contentManager.filterHadith('rahmet')" data-filter="rahmet">Rahmet</button>
                        <button class="btn" onclick="contentManager.filterHadith('ahlak')" data-filter="ahlak">Ahlak</button>
                    </div>
                    <input id="hadithSearch" class="input" placeholder="Hadis ara..." 
                           oninput="contentManager.searchHadith(this.value)" style="margin-bottom:16px">
                </div>
                <div id="hadithList">
                    <!-- Hadith list will be loaded here -->
                </div>
            </section>

            <!-- DUALAR VIEW -->
            <section id="dualar" class="view">
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">🤲 Faydalı Dualar</h2>
                    <p style="color:var(--tx2);margin:0 0 16px">Kategoriler halinde düzenlenmiş dualar</p>
                </div>
                <div class="grid g2" style="margin-bottom:16px">
                    <button class="btn" onclick="contentManager.openDuaCategory('sabah')" style="background:rgba(251,146,60,.15);border-color:var(--tour);color:var(--tour)">
                        <div style="text-align:center">
                            <div style="font-weight:700">Sabah/Akşam</div>
                            <div style="font-size:12px;color:var(--tx2)">Günlük zikirler</div>
                        </div>
                    </button>
                    <button class="btn" onclick="contentManager.openDuaCategory('namaz')" style="background:rgba(124,58,237,.15);border-color:var(--namaz);color:var(--namaz)">
                        <div style="text-align:center">
                            <div style="font-weight:700">Namaz Sonrası</div>
                            <div style="font-size:12px;color:var(--tx2)">Selamdan sonra</div>
                        </div>
                    </button>
                    <button class="btn" onclick="contentManager.openDuaCategory('uyku')" style="background:rgba(30,64,175,.15);border-color:var(--dua);color:var(--dua)">
                        <div style="text-align:center">
                            <div style="font-weight:700">Uyku Öncesi</div>
                            <div style="font-size:12px;color:var(--tx2)">Korunma duaları</div>
                        </div>
                    </button>
                    <button class="btn" onclick="contentManager.openDuaCategory('seyahat')" style="background:rgba(16,185,129,.15);border-color:var(--tespih);color:var(--tespih)">
                        <div style="text-align:center">
                            <div style="font-weight:700">Seyahat</div>
                            <div style="font-size:12px;color:var(--tx2)">Yolculuk duaları</div>
                        </div>
                    </button>
                </div>
                <div id="duaList">
                    <!-- Dua details will be loaded here -->
                </div>
            </section>

            <!-- SOCIAL VIEW -->
            <section id="social" class="view">
                <!-- Grup Yönetimi -->
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">
                        <i class="fa-solid fa-users" style="color:var(--social)" aria-hidden="true"></i> Sosyal & Grup Takibi
                    </h2>
                    <p style="color:var(--tx2);margin:0 0 16px">Tur arkadaşlarınızla güvenli kalın</p>
                    
                    <div class="grid g2" style="margin-bottom:16px">
                        <button class="btn primary" onclick="socialManager.createGroup()">
                            <i class="fa-solid fa-plus" aria-hidden="true"></i> Grup Oluştur
                        </button>
                        <button class="btn" onclick="socialManager.joinGroup()">
                            <i class="fa-solid fa-sign-in-alt" aria-hidden="true"></i> Gruba Katıl
                        </button>
                    </div>
                    
                    <div style="padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:12px;text-align:center" id="socialGroupInfo">
                        <div style="color:var(--tx2);margin-bottom:8px">Grup Bilgisi</div>
                        <div id="socialGroupStatus">Henüz grup oluşturulmadı</div>
                    </div>
                </div>

                <!-- Konum Paylaşımı -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                        <div class="badge" style="background:rgba(236,72,153,.15);color:var(--social);border:1px solid var(--social)">
                            <i class="fa-solid fa-map-marker-alt" aria-hidden="true"></i> Konum Takibi
                        </div>
                        <div style="display:flex;align-items:center;gap:8px">
                            <div id="locationStatus" style="font-size:12px;color:var(--tx2)">Kapalı</div>
                            <button class="btn" onclick="socialManager.toggleLocationSharing()" id="locationToggle" style="padding:6px 12px;min-height:32px">
                                <i class="fa-solid fa-location-crosshairs" aria-hidden="true"></i> Aç
                            </button>
                        </div>
                    </div>
                    
                    <!-- Grup Haritası -->
                    <div id="groupLocationMap" style="display:none;margin-bottom:12px">
                        <div style="position:relative;height:200px;background:linear-gradient(135deg, #1e3a8a, #3b82f6);border-radius:12px;overflow:hidden;border:1px solid var(--social)">
                            <!-- Simulated Map Background -->
                            <div style="position:absolute;inset:0;background:url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><defs><pattern id=%22grid%22 width=%2210%22 height=%2210%22 patternUnits=%22userSpaceOnUse%22><path d=%22M 10 0 L 0 0 0 10%22 fill=%22none%22 stroke=%22%23ffffff15%22 stroke-width=%220.5%22/></pattern></defs><rect width=%22100%22 height=%22100%22 fill=%22url(%23grid)%22 /></svg>') opacity(0.3)"></div>
                            
                            <!-- Landmark Icons -->
                            <div style="position:absolute;top:30%;left:25%;color:#fbbf24;font-size:24px;text-shadow:0 2px 4px rgba(0,0,0,0.5)" title="Mescid-i Haram">
                                🕌
                            </div>
                            <div style="position:absolute;top:60%;right:30%;color:#10b981;font-size:20px;text-shadow:0 2px 4px rgba(0,0,0,0.5)" title="Mescid-i Nabevi">
                                ☪️
                            </div>
                            
                            <!-- Group Member Markers -->
                            <div id="mapMarkers">
                                <!-- Markers will be dynamically added here -->
                            </div>
                            
                            <!-- Map Controls -->
                            <div style="position:absolute;top:8px;right:8px;display:flex;gap:4px">
                                <button class="btn" onclick="socialManager.refreshMap()" style="padding:4px 6px;min-height:24px;font-size:10px;background:rgba(0,0,0,0.7);color:white;border:none">
                                    <i class="fa-solid fa-refresh" aria-hidden="true"></i>
                                </button>
                                <button class="btn" onclick="socialManager.centerMap()" style="padding:4px 6px;min-height:24px;font-size:10px;background:rgba(0,0,0,0.7);color:white;border:none">
                                    <i class="fa-solid fa-location-dot" aria-hidden="true"></i>
                                </button>
                            </div>
                            
                            <!-- Distance Legend -->
                            <div style="position:absolute;bottom:8px;left:8px;background:rgba(0,0,0,0.8);padding:6px 8px;border-radius:8px;font-size:10px;color:white">
                                <div style="display:flex;align-items:center;gap:4px;margin-bottom:2px">
                                    <div style="width:8px;height:8px;border-radius:50%;background:var(--social)"></div>
                                    <span>Sen</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:4px">
                                    <div style="width:8px;height:8px;border-radius:50%;background:var(--gold)"></div>
                                    <span>Grup Üyeleri</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Distance Summary -->
                        <div style="margin-top:8px;padding:8px 12px;background:rgba(236,72,153,.1);border:1px solid var(--social);border-radius:8px;font-size:12px">
                            <div style="font-weight:700;color:var(--social);margin-bottom:4px">📍 Grup Durumu</div>
                            <div id="groupLocationSummary" style="color:var(--tx2)">
                                Konum paylaşımı aktif olduğunda grup üyelerinin konumları görünecek
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding:12px;background:rgba(236,72,153,.1);border:1px solid var(--social);border-radius:12px;margin-bottom:12px">
                        <div style="font-weight:700;color:var(--social);margin-bottom:4px">🛡️ Güvenlik Önlemleri</div>
                        <div style="font-size:13px;color:var(--tx2);line-height:1.4">
                            • Konum sadece grup üyeleriyle paylaşılır<br>
                            • 24 saat sonra otomatik silinir<br>
                            • İstediğiniz zaman kapatabilirsiniz<br>
                            • Hassas alanlar (özel yerler) gizlenir
                        </div>
                    </div>
                </div>

                <!-- Grup Üyeleri -->
                <div class="card" id="groupMembersCard" style="display:none">
                    <h3 style="margin:0 0 16px">
                        <i class="fa-solid fa-users" style="color:var(--social)" aria-hidden="true"></i> Grup Üyeleri
                    </h3>
                    <div id="groupMembersList">
                        <!-- Group members will be loaded here -->
                    </div>
                </div>

                <!-- Acil Durum -->
                <div class="card">
                    <h3 style="margin:0 0 16px">
                        <i class="fa-solid fa-exclamation-triangle" style="color:#ef4444" aria-hidden="true"></i> Acil Durum
                    </h3>
                    <div style="padding:12px;background:rgba(239,68,68,.1);border:1px solid #ef4444;border-radius:12px;margin-bottom:12px;text-align:center">
                        <div style="font-weight:700;color:#ef4444;margin-bottom:8px">⚠️ Kayboldum / Yardım İhtiyacım Var</div>
                        <button class="btn" onclick="socialManager.sendEmergencyAlert()" style="background:#ef4444;color:#fff;border:none;width:100%">
                            <i class="fa-solid fa-sos" aria-hidden="true"></i> Acil Durum Bildirimi Gönder
                        </button>
                    </div>
                    <div class="grid g2">
                        <button class="btn" onclick="socialActions.openWhatsApp('🆘 ACİL DURUM: Kaybolduk / Yardıma ihtiyacımız var. Lütfen yardım edin!')">
                            <i class="fab fa-whatsapp" style="color:#25D366" aria-hidden="true"></i> WhatsApp
                        </button>
                        <button class="btn" onclick="socialManager.callEmergency()">
                            <i class="fa-solid fa-phone" style="color:#ef4444" aria-hidden="true"></i> Acil Çağrı
                        </button>
                    </div>
                </div>

                <!-- Rehber Kiralama -->
                <div class="card">
                    <h3 style="margin:0 0 16px">
                        <i class="fa-solid fa-user-tie" style="color:var(--gold)" aria-hidden="true"></i> Rehber Kiralama
                    </h3>
                    <div style="padding:12px;background:rgba(201,168,106,.1);border:1px solid var(--gold);border-radius:12px;margin-bottom:16px">
                        <div style="font-weight:700;color:var(--gold);margin-bottom:4px">⭐ Premium Rehber Hizmetleri</div>
                        <div style="font-size:13px;color:var(--tx2);line-height:1.4">
                            • Deneyimli ve lisanslı rehberler<br>
                            • 7/24 destek ve rehberlik<br>
                            • Özel tur programları<br>
                            • Acil durum yardımı
                        </div>
                    </div>
                    
                    <div id="guidesList">
                        <!-- Guide list will be loaded here -->
                    </div>
                </div>

                <!-- WhatsApp & Instagram Bağlantıları -->
                <div class="card">
                    <h3 style="margin:0 0 16px">
                        <i class="fa-solid fa-share-nodes" style="color:var(--social)" aria-hidden="true"></i> Sosyal Medya
                    </h3>
                    <div class="grid g2">
                        <button class="btn" onclick="socialActions.openWhatsApp('🕌 Merhaba! UHC Premium uygulaması hakkında bilgi almak istiyorum.')" style="background:#25D366;color:#fff;border:none">
                            <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp Destek
                        </button>
                        <button class="btn" onclick="socialActions.openInstagram()" style="background:linear-gradient(45deg, #833ab4, #fd1d1d, #fcb045);color:#fff;border:none">
                            <i class="fab fa-instagram" aria-hidden="true"></i> Instagram
                        </button>
                    </div>
                    <div style="margin-top:12px;padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:12px;text-align:center">
                        <div style="font-weight:700;margin-bottom:4px">🌟 Bizimle İletişime Geçin</div>
                        <div style="font-size:13px;color:var(--tx2)">
                            Sorularınız için WhatsApp'tan yazın veya Instagram'da bizi takip edin
                        </div>
                    </div>
                </div>
            </section>

            <!-- FRIENDS VIEW -->
            <section id="friends" class="view">
                <div class="card">
                    <h2 style="margin:0 0 8px;font-size:20px">👥 Arkadaşlar & Konum</h2>
                    <p style="color:var(--tx2);margin:0 0 16px">Grup oluştur, davet kodunu paylaş</p>
                    <div class="grid g2" style="margin-bottom:16px">
                        <button class="btn primary" onclick="contentManager.createGroup()">
                            <i class="fa-solid fa-plus" aria-hidden="true"></i> Grup Oluştur
                        </button>
                        <button class="btn" onclick="contentManager.shareInvite()">
                            <i class="fa-solid fa-share-nodes" aria-hidden="true"></i> Davet Paylaş
                        </button>
                    </div>
                    <div style="padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:12px;text-align:center" id="friendsGroupInfo">
                        <div style="color:var(--tx2);margin-bottom:8px">Grup Bilgisi</div>
                        <div id="friendsGroupStatus">Henüz grup oluşturulmadı</div>
                    </div>
                </div>
            </section>

            <!-- PROFILE VIEW -->
            <section id="profile" class="view">
                <div class="card">
                    <div style="text-align:center;margin-bottom:20px">
                        <div style="width:80px;height:80px;border-radius:50%;background:var(--acc);display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-size:32px;color:#0a0e14" id="profileAvatar">
                            <i class="fa-solid fa-user" aria-hidden="true"></i>
                        </div>
                        <h2 style="margin:0 0 4px;font-size:18px" id="profileName">Misafir Kullanıcı</h2>
                        <p style="margin:0;color:var(--tx2)" id="profileStatus">Premium üye olmak için giriş yapın</p>
                    </div>

                    <div class="grid g3" style="margin-bottom:20px">
                        <div style="text-align:center;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card2)">
                            <div style="font-size:20px;font-weight:800;color:var(--gold)" id="userTotalDays">0</div>
                            <div style="font-size:12px;color:var(--tx2);margin-top:4px">Gün</div>
                        </div>
                        <div style="text-align:center;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card2)">
                            <div style="font-size:20px;font-weight:800;color:var(--tespih)" id="userTotalTespih">0</div>
                            <div style="font-size:12px;color:var(--tx2);margin-top:4px">Zikir</div>
                        </div>
                        <div style="text-align:center;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card2)">
                            <div style="font-size:20px;font-weight:800;color:var(--namaz)" id="userStreak">0</div>
                            <div style="font-size:12px;color:var(--tx2);margin-top:4px">Seri</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 16px">Hesap Yönetimi</h3>
                    <div style="display:grid;gap:8px">
                        <div style="display:flex;align-items:center;justify-content:space-between;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card2)">
                            <div>
                                <div style="font-weight:600">Premium Üyelik</div>
                                <div style="font-size:12px;color:var(--tx2)">Tüm özelliklere erişim</div>
                            </div>
                            <button class="btn primary" onclick="authManager.upgradeToPremium()" style="padding:8px 16px;min-height:36px">
                                <i class="fa-solid fa-crown" aria-hidden="true"></i> Yükselt
                            </button>
                        </div>
                        <button class="btn" onclick="shareManager.shareApp()" style="justify-content:space-between;text-align:left">
                            <div>
                                <div style="font-weight:600">Uygulamayı Paylaş</div>
                                <div style="font-size:12px;color:var(--tx2)">Arkadaşlarınızla paylaşın</div>
                            </div>
                            <i class="fa-solid fa-share" aria-hidden="true"></i>
                        </button>
                        <button class="btn" onclick="authManager.logout()" style="justify-content:space-between;text-align:left;border-color:#ef4444">
                            <div>
                                <div style="font-weight:600;color:#ef4444">Çıkış Yap</div>
                                <div style="font-size:12px;color:var(--tx2)">Hesaptan çıkış yapın</div>
                            </div>
                            <i class="fa-solid fa-sign-out-alt" style="color:#ef4444" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Premium Modern Navigation -->
        <nav class="tabs" role="tablist">
            <button class="tab home active" onclick="appNavigation.go('home')" role="tab" aria-selected="true" aria-label="Ana Sayfa">
                <i class="fa-solid fa-house" aria-hidden="true"></i>
                <div class="tab-label">Ana</div>
            </button>
            <button class="tab tespih" onclick="appNavigation.go('tespih')" role="tab" aria-selected="false" aria-label="Tespih">
                <i class="fa-solid fa-dharmachakra" aria-hidden="true"></i>
                <div class="tab-label">Tespih</div>
            </button>
            <button class="tab qibla" onclick="appNavigation.go('qibla')" role="tab" aria-selected="false" aria-label="Kıble">
                <i class="fa-solid fa-compass" aria-hidden="true"></i>
                <div class="tab-label">Kıble</div>
            </button>
            <button class="tab market" onclick="appNavigation.go('market')" role="tab" aria-selected="false" aria-label="Market">
                <i class="fa-solid fa-store" aria-hidden="true"></i>
                <div class="tab-label">Market</div>
            </button>
            <button class="tab tours" onclick="appNavigation.go('tours')" role="tab" aria-selected="false" aria-label="Turlar">
                <i class="fa-solid fa-plane" aria-hidden="true"></i>
                <div class="tab-label">Turlar</div>
            </button>
            <button class="tab social" onclick="appNavigation.go('social')" role="tab" aria-selected="false" aria-label="Sosyal">
                <i class="fa-solid fa-users" aria-hidden="true"></i>
                <div class="tab-label">Sosyal</div>
            </button>
            <button class="tab profile" onclick="appNavigation.go('profile')" role="tab" aria-selected="false" aria-label="Profil">
                <i class="fa-solid fa-user" aria-hidden="true"></i>
                <div class="tab-label">Profil</div>
            </button>
        </nav>
    </div>

    <!-- Email Auth Modal -->
    <div id="emailModal" class="modal">
        <div class="modal-content">
            <h3 style="margin:0 0 16px">E-posta ile Giriş</h3>
            <div class="grid g2" style="margin-bottom:12px">
                <button class="btn primary" onclick="authManager.switchEmailMode('login')" id="loginBtn">Giriş Yap</button>
                <button class="btn" onclick="authManager.switchEmailMode('register')" id="registerBtn">Kayıt Ol</button>
            </div>
            <div id="emailForm">
                <input class="input" placeholder="E-posta" type="email" id="emailInput" style="margin-bottom:12px">
                <input class="input" placeholder="Şifre" type="password" id="passwordInput" style="margin-bottom:12px">
                <input class="input" placeholder="Şifre Tekrar" type="password" id="passwordConfirmInput" style="margin-bottom:12px;display:none">
                <input class="input" placeholder="Ad Soyad" id="nameInput" style="margin-bottom:12px;display:none">
            </div>
            <div class="grid g2">
                <button class="btn primary" onclick="authManager.processEmailAuth()" id="authBtn">Giriş Yap</button>
                <button class="btn" onclick="authManager.closeEmailModal()">Kapat</button>
            </div>
        </div>
    </div>
    </div>

    <script>
        'use strict';

        // ============ MODERN JAVASCRIPT ARCHITECTURE ============

        // Service Worker Registration with Error Handling
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('SW registered:', registration);
                } catch (error) {
                    console.warn('SW registration failed:', error);
                }
            });
        }

        // ============ CORE APPLICATION STATE ============
        class AppState {
            constructor() {
                this.user = {
                    id: 'guest',
                    name: 'Misafir Kullanıcı',
                    type: 'guest',
                    stats: { totalTespih: 0, todayTespih: 0, streak: 0 }
                };
                
                this.location = {
                    lat: 41.0082,
                    lon: 28.9784,
                    city: 'İstanbul',
                    country: 'Turkey'
                };
                
                this.prayerTimes = {};
                this.weather = {};
                this.tespih = {
                    count: 0,
                    target: 33,
                    type: 'subhanallah',
                    text: 'Sübhanallah',
                    isPaused: false
                };
                
                this.qibla = {
                    angle: 0,
                    isActive: false,
                    heading: 0
                };
                
                this.observers = new Map();
            }

            // Observer pattern for reactive updates
            subscribe(key, callback) {
                if (!this.observers.has(key)) {
                    this.observers.set(key, []);
                }
                this.observers.get(key).push(callback);
            }

            notify(key, data) {
                if (this.observers.has(key)) {
                    this.observers.get(key).forEach(callback => callback(data));
                }
            }

            update(key, value) {
                this[key] = { ...this[key], ...value };
                this.notify(key, this[key]);
                this.persist();
            }

            // Debounced persistence
            persist = utils.debounce(() => {
                try {
                    localStorage.setItem('uhc_app_state', JSON.stringify({
                        user: this.user,
                        tespih: this.tespih,
                        location: this.location,
                        lastUpdate: Date.now()
                    }));
                } catch (error) {
                    console.warn('Failed to persist state:', error);
                }
            }, 1000);

            load() {
                try {
                    const saved = localStorage.getItem('uhc_app_state');
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.user = { ...this.user, ...data.user };
                        this.tespih = { ...this.tespih, ...data.tespih };
                        this.location = { ...this.location, ...data.location };
                        return true;
                    }
                } catch (error) {
                    console.warn('Failed to load state:', error);
                }
                return false;
            }
        }

        // ============ UTILITY FUNCTIONS ============
        const utils = {
            // Debounce function for performance
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // Throttle function for performance
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },

            // Enhanced toast with better UX
            showToast(message, type = 'info', duration = 3000) {
                const existingToast = document.querySelector('.toast');
                if (existingToast) existingToast.remove();

                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.innerHTML = `
                    <div style="display:flex;align-items:center;gap:8px">
                        <i class="fa-solid ${this.getToastIcon(type)}" aria-hidden="true"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(toast);
                
                // Auto remove
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.style.animation = 'slideOutUp 0.3s ease-in forwards';
                        setTimeout(() => toast.remove(), 300);
                    }
                }, duration);

                return toast;
            },

            getToastIcon(type) {
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };
                return icons[type] || icons.info;
            },

            // Format time consistently
            formatTime(timeString) {
                try {
                    if (timeString.includes('(')) {
                        timeString = timeString.split('(')[0].trim();
                    }
                    
                    if (timeString.match(/^\d{2}:\d{2}$/)) {
                        return timeString;
                    }
                    
                    const [time, period] = timeString.split(' ');
                    let [hours, minutes] = time.split(':').map(Number);
                    
                    if (period?.toLowerCase() === 'pm' && hours !== 12) {
                        hours += 12;
                    } else if (period?.toLowerCase() === 'am' && hours === 12) {
                        hours = 0;
                    }
                    
                    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                } catch (error) {
                    console.warn('Time format error:', error);
                    return '00:00';
                }
            },

            // Calculate time remaining
            getTimeRemaining(targetTime) {
                const now = new Date();
                const target = new Date();
                const [hours, minutes] = targetTime.split(':').map(Number);
                
                target.setHours(hours, minutes, 0, 0);
                
                if (target <= now) {
                    target.setDate(target.getDate() + 1);
                }
                
                const diff = target - now;
                const remainingHours = Math.floor(diff / (1000 * 60 * 60));
                const remainingMinutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                if (remainingHours > 0) {
                    return `${remainingHours} saat ${remainingMinutes} dakika`;
                } else {
                    return `${remainingMinutes} dakika`;
                }
            }
        };

        // ============ API SERVICES ============
        class APIService {
            constructor() {
                this.baseURL = '';
                this.timeout = 10000;
            }

            async request(url, options = {}) {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), this.timeout);

                try {
                    const response = await fetch(url, {
                        ...options,
                        signal: controller.signal,
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        }
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    return await response.json();
                } catch (error) {
                    clearTimeout(timeoutId);
                    if (error.name === 'AbortError') {
                        throw new Error('Request timeout');
                    }
                    throw error;
                }
            }
        }

        // Prayer Times API with Fallback Calculator
        class PrayerTimesAPI extends APIService {
            constructor() {
                super();
                this.cache = new Map();
            }

            async getPrayerTimes(latitude, longitude, date = null) {
                try {
                    const targetDate = date || new Date();
                    const dateStr = targetDate.toISOString().split('T')[0];
                    const cacheKey = `${latitude},${longitude},${dateStr}`;
                    
                    if (this.cache.has(cacheKey)) return this.cache.get(cacheKey);

                    let times = await this.tryAPI(latitude, longitude, dateStr);
                    if (!times) times = this.generateFallbackTimes(latitude, longitude, targetDate);

                    this.cache.set(cacheKey, times);
                    if (this.cache.size > 30) {
                        const oldestKey = this.cache.keys().next().value;
                        this.cache.delete(oldestKey);
                    }
                    return times;
                } catch (error) {
                    console.warn('Prayer times error:', error);
                    return this.generateFallbackTimes(latitude, longitude, date || new Date());
                }
            }

            async tryAPI(latitude, longitude, dateStr) {
                try {
                    const method = this.getMethod(latitude, longitude);
                    const timezone = this.getTimezone(latitude, longitude);
                    const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${latitude}&longitude=${longitude}&method=${method}&timezonestring=${timezone}`;
                    
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    
                    if (data.code === 200 && data.data?.timings) {
                        const timings = data.data.timings;
                        return {
                            imsak: utils.formatTime(timings.Imsak),
                            fajr: utils.formatTime(timings.Fajr),
                            sunrise: utils.formatTime(timings.Sunrise),
                            dhuhr: utils.formatTime(timings.Dhuhr),
                            asr: utils.formatTime(timings.Asr),
                            maghrib: utils.formatTime(timings.Maghrib),
                            isha: utils.formatTime(timings.Isha)
                        };
                    }
                    return null;
                } catch (error) {
                    return null;
                }
            }

            getMethod(lat, lon) {
                if (lat >= 35 && lat <= 42 && lon >= 26 && lon <= 45) return 13; // Turkey
                if (lat >= 15 && lat <= 35 && lon >= 34 && lon <= 56) return 4; // Saudi
                if (lat >= 20 && lat <= 40 && lon >= -10 && lon <= 40) return 5; // Egypt
                return 2; // ISNA
            }

            getTimezone(lat, lon) {
                if (lat >= 35 && lat <= 42 && lon >= 26 && lon <= 45) return 'Europe/Istanbul';
                if (lat >= 15 && lat <= 35 && lon >= 34 && lon <= 56) return 'Asia/Riyadh';
                return 'UTC';
            }

            generateFallbackTimes(latitude, longitude, date) {
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
                const seasonFactor = Math.sin((dayOfYear / 365) * 2 * Math.PI - Math.PI/2);
                
                const baseTimes = {
                    imsak: 330, fajr: 340, sunrise: 430, dhuhr: 795,
                    asr: 960, maghrib: 1140, isha: 1230
                };

                const adjustments = {
                    imsak: seasonFactor * -120, fajr: seasonFactor * -120, sunrise: seasonFactor * -90,
                    dhuhr: 0, asr: seasonFactor * 60, maghrib: seasonFactor * 120, isha: seasonFactor * 150
                };

                const result = {};
                for (const [prayer, base] of Object.entries(baseTimes)) {
                    const adjusted = Math.round(base + (adjustments[prayer] || 0));
                    const hour = Math.floor(adjusted / 60) % 24;
                    const minute = adjusted % 60;
                    result[prayer] = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                }
                return result;
            }

            async getYearlyPrayerTimes(latitude, longitude, year = null) {
                const targetYear = year || new Date().getFullYear();
                const yearlyTimes = {};

                // Generate times for the entire year
                for (let month = 0; month < 12; month++) {
                    yearlyTimes[month] = {};
                    const daysInMonth = new Date(targetYear, month + 1, 0).getDate();
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const date = new Date(targetYear, month, day);
                        const times = await this.getPrayerTimes(latitude, longitude, date);
                        yearlyTimes[month][day] = times;
                    }
                }

                return yearlyTimes;
            }
        }

        // Weather API Service
        class WeatherAPI extends APIService {
            constructor() {
                super();
                this.apiKey = ''; // API key would be configured separately
            }

            async getWeather(latitude, longitude) {
                try {
                    // Using a mock response since we don't have an API key
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve({
                                temperature: Math.floor(Math.random() * 20) + 15,
                                description: ['Güneşli', 'Bulutlu', 'Açık'][Math.floor(Math.random() * 3)],
                                icon: 'fa-sun',
                                location: appState.location.city
                            });
                        }, 1000);
                    });
                } catch (error) {
                    console.warn('Weather API error:', error);
                    return {
                        temperature: 24,
                        description: 'Güneşli',
                        icon: 'fa-sun',
                        location: 'İstanbul'
                    };
                }
            }
        }

        // ============ LOCATION SERVICE ============
        class LocationService {
            constructor() {
                this.watchId = null;
                this.lastKnownPosition = null;
            }

            async requestLocation() {
                if (!navigator.geolocation) {
                    utils.showToast('❌ Bu tarayıcı konum desteklemiyor', 'error');
                    return false;
                }

                utils.showToast('📍 Konum alınıyor...', 'info');

                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(
                            resolve,
                            reject,
                            {
                                enableHighAccuracy: true,
                                timeout: 10000,
                                maximumAge: 300000 // 5 minutes
                            }
                        );
                    });

                    const { latitude, longitude } = position.coords;
                    
                    // Update app state
                    appState.update('location', {
                        lat: latitude,
                        lon: longitude,
                        accuracy: position.coords.accuracy
                    });

                    // Get city name from coordinates
                    await this.reverseGeocode(latitude, longitude);
                    
                    // Refresh dependent services
                    await prayerService.loadPrayerTimes();
                    await weatherService.loadWeather();
                    
                    utils.showToast('✅ Konum başarıyla alındı', 'success');
                    return true;

                } catch (error) {
                    console.warn('Location error:', error);
                    let message = '❌ Konum alınamadı';
                    
                    if (error.code === error.PERMISSION_DENIED) {
                        message = '❌ Konum izni verilmedi';
                    } else if (error.code === error.TIMEOUT) {
                        message = '⏱️ Konum alma zaman aşımı';
                    }
                    
                    utils.showToast(message, 'warning');
                    return false;
                }
            }

            async reverseGeocode(lat, lon) {
                try {
                    // Mock geocoding - in real app, use a geocoding service
                    const cities = {
                        'istanbul': { lat: 41.0082, lon: 28.9784 },
                        'ankara': { lat: 39.9334, lon: 32.8597 },
                        'izmir': { lat: 38.4237, lon: 27.1428 }
                    };

                    let closestCity = 'İstanbul';
                    let minDistance = Infinity;

                    for (const [name, coords] of Object.entries(cities)) {
                        const distance = Math.sqrt(
                            Math.pow(lat - coords.lat, 2) + Math.pow(lon - coords.lon, 2)
                        );
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestCity = name.charAt(0).toUpperCase() + name.slice(1);
                        }
                    }

                    appState.update('location', { city: closestCity });
                } catch (error) {
                    console.warn('Reverse geocoding failed:', error);
                }
            }

            startWatching() {
                if (navigator.geolocation && !this.watchId) {
                    this.watchId = navigator.geolocation.watchPosition(
                        position => {
                            this.lastKnownPosition = position;
                            appState.update('location', {
                                lat: position.coords.latitude,
                                lon: position.coords.longitude
                            });
                        },
                        error => console.warn('Location watch error:', error),
                        { enableHighAccuracy: false, maximumAge: 600000 } // 10 minutes
                    );
                }
            }

            stopWatching() {
                if (this.watchId) {
                    navigator.geolocation.clearWatch(this.watchId);
                    this.watchId = null;
                }
            }

            async refreshMosques() {
                utils.showToast('📍 Camiler yenileniyor...', 'info');
                
                // Mock mosque data - in real app, fetch from a service
                const mosques = [
                    { name: 'Sultanahmet Camii', distance: '850m', walkTime: '11 dk', rating: 4.8 },
                    { name: 'Beyazıt Camii', distance: '1.2km', walkTime: '15 dk', rating: 4.6 },
                    { name: 'Süleymaniye Camii', distance: '1.8km', walkTime: '23 dk', rating: 4.9 }
                ];

                setTimeout(() => {
                    this.renderMosques(mosques);
                    utils.showToast('✅ Camiler güncellendi', 'success');
                }, 1500);
            }

            renderMosques(mosques) {
                const container = document.getElementById('nearbyMosques');
                if (!container) return;

                container.innerHTML = mosques.map((mosque, index) => `
                    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;margin-bottom:8px;background:${index === 0 ? 'rgba(59,130,246,.1)' : 'var(--card2)'};border:1px solid ${index === 0 ? 'var(--mosque)' : 'var(--border)'};border-radius:12px;transition:var(--transition)" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="flex:1">
                            <div style="font-weight:700;color:${index === 0 ? 'var(--mosque)' : 'var(--tx)'};margin-bottom:4px">
                                ${mosque.name}
                                ${index === 0 ? '<span style="background:var(--mosque);color:#fff;font-size:10px;padding:2px 6px;border-radius:8px;margin-left:8px">EN YAKIN</span>' : ''}
                            </div>
                            <div style="font-size:13px;color:var(--tx2)">${mosque.distance} • ${mosque.walkTime} yürüyüş</div>
                            <div style="display:flex;align-items:center;gap:4px;margin-top:4px">
                                <span style="color:var(--gold)">★</span>
                                <span style="font-size:12px;color:var(--tx2)">${mosque.rating}</span>
                            </div>
                        </div>
                        <button class="btn ${index === 0 ? 'primary' : ''}" style="padding:8px 12px;min-height:36px" onclick="utils.showToast('🗺️ ${mosque.name} için yol tarifi açılıyor...', 'info')" aria-label="${mosque.name} yol tarifi">
                            <i class="fa-solid fa-route" aria-hidden="true"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        // ============ PRAYER SERVICE ============
        class PrayerService {
            constructor() {
                this.api = new PrayerTimesAPI();
                this.updateInterval = null;
            }

            async loadPrayerTimes() {
                const { lat, lon } = appState.location;
                const times = await this.api.getPrayerTimes(lat, lon);
                
                appState.update('prayerTimes', times);
                this.renderPrayerTimes(times);
                this.updateNextPrayer(times);
                
                return times;
            }

            renderPrayerTimes(times) {
                const container = document.getElementById('prayerTimesContainer');
                if (!container) return;

                const prayerList = [
                    { key: 'imsak', name: 'İmsak', icon: '🌅' },
                    { key: 'fajr', name: 'Sabah', icon: '☀️' },
                    { key: 'dhuhr', name: 'Öğle', icon: '🌞' },
                    { key: 'asr', name: 'İkindi', icon: '🌤️' },
                    { key: 'maghrib', name: 'Akşam', icon: '🌆' },
                    { key: 'isha', name: 'Yatsı', icon: '🌙' }
                ];

                const now = new Date();
                const currentMinutes = now.getHours() * 60 + now.getMinutes();
                
                let activePrayerIndex = -1;
                let nextPrayerIndex = 0;

                // Find current and next prayer
                for (let i = 0; i < prayerList.length; i++) {
                    const prayer = prayerList[i];
                    const [hour, minute] = times[prayer.key].split(':').map(Number);
                    const prayerMinutes = hour * 60 + minute;
                    
                    if (currentMinutes >= prayerMinutes) {
                        activePrayerIndex = i;
                    } else if (nextPrayerIndex === 0) {
                        nextPrayerIndex = i;
                        break;
                    }
                }

                container.innerHTML = prayerList.map((prayer, index) => {
                    const isActive = index === activePrayerIndex;
                    const isNext = index === nextPrayerIndex;
                    
                    return `
                        <div class="prayer-time-card ${isActive ? 'active' : ''} ${isNext ? 'next' : ''}" role="button" tabindex="0">
                            <div style="font-size:18px;margin-bottom:4px" aria-hidden="true">${prayer.icon}</div>
                            <div style="font-size:11px;font-weight:700;margin-bottom:2px">${prayer.name}</div>
                            <div style="font-size:14px;font-weight:800;color:var(--gold)">${times[prayer.key]}</div>
                        </div>
                    `;
                }).join('');
            }

            updateNextPrayer(times) {
                const prayerList = [
                    { key: 'fajr', name: 'Sabah Namazı' },
                    { key: 'dhuhr', name: 'Öğle Namazı' },
                    { key: 'asr', name: 'İkindi Namazı' },
                    { key: 'maghrib', name: 'Akşam Namazı' },
                    { key: 'isha', name: 'Yatsı Namazı' }
                ];

                const now = new Date();
                const currentMinutes = now.getHours() * 60 + now.getMinutes();
                
                let nextPrayer = null;
                
                for (const prayer of prayerList) {
                    const [hour, minute] = times[prayer.key].split(':').map(Number);
                    const prayerMinutes = hour * 60 + minute;
                    
                    if (prayerMinutes > currentMinutes) {
                        nextPrayer = { ...prayer, time: times[prayer.key] };
                        break;
                    }
                }
                
                // If no prayer today, tomorrow's first prayer
                if (!nextPrayer) {
                    nextPrayer = { ...prayerList[0], time: times[prayerList[0].key] };
                }
                
                const nextPrayerNameEl = document.getElementById('nextPrayerName');
                const remainingTimeEl = document.getElementById('remainingTime');
                
                if (nextPrayerNameEl) nextPrayerNameEl.textContent = nextPrayer.name;
                if (remainingTimeEl) remainingTimeEl.textContent = utils.getTimeRemaining(nextPrayer.time);
            }

            startAutoUpdate() {
                // Update current time every minute
                this.updateInterval = setInterval(() => {
                    const now = new Date();
                    const timeEl = document.getElementById('currentTime');
                    if (timeEl) {
                        timeEl.textContent = now.toLocaleTimeString('tr-TR', {
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                    
                    this.updateNextPrayer(appState.prayerTimes);
                }, 60000);
            }

            stopAutoUpdate() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
            }
        }

        // ============ WEATHER SERVICE ============
        class WeatherService {
            constructor() {
                this.api = new WeatherAPI();
            }

            async loadWeather() {
                const { lat, lon } = appState.location;
                const weather = await this.api.getWeather(lat, lon);
                
                appState.update('weather', weather);
                this.renderWeather(weather);
                
                return weather;
            }

            renderWeather(weather) {
                const iconEl = document.getElementById('weatherIcon');
                const locationEl = document.getElementById('weatherLocation');
                const descEl = document.getElementById('weatherDesc');
                const tempEl = document.getElementById('temperature');
                const updateEl = document.getElementById('weatherUpdate');

                if (iconEl) iconEl.className = `fa-solid ${weather.icon}`;
                if (locationEl) locationEl.textContent = weather.location;
                if (descEl) descEl.textContent = weather.description;
                if (tempEl) tempEl.textContent = `${weather.temperature}°`;
                if (updateEl) updateEl.textContent = new Date().toLocaleTimeString('tr-TR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        // ============ TESPIH MANAGER ============
        class TespihManager {
            constructor() {
                this.types = [
                    { id: 'subhanallah', text: 'Sübhanallah', target: 33 },
                    { id: 'alhamdulillah', text: 'Elhamdülillah', target: 33 },
                    { id: 'allahuakbar', text: 'Allahu Ekber', target: 34 },
                    { id: 'custom', text: 'Özel', target: 0 }
                ];
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Keyboard support for tespih counter
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && appNavigation.currentView === 'tespih') {
                        e.preventDefault();
                        this.increment();
                    }
                });
            }

            selectType(type) {
                const selectedType = this.types.find(t => t.id === type) || this.types[0];
                
                appState.update('tespih', {
                    type: selectedType.id,
                    text: selectedType.text,
                    target: selectedType.target,
                    count: 0
                });

                this.renderTypes();
                this.updateDisplay();
            }

            increment() {
                if (appState.tespih.isPaused) return;

                const newCount = appState.tespih.count + 1;
                const newTotalToday = appState.user.stats.todayTespih + 1;
                const newTotal = appState.user.stats.totalTespih + 1;

                appState.update('tespih', { count: newCount });
                appState.update('user', {
                    stats: {
                        ...appState.user.stats,
                        todayTespih: newTotalToday,
                        totalTespih: newTotal
                    }
                });

                // Haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }

                // Visual feedback
                const counter = document.getElementById('tespihCounter');
                if (counter) {
                    counter.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        counter.style.transform = 'scale(1)';
                    }, 150);
                }

                this.updateDisplay();

                // Check target completion
                if (appState.tespih.target > 0 && newCount >= appState.tespih.target) {
                    setTimeout(() => {
                        utils.showToast(`🎉 ${appState.tespih.text} tamamlandı! (${appState.tespih.target} kez)`, 'success');
                        setTimeout(() => this.reset(), 2000);
                    }, 500);
                }
            }

            reset() {
                appState.update('tespih', { count: 0 });
                this.updateDisplay();
                utils.showToast('🔄 Tespih sıfırlandı', 'info');
            }

            togglePause() {
                const isPaused = !appState.tespih.isPaused;
                appState.update('tespih', { isPaused });
                
                const btn = document.getElementById('pauseBtn');
                if (btn) {
                    btn.innerHTML = isPaused 
                        ? '<i class="fa-solid fa-play" aria-hidden="true"></i> Devam Et'
                        : '<i class="fa-solid fa-pause" aria-hidden="true"></i> Duraklat';
                }

                utils.showToast(isPaused ? '⏸️ Duraklatıldı' : '▶️ Devam ediyor', 'info');
            }

            renderTypes() {
                const container = document.getElementById('tespihTypes');
                if (!container) return;

                container.innerHTML = this.types.map(type => `
                    <button class="btn ${appState.tespih.type === type.id ? 'primary' : ''}" 
                            onclick="tespihManager.selectType('${type.id}')"
                            aria-label="${type.text} seç">
                        <div style="text-align:center">
                            <div style="font-weight:700">${type.text}</div>
                            <div style="font-size:12px;color:var(--tx2)">${type.target || 'Serbest'}</div>
                        </div>
                    </button>
                `).join('');
            }

            updateDisplay() {
                const countEl = document.getElementById('countDisplay');
                const textEl = document.getElementById('tespihText');
                const targetEl = document.getElementById('targetCount');
                const remainingEl = document.getElementById('remainingCount');
                const totalEl = document.getElementById('totalTespih');
                const todayEl = document.getElementById('todayTespih');
                const streakEl = document.getElementById('streakDays');

                if (countEl) countEl.textContent = appState.tespih.count;
                if (textEl) textEl.textContent = appState.tespih.text;
                if (targetEl) targetEl.textContent = appState.tespih.target || '∞';
                
                if (remainingEl) {
                    const remaining = appState.tespih.target > 0 
                        ? Math.max(0, appState.tespih.target - appState.tespih.count)
                        : '∞';
                    remainingEl.textContent = remaining;
                }

                if (totalEl) totalEl.textContent = appState.user.stats.totalTespih;
                if (todayEl) todayEl.textContent = appState.user.stats.todayTespih;
                if (streakEl) streakEl.textContent = appState.user.stats.streak;
            }
        }

        // ============ ULTRA PRECISION QIBLA MANAGER ============
        class QiblaManager {
            constructor() {
                this.kaaba = { lat: 21.4225, lon: 39.8262 };
                this.isActive = false;
                
                // Advanced compass state
                this.compass = {
                    heading: 0,
                    magneticHeading: 0,
                    trueHeading: 0,
                    accuracy: 0,
                    calibrationLevel: 0
                };
                
                // Sensor fusion data
                this.sensors = {
                    magnetometer: { x: 0, y: 0, z: 0 },
                    accelerometer: { x: 0, y: 0, z: 0 },
                    gyroscope: { x: 0, y: 0, z: 0 }
                };
                
                // Filtering and smoothing
                this.filter = {
                    alpha: 0.1, // Low-pass filter coefficient
                    history: [], // Recent heading history
                    maxHistory: 10,
                    threshold: 2 // Minimum change threshold
                };
                
                // Qibla calculation
                this.qibla = {
                    direction: 0,
                    distance: 0,
                    magneticDeclination: 0,
                    accuracy: 'calculating'
                };
                
                // Auto-calibration system
                this.calibration = {
                    isCalibrating: false,
                    samples: [],
                    requiredSamples: 20,
                    variance: 0,
                    quality: 'unknown'
                };
                
                // Performance monitoring
                this.performance = {
                    updateCount: 0,
                    lastUpdate: 0,
                    averageInterval: 0,
                    errors: 0
                };
            }

            async enable() {
                try {
                    utils.showToast('🔄 Hassas pusula başlatılıyor...', 'info');
                    
                    // Initialize location-based calculations
                    await this.initializeLocation();
                    
                    // Check comprehensive device support
                    const supportCheck = await this.checkAdvancedSupport();
                    if (!supportCheck.success) {
                        this.showManualCompass(supportCheck.reason);
                        return;
                    }
                    
                    // Request all necessary permissions
                    const permissionResult = await this.requestAllPermissions();
                    if (!permissionResult.success) {
                        this.showManualCompass('İzinler alınamadı');
                        return;
                    }
                    
                    // Initialize sensor systems
                    await this.initializeSensors();
                    
                    // Start precision tracking
                    this.startPrecisionTracking();
                    
                    // Begin auto-calibration
                    this.startAutoCalibration();
                    
                    utils.showToast('🎯 Hassas pusula etkinleştirildi', 'success');
                    
                } catch (error) {
                    console.error('Advanced Qibla initialization failed:', error);
                    this.handleError(error);
                }
            }

            async initializeLocation() {
                try {
                    const { lat, lon } = appState.location;
                    
                    // Calculate precise Qibla direction using high-precision formula
                    this.calculatePreciseQiblaDirection(lat, lon);
                    
                    // Get magnetic declination for location
                    this.qibla.magneticDeclination = await this.getMagneticDeclination(lat, lon);
                    
                    this.updateStatus(`🕋 Kıble: ${Math.round(this.qibla.direction)}° (±${this.qibla.accuracy})`, '📍');
                    
                } catch (error) {
                    console.warn('Location initialization failed:', error);
                    this.qibla.direction = 0;
                    this.qibla.accuracy = 'unknown';
                }
            }

            calculatePreciseQiblaDirection(userLat, userLon) {
                try {
                    // High-precision great circle calculation
                    const toRad = Math.PI / 180;
                    const toDeg = 180 / Math.PI;
                    
                    const lat1 = userLat * toRad;
                    const lat2 = this.kaaba.lat * toRad;
                    const deltaLon = (this.kaaba.lon - userLon) * toRad;
                    
                    // Using more precise Vincenty formula approach
                    const y = Math.sin(deltaLon) * Math.cos(lat2);
                    const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(deltaLon);
                    
                    let bearing = Math.atan2(y, x) * toDeg;
                    bearing = (bearing + 360) % 360; // Normalize to 0-360
                    
                    this.qibla.direction = bearing;
                    
                    // Calculate distance for accuracy estimation
                    const R = 6371; // Earth radius in km
                    const dLat = (this.kaaba.lat - userLat) * toRad;
                    const dLon = deltaLon;
                    
                    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                            Math.cos(lat1) * Math.cos(lat2) *
                            Math.sin(dLon/2) * Math.sin(dLon/2);
                    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                    
                    this.qibla.distance = R * c;
                    
                    // Accuracy estimation based on distance
                    if (this.qibla.distance < 1000) {
                        this.qibla.accuracy = '0.5°';
                    } else if (this.qibla.distance < 5000) {
                        this.qibla.accuracy = '1°';
                    } else {
                        this.qibla.accuracy = '2°';
                    }
                    
                } catch (error) {
                    console.error('Precise Qibla calculation failed:', error);
                    this.qibla.direction = 0;
                    this.qibla.accuracy = 'error';
                }
            }

            async getMagneticDeclination(lat, lon) {
                try {
                    // Simplified magnetic declination calculation
                    // In production, use a proper geomagnetic model like WMM
                    const year = new Date().getFullYear();
                    const approximateDeclination = Math.sin(lat * Math.PI / 180) * Math.cos(lon * Math.PI / 180) * 5;
                    
                    return approximateDeclination;
                } catch (error) {
                    console.warn('Magnetic declination calculation failed:', error);
                    return 0;
                }
            }

            async checkAdvancedSupport() {
                const support = {
                    deviceorientation: 'DeviceOrientationEvent' in window,
                    devicemotion: 'DeviceMotionEvent' in window,
                    permissions: typeof DeviceOrientationEvent?.requestPermission === 'function',
                    webgl: this.checkWebGLSupport(),
                    sensors: await this.checkSensorAPI()
                };
                
                if (!support.deviceorientation) {
                    return { success: false, reason: 'Cihaz yönelim sensörü desteklenmiyor' };
                }
                
                if (!support.devicemotion) {
                    console.warn('Device motion not supported, using basic orientation only');
                }
                
                return { success: true, support };
            }

            checkWebGLSupport() {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(window.WebGLRenderingContext && canvas.getContext('webgl'));
                } catch (e) {
                    return false;
                }
            }

            async checkSensorAPI() {
                try {
                    return 'Sensor' in window;
                } catch (error) {
                    return false;
                }
            }

            async requestAllPermissions() {
                try {
                    const results = { success: true, permissions: {} };
                    
                    // Device Orientation Permission (iOS 13+)
                    if (typeof DeviceOrientationEvent?.requestPermission === 'function') {
                        try {
                            const permission = await DeviceOrientationEvent.requestPermission();
                            results.permissions.orientation = permission;
                            if (permission !== 'granted') {
                                results.success = false;
                            }
                        } catch (error) {
                            console.warn('Orientation permission failed:', error);
                            results.permissions.orientation = 'denied';
                            results.success = false;
                        }
                    } else {
                        results.permissions.orientation = 'not_required';
                    }
                    
                    // Device Motion Permission (iOS 13+)
                    if (typeof DeviceMotionEvent?.requestPermission === 'function') {
                        try {
                            const permission = await DeviceMotionEvent.requestPermission();
                            results.permissions.motion = permission;
                        } catch (error) {
                            console.warn('Motion permission failed:', error);
                            results.permissions.motion = 'denied';
                        }
                    } else {
                        results.permissions.motion = 'not_required';
                    }
                    
                    return results;
                } catch (error) {
                    console.error('Permission request failed:', error);
                    return { success: false, error: error.message };
                }
            }

            async initializeSensors() {
                try {
                    // Initialize sensor fusion system
                    this.sensors.isInitialized = true;
                    this.sensors.lastUpdate = performance.now();
                    
                    // Reset filter state
                    this.filter.history = [];
                    this.filter.lastValue = 0;
                    
                    utils.showToast('📱 Sensörler hazırlandı', 'info');
                } catch (error) {
                    console.warn('Sensor initialization failed:', error);
                }
            }

            startPrecisionTracking() {
                this.isActive = true;
                
                // High-precision orientation handler with sensor fusion
                this.orientationHandler = (event) => {
                    try {
                        if (!this.isActive) return;
                        
                        const now = performance.now();
                        const deltaTime = now - this.performance.lastUpdate;
                        
                        // Update performance metrics
                        this.performance.updateCount++;
                        this.performance.lastUpdate = now;
                        this.performance.averageInterval = 
                            (this.performance.averageInterval * 0.9) + (deltaTime * 0.1);
                        
                        // Extract raw sensor data
                        const rawHeading = this.extractHeading(event);
                        if (rawHeading === null) return;
                        
                        // Apply sensor fusion and filtering
                        const filteredHeading = this.applySensorFusion(rawHeading, deltaTime);
                        
                        // Update compass state
                        this.compass.heading = filteredHeading;
                        this.compass.accuracy = this.calculateAccuracy(event);
                        
                        // Apply magnetic declination correction
                        this.compass.trueHeading = this.compass.heading + this.qibla.magneticDeclination;
                        this.compass.trueHeading = (this.compass.trueHeading + 360) % 360;
                        
                        // Update compass display
                        this.updatePrecisionCompass();
                        
                        // Feed calibration system
                        this.feedCalibrationData(this.compass.heading);
                        
                    } catch (error) {
                        this.performance.errors++;
                        console.warn('Precision orientation handler error:', error);
                    }
                };
                
                // Enhanced motion handler for sensor fusion
                this.motionHandler = (event) => {
                    try {
                        if (!this.isActive) return;
                        
                        // Update sensor data for fusion
                        if (event.accelerationIncludingGravity) {
                            this.sensors.accelerometer = {
                                x: event.accelerationIncludingGravity.x || 0,
                                y: event.accelerationIncludingGravity.y || 0,
                                z: event.accelerationIncludingGravity.z || 0
                            };
                        }
                        
                        if (event.rotationRate) {
                            this.sensors.gyroscope = {
                                x: event.rotationRate.alpha || 0,
                                y: event.rotationRate.beta || 0,
                                z: event.rotationRate.gamma || 0
                            };
                        }
                        
                    } catch (error) {
                        console.warn('Motion handler error:', error);
                    }
                };
                
                // Add event listeners with optimized options
                window.addEventListener('deviceorientation', this.orientationHandler, 
                    { passive: true, capture: false });
                window.addEventListener('deviceorientationabsolute', this.orientationHandler, 
                    { passive: true, capture: false });
                window.addEventListener('devicemotion', this.motionHandler, 
                    { passive: true, capture: false });
                
                this.updateStatus('🎯 Hassas pusula aktif', '🔄');
            }

            extractHeading(event) {
                try {
                    let heading = null;
                    
                    // iOS - webkitCompassHeading (magnetic north, degrees)
                    if (event.webkitCompassHeading !== undefined && event.webkitCompassHeading !== null) {
                        heading = event.webkitCompassHeading;
                        this.compass.magneticHeading = heading;
                    }
                    // Android/Standard - alpha (rotation around z-axis)
                    else if (event.alpha !== undefined && event.alpha !== null) {
                        heading = 360 - event.alpha; // Convert to standard compass bearing
                        this.compass.magneticHeading = heading;
                    }
                    
                    // Validation
                    if (heading === null || isNaN(heading) || heading < 0 || heading >= 360) {
                        return null;
                    }
                    
                    return heading;
                } catch (error) {
                    console.warn('Heading extraction failed:', error);
                    return null;
                }
            }

            applySensorFusion(rawHeading, deltaTime) {
                try {
                    // Low-pass filter for smoothing
                    let filteredHeading = rawHeading;
                    
                    if (this.filter.history.length > 0) {
                        const lastHeading = this.filter.history[this.filter.history.length - 1];
                        
                        // Handle angle wrapping (359° to 1° transition)
                        let diff = rawHeading - lastHeading;
                        if (diff > 180) diff -= 360;
                        if (diff < -180) diff += 360;
                        
                        // Apply low-pass filter
                        filteredHeading = lastHeading + (diff * this.filter.alpha);
                        filteredHeading = (filteredHeading + 360) % 360;
                        
                        // Threshold filter - ignore small changes
                        if (Math.abs(diff) < this.filter.threshold) {
                            filteredHeading = lastHeading;
                        }
                    }
                    
                    // Update history
                    this.filter.history.push(filteredHeading);
                    if (this.filter.history.length > this.filter.maxHistory) {
                        this.filter.history.shift();
                    }
                    
                    return filteredHeading;
                } catch (error) {
                    console.warn('Sensor fusion failed:', error);
                    return rawHeading;
                }
            }

            calculateAccuracy(event) {
                try {
                    let accuracy = 'unknown';
                    
                    // iOS accuracy
                    if (event.webkitCompassAccuracy !== undefined) {
                        const acc = Math.abs(event.webkitCompassAccuracy);
                        if (acc < 5) accuracy = 'high';
                        else if (acc < 15) accuracy = 'medium';
                        else accuracy = 'low';
                    }
                    // Android - estimate from stability
                    else if (this.filter.history.length >= 5) {
                        const recent = this.filter.history.slice(-5);
                        const variance = this.calculateVariance(recent);
                        
                        if (variance < 2) accuracy = 'high';
                        else if (variance < 5) accuracy = 'medium';
                        else accuracy = 'low';
                    }
                    
                    return accuracy;
                } catch (error) {
                    console.warn('Accuracy calculation failed:', error);
                    return 'unknown';
                }
            }

            calculateVariance(values) {
                if (values.length < 2) return 0;
                
                const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
                const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
                
                return Math.sqrt(variance);
            }

            updatePrecisionCompass() {
                try {
                    // Calculate precise relative angle to Qibla
                    let relativeAngle = this.qibla.direction - this.compass.trueHeading;
                    relativeAngle = (relativeAngle + 360) % 360;
                    
                    // Smooth needle rotation with easing
                    const needle = document.getElementById('qiblaNeedle');
                    if (needle) {
                        const currentTransform = needle.style.transform;
                        const currentAngle = this.extractAngleFromTransform(currentTransform);
                        const angleDiff = this.getShortestAngleDiff(currentAngle, relativeAngle);
                        
                        // Apply smooth transition
                        needle.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                        needle.style.transform = `translate(-50%, -50%) rotate(${relativeAngle}deg)`;
                    }
                    
                    // Update angle display with precision
                    const angleEl = document.getElementById('qiblaAngle');
                    if (angleEl) {
                        angleEl.textContent = `${Math.round(relativeAngle * 10) / 10}°`;
                    }
                    
                    // Update precision feedback
                    this.updatePrecisionFeedback(relativeAngle);
                    
                } catch (error) {
                    console.warn('Precision compass update failed:', error);
                }
            }

            extractAngleFromTransform(transform) {
                if (!transform || !transform.includes('rotate')) return 0;
                
                const match = transform.match(/rotate\(([^)]+)deg\)/);
                return match ? parseFloat(match[1]) : 0;
            }

            getShortestAngleDiff(current, target) {
                let diff = target - current;
                if (diff > 180) diff -= 360;
                if (diff < -180) diff += 360;
                return diff;
            }

            updatePrecisionFeedback(angle) {
                try {
                    // Calculate precise proximity
                    let proximity = Math.min(angle, 360 - angle);
                    
                    let statusText = 'Yön aranıyor...';
                    let statusIcon = '🔍';
                    let statusColor = 'var(--tx2)';
                    let accuracyBonus = '';
                    
                    // Add accuracy indicator
                    switch (this.compass.accuracy) {
                        case 'high':
                            accuracyBonus = ' (Yüksek Hassasiyet)';
                            break;
                        case 'medium':
                            accuracyBonus = ' (Orta Hassasiyet)';
                            break;
                        case 'low':
                            accuracyBonus = ' (Düşük Hassasiyet)';
                            break;
                    }
                    
                    // Precision feedback with tighter tolerances
                    if (proximity <= 2) {
                        statusText = '🎯 MÜKEMMEL! Tam Kıble' + accuracyBonus;
                        statusIcon = '🎯';
                        statusColor = 'var(--qibla)';
                        
                        // Enhanced haptic feedback
                        if (navigator.vibrate) {
                            navigator.vibrate([100, 50, 100, 50, 100]);
                        }
                    } else if (proximity <= 5) {
                        statusText = '🔥 Çok İyi! Kıble Yakını' + accuracyBonus;
                        statusIcon = '🔥';
                        statusColor = 'var(--tour)';
                        
                        if (navigator.vibrate) {
                            navigator.vibrate([50, 30, 50]);
                        }
                    } else if (proximity <= 10) {
                        statusText = '👍 İyi Yön! Biraz Daha' + accuracyBonus;
                        statusIcon = '👍';
                        statusColor = 'var(--gold)';
                    } else if (proximity <= 30) {
                        statusText = '📍 Doğru Yönde İlerliyorsunuz';
                        statusIcon = '📍';
                        statusColor = 'var(--tx)';
                    } else {
                        statusText = '🔄 Cihazı Yavaşça Çevirin';
                        statusIcon = '🔄';
                        statusColor = 'var(--tx2)';
                    }
                    
                    this.updateStatus(statusText, statusIcon);
                    
                    // Update angle color with gradient
                    const angleEl = document.getElementById('qiblaAngle');
                    if (angleEl) {
                        angleEl.style.color = statusColor;
                        angleEl.style.textShadow = proximity <= 5 
                            ? `0 0 10px ${statusColor}` 
                            : 'none';
                    }
                    
                } catch (error) {
                    console.warn('Precision feedback update failed:', error);
                }
            }

            startAutoCalibration() {
                this.calibration.isCalibrating = true;
                this.calibration.samples = [];
                
                utils.showToast('🔧 Otomatik kalibrasyon başladı...', 'info');
                
                // Auto-calibration timeout
                setTimeout(() => {
                    if (this.calibration.isCalibrating) {
                        this.finishAutoCalibration();
                    }
                }, 30000); // 30 seconds
            }

            feedCalibrationData(heading) {
                if (!this.calibration.isCalibrating) return;
                
                this.calibration.samples.push({
                    heading: heading,
                    timestamp: performance.now(),
                    accuracy: this.compass.accuracy
                });
                
                // Check if we have enough samples
                if (this.calibration.samples.length >= this.calibration.requiredSamples) {
                    this.finishAutoCalibration();
                }
            }

            finishAutoCalibration() {
                this.calibration.isCalibrating = false;
                
                if (this.calibration.samples.length < 5) {
                    this.calibration.quality = 'insufficient';
                    utils.showToast('⚠️ Kalibrasyon verisi yetersiz', 'warning');
                    return;
                }
                
                // Analyze calibration quality
                const headings = this.calibration.samples.map(s => s.heading);
                this.calibration.variance = this.calculateVariance(headings);
                
                if (this.calibration.variance < 2) {
                    this.calibration.quality = 'excellent';
                    utils.showToast('✅ Mükemmel kalibrasyon tamamlandı', 'success');
                } else if (this.calibration.variance < 5) {
                    this.calibration.quality = 'good';
                    utils.showToast('✅ İyi kalibrasyon tamamlandı', 'success');
                } else {
                    this.calibration.quality = 'poor';
                    utils.showToast('⚠️ Düşük kaliteli kalibrasyon', 'warning');
                }
                
                this.compass.calibrationLevel = Math.max(0, 100 - (this.calibration.variance * 10));
            }

            stopTracking() {
                this.isActive = false;
                
                // Remove all event listeners
                if (this.orientationHandler) {
                    window.removeEventListener('deviceorientation', this.orientationHandler);
                    window.removeEventListener('deviceorientationabsolute', this.orientationHandler);
                }
                
                if (this.motionHandler) {
                    window.removeEventListener('devicemotion', this.motionHandler);
                }
                
                this.updateStatus('🛑 Hassas pusula durduruldu', '⏹️');
            }

            showManualCompass(reason = 'Otomatik pusula kullanılamıyor') {
                this.updateStatus(`📱 Manuel Mod: ${reason}`, '👆');
                
                const compassRing = document.getElementById('compassRing');
                if (compassRing) {
                    compassRing.style.cursor = 'pointer';
                    compassRing.onclick = (e) => this.handleManualClick(e);
                }
                
                this.addManualDirections();
                utils.showToast('📱 Manuel pusula modu etkinleştirildi', 'info');
            }

            addManualDirections() {
                const compassRing = document.getElementById('compassRing');
                if (!compassRing || compassRing.querySelector('.manual-directions')) return;

                const directions = document.createElement('div');
                directions.className = 'manual-directions';
                directions.innerHTML = `
                    <div style="position:absolute;top:8px;left:50%;transform:translateX(-50%);color:var(--tx);font-weight:800;font-size:16px;text-shadow:0 2px 4px rgba(0,0,0,0.5)">N</div>
                    <div style="position:absolute;right:8px;top:50%;transform:translateY(-50%);color:var(--tx);font-weight:800;font-size:16px;text-shadow:0 2px 4px rgba(0,0,0,0.5)">E</div>
                    <div style="position:absolute;bottom:8px;left:50%;transform:translateX(-50%);color:var(--tx);font-weight:800;font-size:16px;text-shadow:0 2px 4px rgba(0,0,0,0.5)">S</div>
                    <div style="position:absolute;left:8px;top:50%;transform:translateY(-50%);color:var(--tx);font-weight:800;font-size:16px;text-shadow:0 2px 4px rgba(0,0,0,0.5)">W</div>
                    
                    <div style="position:absolute;top:25px;right:25px;color:var(--tx2);font-weight:600;font-size:12px;transform:rotate(45deg)">NE</div>
                    <div style="position:absolute;bottom:25px;right:25px;color:var(--tx2);font-weight:600;font-size:12px;transform:rotate(135deg)">SE</div>
                    <div style="position:absolute;bottom:25px;left:25px;color:var(--tx2);font-weight:600;font-size:12px;transform:rotate(225deg)">SW</div>
                    <div style="position:absolute;top:25px;left:25px;color:var(--tx2);font-weight:600;font-size:12px;transform:rotate(315deg)">NW</div>
                `;
                compassRing.appendChild(directions);
            }

            handleManualClick(event) {
                try {
                    const rect = event.currentTarget.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    const x = event.clientX - centerX;
                    const y = event.clientY - centerY;
                    
                    // Calculate precise angle
                    let angle = Math.atan2(y, x) * 180 / Math.PI;
                    angle = (angle + 90 + 360) % 360;
                    
                    // Snap to nearest 5 degrees for better precision
                    angle = Math.round(angle / 5) * 5;
                    
                    this.compass.heading = angle;
                    this.compass.trueHeading = angle;
                    this.updatePrecisionCompass();
                    
                    utils.showToast(`🧭 Manuel yön: ${angle}°`, 'info');
                    
                    // Visual feedback
                    const ring = event.currentTarget;
                    ring.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        ring.style.transform = 'scale(1)';
                    }, 150);
                    
                } catch (error) {
                    console.warn('Manual compass click failed:', error);
                }
            }

            calibrate() {
                utils.showToast('🔄 Hassas kalibrasyon başlatılıyor...', 'info');
                
                // Reset all systems
                this.compass.heading = 0;
                this.compass.calibrationLevel = 0;
                this.filter.history = [];
                this.performance = { updateCount: 0, lastUpdate: 0, averageInterval: 0, errors: 0 };
                
                // Recalculate Qibla direction
                this.calculatePreciseQiblaDirection(appState.location.lat, appState.location.lon);
                
                // Restart auto-calibration
                this.startAutoCalibration();
                
                // Update display
                this.updatePrecisionCompass();
                
                setTimeout(() => {
                    utils.showToast('✅ Hassas kalibrasyon tamamlandı', 'success');
                }, 2000);
            }

            updateStatus(text, icon) {
                try {
                    const textEl = document.getElementById('compassStatusText');
                    const iconEl = document.getElementById('compassStatusIcon');

                    if (textEl) textEl.textContent = text;
                    if (iconEl) iconEl.textContent = icon;
                } catch (error) {
                    console.warn('Status update failed:', error);
                }
            }

            handleError(error) {
                console.error('QiblaManager error:', error);
                this.performance.errors++;
                
                if (this.performance.errors > 10) {
                    this.stopTracking();
                    this.showManualCompass('Çok fazla hata oluştu');
                    return;
                }
                
                utils.showToast('⚠️ Pusula hatası, manuel moda geçiliyor...', 'warning');
                this.showManualCompass('Sensör hatası');
            }

            // Public method to get current compass info
            getCompassInfo() {
                return {
                    heading: this.compass.heading,
                    trueHeading: this.compass.trueHeading,
                    accuracy: this.compass.accuracy,
                    calibrationLevel: this.compass.calibrationLevel,
                    qiblaDirection: this.qibla.direction,
                    qiblaDistance: this.qibla.distance,
                    performance: this.performance,
                    filter: {
                        variance: this.calculateVariance(this.filter.history),
                        historyLength: this.filter.history.length
                    }
                };
            }
        }

        // ============ CONTENT MANAGER ============
        class ContentManager {
            constructor() {
                this.dailyContent = {
                    hadith: [
                        { text: 'Ameller niyetlere göredir.', source: 'Buhârî' },
                        { text: 'Sabır cennetin anahtarıdır.', source: 'Tirmizî' },
                        { text: 'En güzel ahlaka sahip olan en hayırlınızdır.', source: 'Müslim' }
                    ],
                    duas: [
                        { text: 'Allahümme bike asbahna ve bike emsayna...', effect: 'Sabah korunma duası' },
                        { text: 'Radîtu billâhi rabben ve bil-Islâmi dînen...', effect: 'Rıza duası' },
                        { text: 'A\'ûzu bi\'llâhi mine\'ş-şeytâni\'r-racîm...', effect: 'Şeytandan korunma' }
                    ]
                };

                this.tours = [
                    { id: 'hac-luxury', title: 'Hac - Lüks', type: 'hac', date: '15 Ağustos 2025', plan: '8G Mekke + 6G Medine', price: '89.900₺', rating: 4.9 },
                    { id: 'umre-deluxe', title: 'Umre - Deluxe', type: 'umre', date: '10-18 Aralık 2025', plan: '5G Mekke + 3G Medine', price: '24.900₺', rating: 4.8 },
                    { id: 'umre-budget', title: 'Umre - Ekonomi', type: 'umre', date: '20-26 Ocak 2025', plan: '3G Mekke + 3G Medine', price: '14.900₺', rating: 4.6 }
                ];

                this.market = {
                    ihram: [
                        { title: 'İhram Takımı Premium', desc: '100% pamuk, kemer, çanta dahil', price: '749₺', rating: 4.8 },
                        { title: 'İhram Terliği', desc: 'Kaymaz taban, çok rahat', price: '299₺', rating: 4.7 }
                    ],
                    teknoloji: [
                        { title: 'Powerbank 30.000mAh', desc: 'Kablosuz şarj, güneş paneli', price: '699₺', rating: 4.9 },
                        { title: 'Akıllı Kıble Saati', desc: 'GPS, namaz vakti, kıble', price: '1.299₺', rating: 4.8 }
                    ],
                    namaz: [
                        { title: 'Seccade Premium', desc: 'Su geçirmez, portatif, kompas', price: '199₺', rating: 4.9 },
                        { title: 'Namaz Kıyafeti Seti', desc: 'Kadın/erkek, çeşitli renkler', price: '449₺', rating: 4.6 }
                    ],
                    zikir: [
                        { title: 'Tespih & Zikirmatik', desc: 'Hediye kutulu, 99\'luk, dijital', price: '299₺', rating: 4.8 },
                        { title: 'Kur\'an-ı Kerim Mushaf', desc: 'Orta boy, Osmanlı hattı', price: '149₺', rating: 4.9 }
                    ]
                };

                this.quranSuras = [
                    { number: 1, name: 'Fâtiha', arabic: 'الفاتحة', ayatCount: 7, meaning: 'Açılış' },
                    { number: 2, name: 'Bakara', arabic: 'البقرة', ayatCount: 286, meaning: 'İnek' },
                    { number: 36, name: 'Yâsîn', arabic: 'يس', ayatCount: 83, meaning: 'Yâ Sîn' },
                    { number: 112, name: 'İhlâs', arabic: 'الإخلاص', ayatCount: 4, meaning: 'Samimiyet' }
                ];

                this.hadithCollection = [
                    { category: 'all', title: 'Niyet', text: 'Ameller niyetlere göredir.', source: 'Buhârî', explanation: 'Her amelin değeri niyete bağlıdır.' },
                    { category: 'sabir', title: 'Sabır', text: 'Sabır cennetin anahtarıdır.', source: 'Tirmizî', explanation: 'Sabır hem dünyada hem ahirette mükafata vesile olan en büyük erdemlerden biridir.' },
                    { category: 'rahmet', title: 'Rahmet', text: 'Allah\'ın rahmeti gazabından önce gelir.', source: 'Buhârî', explanation: 'Allah\'ın sonsuz merhametinin gazabından daha üstün olduğunu bildiren hadis.' },
                    { category: 'ahlak', title: 'Güzel Ahlak', text: 'En güzel ahlaka sahip olan en hayırlınızdır.', source: 'Müslim', explanation: 'İnsanın değeri güzel ahlakıyla ölçülür.' }
                ];

                this.duaCategories = {
                    sabah: [
                        { title: 'Âyetü\'l-Kürsî', dua: 'Allahu lâ ilâhe illâ huve\'l-hayyu\'l-kayyûm...', effect: 'Sabah okuyan akşama kadar korunur' },
                        { title: 'Sabah Duası', dua: 'Allahümme bike asbahna ve bike emsayna...', effect: 'Günlük korunma ve bereket' }
                    ],
                    namaz: [
                        { title: 'Tesbihat 33-33-34', dua: 'Sübhanallah (33) • Elhamdülillah (33) • Allahu Ekber (34)', effect: 'Namaz sonrası sünnet zikir' },
                        { title: 'Namaz Sonrası Dua', dua: 'Allahümme a\'innî alâ zikrike ve şükrike...', effect: 'Namazın kabulü için' }
                    ],
                    uyku: [
                        { title: 'Felâk & Nâs', dua: 'Avuçlara üflenip okunur, vücuda mesh edilir.', effect: 'Gece boyunca korunma sağlar' },
                        { title: 'Uyku Duası', dua: 'Allahümme bismike emûtu ve ahyâ...', effect: 'Huzurlu uyku ve güzel rüyalar' }
                    ],
                    seyahat: [
                        { title: 'Seyahat Duası', dua: 'Sübhanallezi sehhara lena hâzâ...', effect: 'Yolculuk öncesi okunur' },
                        { title: 'Yolculuk Korunma', dua: 'A\'ûzu bi kelimâtillâhi\'t-tâmmâti...', effect: 'Yol emniyeti için' }
                    ]
                };

                this.manasikGuides = {
                    umrah: [
                        { 
                            step: 1, 
                            title: 'Umre Hazırlığı ve Niyet', 
                            desc: 'Umre\'ye çıkmadan önce ruhsal ve fiziksel hazırlık yapın', 
                            details: '🎯 Umre\'nin tanımı:\n• Küçük hac olarak da bilinir\n• Sünnet ibadet (müstehab)\n• Yılın her zamanında yapılabilir\n• Ramazan umresi hac sevabında\n\n📚 Umre öncesi öğrenilecekler:\n• Umre menasiki (Tavaf, Sa\'y, Tıraş)\n• İhram kuralları ve yasaklar\n• Umre duaları ve zikirler\n• Mekke ve Medine adabı\n\n🤲 Ruhsal hazırlık:\n• Samimi niyet yapın (sadece Allah rızası)\n• Günahlarınızdan tevbe edin\n• Borçlarınızı ödeyin\n• Yakınlarınızdan helal alın\n• Çok istığfar edin\n\n💡 Pratik hazırlık:\n• İhram kıyafetleri hazırlayın\n• Kokusuz sabun ve şampuan alın\n• Namaz vaktinde Mekke\'ye ulaşmaya çalışın' 
                        },
                        { 
                            step: 2, 
                            title: 'Mikat\'tan İhrama Giriş', 
                            desc: 'Mikat noktalarından birinden ihrama girin ve umre niyeti yapın', 
                            details: '🗺️ Mikat noktaları:\n• Zü\'l-Huleyfe (Âbyâr Ali) - Medine yakını\n• Cuhfe (Rabig) - Kuzey ve batıdan gelenler\n• Karnü\'l-Menazil - Doğudan gelenler\n• Yelemleme - Güneydoğudan gelenler\n• Zatü İrk - Kuzeydoğudan gelenler\n\n🧼 İhram öncesi temizlik:\n• Gusül abdesti alın\n• Diş fırçalayın\n• Tırnak ve saçınızı kesin/düzeltin\n• Vücut kıllarını alın (isteyenler)\n• Koku kullanın (ihramdan önce)\n\n👔 İhram kıyafeti:\n• Erkekler: 2 parça dikişsiz beyaz örtü\n  - İzar (alt kısım): Bel ve diz arası\n  - Rida (üst kısım): Göğüs ve omuzlar\n• Kadınlar: Normal kapalı kıyafetler\n• Ayakkabı: Topuk ve ayak üstü açık\n\n🤲 İhram niyeti ve telbiye:\n• Niyet: "Lebbeyk Allahümme Umreten"\n• Telbiye: "Lebbeyk Allahümme lebbeyk, lebbeyk lâ şerike leke lebbeyk, inne\'l-hamde ve\'n-ni\'mete leke ve\'l-mülk, lâ şerike lek"\n\n❌ İhramlıyken yasaklar:\n• Koku kullanmak • Saç/tırnak kesmek • Avlanmak • Cinsel ilişki • Evlenmek • Erkekler başını örtmek • Kadınlar yüzünü/ellerini örtmek' 
                        },
                        { 
                            step: 3, 
                            title: 'Mekke\'ye Varış ve Harem\'e Giriş', 
                            desc: 'Mekke şehrine varış ve Mescid-i Haram\'a giriş adabı', 
                            details: '🕌 Mekke\'ye giriş:\n• Sağ ayakla Harem\'e girin\n• "Bismillahi ve\'s-selâtu ve\'s-selâmu alâ Rasûlillah" deyin\n• Alçakgönüllü ve saygılı olun\n• Kalabalıkta sıkıştırmayın\n\n👀 İlk Kabe görüşü:\n• Kabe\'yi ilk gördüğünüzde durun\n• "Allahu Ekber" deyin\n• Kalbi bir dua edin\n• Tavafa hazırlanın\n\n📿 Giriş duası:\n"Allahümme iftah lî ebvâbe rahmetike"\n(Allah\'ım! Rahmet kapılarını aç)\n\n🚶‍♂️ Hareket kuralları:\n• Yavaş ve sakin yürüyün\n• Diğer hacılara saygı gösterin\n• Fotoğraf çekerken başkalarını rahatsız etmeyin\n• Çantanızı güvenli tutun' 
                        },
                        { 
                            step: 4, 
                            title: 'Tavaf-ı Umre (7 Şavt)', 
                            desc: 'Kabe\'yi 7 kez tavaf edin - Umre\'nin en önemli rüknü', 
                            details: '🔄 Tavaf kuralları:\n• Haceru\'l-Esved\'den başlayın\n• Kabe\'yi sol tarafınızda tutun\n• 7 tam tur atın\n• Mümkünse Haceru\'l-Esved\'i öpün\n\n📍 Başlangıç noktası:\n• Haceru\'l-Esved hizasında durun\n• Sağ elinizi taşa doğru uzatın\n• "Bismillahi Allahu Ekber" deyin\n• İlk şavta başlayın\n\n🚶‍♂️ Tavaf şekli:\n• İlk 3 şavt: Hızlı yürüyün (Erkekler)\n• Son 4 şavt: Normal tempo\n• Kadınlar hep normal tempo\n• Kalabalıkta zorlamayın\n\n🤲 Tavaf duaları:\n• Her şavtta farklı dua okuyun\n• Kur\'an ayetleri okuyun\n• Kişisel dualarınızı edin\n• Rukn-i Yemâni ile Haceru\'l-Esved arası:\n"Rabbenâ âtinâ fi\'d-dünyâ hasenetev ve fi\'l-âhirati hasenetev ve kinâ azâbe\'n-nâr"' 
                        },
                        { 
                            step: 5, 
                            title: 'Makam-ı İbrahim\'de 2 Rekat Namaz', 
                            desc: 'Tavaf sonrası Makam-ı İbrahim arkasında namaz kılın', 
                            details: '🕌 Makam-ı İbrahim:\n• Hz. İbrahim\'in ayak izi\n• Cam mahfaza içinde korunuyor\n• Mümkünse arkasında namaz kılın\n• Kalabalıksa uzaktan da olabilir\n\n🙏 2 Rekat namaz:\n• 1. Rekatta: Fâtiha + Kâfirûn\n• 2. Rekatta: Fâtiha + İhlâs\n• Secde uzun tutun\n• Dua için zaman ayırın\n\n📿 Namaz sonrası:\n• Zemzem suyu için\n• Dua edin\n• Sa\'y için hazırlanın\n• Abdestinizi kontrol edin\n\n⚠️ Önemli notlar:\n• Makam çok kalabalıksa başka yerde kılabilirsiniz\n• Namazı geciktirmeyin\n• 2 rekat farz, fazlası sünnet\n• Cemaatle kılmaya gerek yok' 
                        },
                        { 
                            step: 6, 
                            title: 'Zemzem Suyu İçme', 
                            desc: 'Kutsal Zemzem suyundan içip dua edin', 
                            details: '💧 Zemzem\'in fazileti:\n• Hz. İsmail için çıkan su\n• Binlerce yıldır akmaya devam ediyor\n• Şifa ve bereket kaynağı\n• İçtiğiniz niyet için faydalı\n\n🥤 İçme adabı:\n• Besmele çekerek başlayın\n• Sağ elinizle tutun\n• Kıbleye dönük için\n• Üç nefeste için\n• Karnınız doyuncaya kadar için\n\n🤲 Zemzem duası:\n"Allahümme innî es\'eluke \'ilmen nâfi\'an ve rizkan vâsi\'an ve şifâ\'en min kulli dâ\'in"\n(Allah\'ım! Senden faydalı ilim, bol rızık ve her hastalıktan şifa istiyorum)\n\n🎯 Niyetler:\n• Ahiret için: Cennet\n• Dünya için: Sağlık, rızık\n• İlim için: Hidayet\n• Aile için: Bereket' 
                        },
                        { 
                            step: 7, 
                            title: 'Sa\'y (Safa-Merve Arası 7 Kez)', 
                            desc: 'Safa ve Merve tepeleri arasında Hz. Hacer\'in arayışını canlandırın', 
                            details: '🏔️ Sa\'y\'ın anlamı:\n• Hz. Hacer\'in su arayışı\n• Allah\'a güven ve tevekkül\n• Sabır ve sebep-sonuç ilişkisi\n• 7 kez mekik dokumak\n\n📍 Sa\'y güzergahı:\n• Safa tepesinden başlayın\n• Merve\'ye doğru yürüyün = 1\n• Merve\'den Safa\'ya = 2\n• Böylece 7 kez tamamlayın\n• Merve\'de bitirin\n\n🚶‍♂️ Yürüyüş şekli:\n• Normal tempo yürüyün\n• Yeşil ışıklar arası: Hızlı yürüyün (Erkekler)\n• Dua ederek ilerleyin\n• Acele etmeyin\n\n🤲 Sa\'y duaları:\n• Safa\'da: "İnne\'s-safâ ve\'l-mervete min şa\'âirillâh"\n• Her tepede: "Lâ ilâhe illallahu vahdehû lâ şerîke leh..."\n• Yolda: Kişisel dualar\n• Merve\'de: Umre tamamlanma duası' 
                        },
                        { 
                            step: 8, 
                            title: 'Tıraş veya Saç Kısaltma', 
                            desc: 'İhramdan çıkmak için saçınızı kesin veya kısaltın', 
                            details: '✂️ Tıraş/kısaltma kuralları:\n• Erkekler: Tamamen tıraş (efdaldir) veya kısaltma\n• Kadınlar: Sadece parmak ucu kadar kısaltma\n• Tüm saçtan eşit oranda alın\n• Temiz araçlar kullanın\n\n🔄 İhramdan çıkış:\n• Saç kesildikten sonra ihram biter\n• Normal kıyafetlerinizi giyebilirsiniz\n• Tüm yasaklar kalkar\n• Koku kullanabilirsiniz\n\n🏢 Nerede yapılır:\n• Harem\'de berber salonu\n• Otel\'de kendimiz\n• Grup liderimizle birlikte\n• Higiyen kurallarına dikkat\n\n🎉 Umre tamamlandı:\n• Allah\'a hamd edin\n• Kabul duası yapın\n• Sevdikleriniz için dua edin\n• Tebrik alın ve verin' 
                        },
                        { 
                            step: 9, 
                            title: 'Tavaf-ı Vedâ (İhtiyari)', 
                            desc: 'Mekke\'den ayrılmadan önce veda tavafı yapabilirsiniz', 
                            details: '🔄 Tavaf-ı Vedâ:\n• Umre için farz değil\n• Ancak çok sevaplı\n• Mekke\'den ayrılırken\n• Son ziyaret tavafı\n\n📋 Tavaf kuralları:\n• Normal tavaf gibi 7 şavt\n• Makam-ı İbrahim\'de 2 rekat\n• Zemzem içmek\n• Dua ve istiğfar\n\n🤲 Veda duaları:\n"Allahümme lâ tac\'alhû âhire\'l-ahdi min beytike\'l-harâm"\n(Allah\'ım! Bunu Beyt-i Haram\'dan son ahdim kılma)\n\n💡 Faydaları:\n• Sevap kazanımı\n• Bereketle ayrılma\n• Tekrar gelme duası\n• Günahların bağışlanması\n\n⚠️ Önemli:\n• Tavaftan sonra Mekke\'den hemen çıkın\n• Alışveriş için geri dönmeyin\n• Bu son ziyaret olsun' 
                        },
                        { 
                            step: 10, 
                            title: 'Medine Ziyareti ve Dönüş', 
                            desc: 'Hz. Peygamber\'in şehri Medine\'yi ziyaret edin', 
                            details: '🕌 Medine ziyareti:\n• Umre\'nin parçası değil\n• Ancak büyük sevap\n• Hz. Peygamber\'in şehri\n• Mescid-i Nebevi ziyareti\n\n📿 Medine\'de yapılacaklar:\n• Mescid-i Nebevi\'de namaz\n• Ravza-i Mutahhara ziyareti\n• Hz. Peygamber\'e selam\n• Sahabe kabirleri ziyareti\n\n🤲 Ziyaret adabı:\n• Saygılı ve alçakgönüllü olun\n• Yüksek sesle konuşmayın\n• Dua ve salavat getirin\n• Tavaf yapmayın (bid\'at)\n\n🎯 Medine duaları:\n• "Es-selâmu aleyke yâ Rasûlallah"\n• Aileniz için salâvat\n• İslâm\'ın yayılması için\n• Dünya barışı için dua\n\n✈️ Dönüş hazırlığı:\n• Hediyeler alın\n• Son duaları yapın\n• Teşekkür edin\n• Güvenli yolculuk duası' 
                        }
                    ],
                    hac: [
                        { 
                            step: 1, 
                            title: 'Hac Hazırlığı ve Niyet', 
                            desc: 'Hac için fiziksel, ruhsal ve mali hazırlığınızı yapın', 
                            details: '🎯 Hac\'ın önemi:\n• İslam\'ın 5 şartından biri\n• Gücü yeten her müslüman için farz\n• Ömürde bir kez yapılması yeterli\n• Kabul olursa tüm günahları siler\n\n💰 Mali hazırlık:\n• Helal para biriktirin\n• Borçlarınızı ödeyin\n• Ailenizin geçimini sağlayın\n• Hac masraflarını hesaplayın\n\n💪 Fiziksel hazırlık:\n• Sağlık kontrolü yaptırın\n• Yürüyüş egzersizi yapın\n• Gerekli ilaçları alın\n• Hac aşılarını olun\n\n🤲 Ruhsal hazırlık:\n• Samimi niyet yapın\n• Günahlarınızdan tevbe edin\n• Hac menasikini öğrenin\n• Yakınlarınızdan helal alın' 
                        },
                        { 
                            step: 2, 
                            title: 'Yolculuk ve Mikat\'a Varış', 
                            desc: 'Hac yolculuğuna çıkın ve mikat noktasına ulaşın', 
                            details: '✈️ Yolculuk hazırlığı:\n• Gerekli evrakları hazırlayın\n• İhram kıyafetlerini pakete koyun\n• Hac rehberini yanınızda taşıyın\n• Grup liderinizi tanıyın\n\n🗺️ Mikat noktaları:\n• Zü\'l-Huleyfe (Âbyâr Ali) - Medine\'den gelenler\n• Cuhfe (Rabig) - Kuzey/batı\n• Karnü\'l-Menazil - Doğu\n• Yelemleme - Güneydoğu\n• Zatü İrk - Kuzeydoğu\n\n🛫 Hava yoluyla gelenler:\n• İhrama uçakta girebilirsiniz\n• Cüdde havaalanı öncesi\n• Güvenlik için önceden giyin\n• Telbiye getirmeye başlayın\n\n⚠️ Önemli uyarılar:\n• Mikatı geçmeden ihrama girin\n• Aksi halde dem (kefaret) gerekir\n• Rehberinizi takip edin\n• Pasaport ve belgelerinizi koruyun' 
                        },
                        { 
                            step: 3, 
                            title: 'İhrama Giriş ve Telbiye', 
                            desc: 'Hac için ihrama girin ve telbiye getirmeye başlayın', 
                            details: '🧼 İhram öncesi temizlik:\n• Gusül abdesti alın\n• Diş fırçalayın\n• Tırnak kesin\n• Vücut kıllarını alın\n• Koku kullanın (ihram öncesi)\n\n👔 İhram kıyafeti:\n• Erkekler: 2 beyaz örtü (dikişsiz)\n  - İzar: Alt vücut\n  - Rida: Üst vücut\n• Kadınlar: Normal kapalı kıyafet\n• Terlik: Topuk açık\n\n🤲 Hac niyeti:\n• "Lebbeyk Allahümme Hacce"\n• Kıran haccı: "Lebbeyk Allahümme Umreten ve Hacce"\n• Temettü: Önce umre niyeti\n\n📿 Telbiye duası:\n"Lebbeyk Allahümme lebbeyk, lebbeyk lâ şerîke leke lebbeyk, inne\'l-hamde ve\'n-ni\'mete leke ve\'l-mülk, lâ şerîke lek"\n\n❌ İhram yasakları:\n• Koku • Tırnak/saç kesme • Avlanma • Cinsel ilişki • Evlenme • Erkekler: Başını örtme • Kadınlar: Yüz/el örtme' 
                        },
                        { 
                            step: 4, 
                            title: 'Mekke\'ye Varış ve Tavaf-ı Kudûm', 
                            desc: 'Mekke\'ye varın ve ilk tavafınızı gerçekleştirin', 
                            details: '🕌 Mekke\'ye giriş:\n• "Allahümme iftah lî ebvâbe rahmetike" duası\n• Alçakgönüllülükle girin\n• Kabe\'yi ilk görüşte dua edin\n• Fotoğraf çekerken saygılı olun\n\n🔄 Tavaf-ı Kudûm:\n• İfrad ve Kıran haccında sünnet\n• Temettü\'da umre tavafı yapılır\n• 7 şavt tavaf\n• Haceru\'l-Esved\'den başlayın\n\n🚶‍♂️ Tavaf kuralları:\n• İlk 3 şavt hızlı (Erkekler - Remel)\n• Son 4 şavt normal tempo\n• Sol omuzunuz açık (Erkekler - İdtıba)\n• Kabe\'yi sol tarafınızda tutun\n\n🤲 Tavaf duaları:\n• Her şavtta farklı dua\n• Rukn-i Yemâni-Haceru\'l-Esved arası:\n"Rabbenâ âtinâ fi\'d-dünyâ hasene..."\n• Kişisel dualarınızı yapın\n\n🙏 Tavaf sonrası:\n• Makam-ı İbrahim\'de 2 rekat\n• Zemzem için\n• Sa\'y için hazırlanın' 
                        },
                        { 
                            step: 5, 
                            title: 'Sa\'y (Safa-Merve Arası)', 
                            desc: 'Safa ve Merve arasında 7 kez sa\'y yapın', 
                            details: '🏔️ Sa\'y\'ın hikayesi:\n• Hz. Hacer\'in su arayışı\n• Hz. İsmail için koşuşturma\n• Zemzem\'in çıkışına vesile\n• Sabır ve tevekkülün sembolü\n\n📍 Sa\'y güzergahı:\n• Safa tepesinden başlayın\n• Merve\'ye yürüyün = 1\n• Merve\'den Safa\'ya = 2\n• Toplam 7 gidiş-geliş\n• Merve\'de bitirin\n\n🚶‍♂️ Sa\'y adabı:\n• Safa\'da Kabe\'ye dönük dua\n• "İnne\'s-safâ ve\'l-mervete min şa\'âirillâh"\n• Yeşil ışıklar arası koşu (Erkekler)\n• Dua ederek yürüyün\n\n🤲 Sa\'y duaları:\n• Her tepede: "Lâ ilâhe illallahu vahdeh..."\n• Yolda: Kişisel dualar\n• Aile için bereket duası\n• İslam ümmetinin birliği için\n\n⚠️ Önemli:\n• Sa\'y tavafın sonrasında yapılır\n• Abdest şart değil\n• Tekerlek sandalye kullanılabilir\n• Temizlik arasında yapılabilir' 
                        },
                        { 
                            step: 6, 
                            title: 'Mina\'ya Çıkış', 
                            desc: '8 Zilhicce (Terviye Günü) Mina\'ya geçin', 
                            details: '📅 Terviye günü (8 Zilhicce):\n• Hac resmi olarak başlar\n• Mina\'ya hareket günü\n• Çadırların kurulduğu yer\n• Gece Mina\'da geçirilir\n\n🏕️ Mina\'da konaklama:\n• Hacılar için ayrılan çadır alanları\n• Grup rehberinizi takip edin\n• Çadır numaranızı ezberleyin\n• Kişisel eşyalarınızı koruyun\n\n🙏 Mina\'da yapılacaklar:\n• 5 vakit namaz (Kasr - kısaltarak)\n• Çok dua ve zikir\n• Kur\'an okuma\n• Ertesi gün için hazırlık\n\n📿 Özel ameller:\n• Telbiye getirmeye devam\n• İstighfar çok yapın\n• Salavat getirin\n• Sabır ve şükür gösterin\n\n⚠️ Dikkat edilecekler:\n• Çadırdan uzaklaşmayın\n• Grup liderinizle iletişimi kesin\n• Su ve beslenmeye dikkat\n• Erken uyuyun (Arafat için)' 
                        },
                        { 
                            step: 7, 
                            title: 'Arafat Vakfesi', 
                            desc: '9 Zilhicce günü Arafat\'ta vakfe yapın - Hac\'ın en önemli rüknü', 
                            details: '⛰️ Arafat günü (9 Zilhicce):\n• Hac\'ın en önemli rüknü\n• "Hac Arafat\'tır" hadisi\n• Öğle vaktinden günbatımına kadar\n• Kaçırılırsa hac geçersiz\n\n📍 Arafat sınırları:\n• Nemire Mescidi ve çevresi\n• Rahmet Tepesi (Cebel-i Rahme)\n• Sınır levhaları dikkatli takip\n• Sınır dışı kalırsanız hac olmaz\n\n🙏 Vakfe\'nin adabı:\n• Kıbleye dönük dua\n• Eller açık dua etme\n• Ağlayarak yakarış\n• Tövbe ve istiğfar\n\n🤲 Arafat duaları:\n• "Lâ ilâhe illallahu vahdehû lâ şerîke leh..."\n• "Allahümme a\'tikni min en-nâr"\n• Kişisel ve ümmet için dualar\n• Tüm günahların affı için\n\n⏰ Vakfe vakti:\n• Öğle ezanından başlar\n• Güneş batımına kadar\n• Son ana kadar durmayın\n• Günbatımından sonra ayrılın\n\n💡 Tavsiyeler:\n• Gölgeli yerde durun\n• Su tüketimini arttırın\n• Günbatımına kadar sabır\n• Bu fırsat için çok dua edin' 
                        },
                        { 
                            step: 8, 
                            title: 'Müzdelife\'de Konaklama', 
                            desc: 'Arafat\'tan sonra Müzdelife\'de gece geçirin', 
                            details: '🌙 Müzdelife gecesi:\n• Arafat\'tan sonra akşam ibadetgahı\n• Açık havada gecelik\n• Akşam ve yatsı namazını birleştir\n• Fecre kadar dua ve ibadet\n\n🙏 Müzdelife\'de yapılacaklar:\n• Akşam-Yatsı namazını yatsı vaktinde birleştirerek kıl\n• Çok istighfar yap\n• Kur\'an oku\n• Dua et\n• Mescidu\'l-Haram\'a çevril\n\n🪨 Çakıl taşı toplama:\n• Cemre atmak için 70 taş toplayın\n• Nohut büyüklüğünde\n• Temiz taşlar seçin\n• Her gün için ayrı ayrı saklayın\n\n⏰ Müzdelife vakitleri:\n• Gece geçirmek vacip\n• En az yarım saat kalın\n• Fecir namazını kılın\n• Güneş doğmadan önce ayrılın\n\n💡 Önemli notlar:\n• Hastalık durumunda erken ayrılabilir\n• Kadınlar ve yaşlılar gece yarısından sonra\n• Çadır kurmaya gerek yok\n• Battaniye ve su getirin\n\n🤲 Müzdelife duaları:\n• "Allahümme hâzihi Cam\'un..."\n• Sabaha kadar istiğfar\n• Aile ve ümmet için dua\n• Hac kabulü için yalvarış' 
                        },
                        { 
                            step: 9, 
                            title: 'Cemre Atma - İlk Gün', 
                            desc: '10 Zilhicce günü sadece Cemre-i Akabe\'ye taş atın', 
                            details: '🪨 Cemre-i Akabe (Büyük Cemre):\n• 10 Zilhicce günü sadece bu cemre\n• 7 taş atılır\n• "Allahu Ekber" denilerek\n• Şeytana lanet okumanın sembolü\n\n📍 Cemre-i Akabe\'nin yeri:\n• Mina\'da en son cemre\n• Mekke\'ye en yakın\n• Büyük beyaz direk\n• Kalabalık olur, sabırlı olun\n\n🎯 Atış kuralları:\n• Güneş doğduktan sonra\n• 7 taş tek tek\n• Her taşla "Allahu Ekber"\n• Dereceye değmesi yeterli\n\n🕐 Atış zamanı:\n• Güneş doğumundan günbatımına\n• Öğleden sonra daha az kalabalık\n• Akşam namazından önce bitirin\n• Geç kalanlar gece de atabilir\n\n⚠️ Güvenlik kuralları:\n• Kalabalıkta itmeleyin\n• Düşen olursa yardım edin\n• Çok yakından atmayın\n• Acele etmeyin\n\n🤲 Cemre duaları:\n• "Allahu Ekber" (her taşta)\n• "A\'ûzu billâhi mine\'ş-şeytân"\n• Şeytanın vesveselerinden korunma\n• Günahların temizlenmesi için\n\n💡 Pratik bilgiler:\n• Taşı sıkıca tutun\n• Alt seviyeden atmak daha kolay\n• Engelli ve hastalar vekil gönderebilir\n• Atıştan sonra dua yapmayın' 
                        },
                        { 
                            step: 10, 
                            title: 'Kurban Kesme ve Tıraş', 
                            desc: 'Cemre attıktan sonra kurban kesin ve traş olun', 
                            details: '🐑 Kurban kesme:\n• Cemre attıktan sonra\n• Deve, sığır, koyun, keçi\n• Kıran ve Temettü haccında vacip\n• İfrad haccında sünnet\n\n📋 Kurban kuralları:\n• Sağlıklı ve kusursuz hayvan\n• Yaş şartlarına uygun\n• Helal yoldan alınmış\n• Kendi elinizle kesmek sünnet\n\n🏢 Modern uygulama:\n• Kurban kuponları satın alın\n• Özel kesimhanelerde\n• Hijyenik şartlarda\n• Etler fakirlere dağıtılır\n\n✂️ Tıraş olma:\n• Kurban kestikten sonra\n• Erkekler: Tamamen tıraş (efdaldir)\n• Kadınlar: Parmak ucu kadar kısaltma\n• Temiz araçlar kullanın\n\n🔄 İhramdan çıkış (Tahallül-i Asgâr):\n• Tıraş sonrası kısmi çıkış\n• Normal kıyafetler giyebilirsiniz\n• Koku kullanabilirsiniz\n• Eş ilişkisi hariç her şey helal\n\n⚠️ Sıralama önemli:\n1. Cemre atma\n2. Kurban kesme\n3. Tıraş olma\n4. Tavaf-ı Ziyaret\n\n🤲 Kurban duaları:\n• "Bismillahi Allahu Ekber"\n• "Allahümme mink ve lek"\n• Kabul duası\n• Fukara için bereket duası' 
                        },
                        { 
                            step: 11, 
                            title: 'Tavaf-ı Ziyaret (İfâda)', 
                            desc: 'Hac\'ın farz tavafını gerçekleştirin', 
                            details: '🔄 Tavaf-ı Ziyaret:\n• Hac\'ın farz rüknü\n• Mutlaka yapılması gerekir\n• 10-12 Zilhicce arası\n• Yapmayan haccı geçersiz\n\n📍 Tavaf zamanı:\n• En iyisi 10 Zilhicce\n• Cemre-kurban-tıraş sonrası\n• Mina dönüşü de olabilir\n• 12 Zilhicce günbatımına kadar\n\n🕌 Tavaf kuralları:\n• 7 şavt tavaf\n• Remel yok (hızlı yürüme)\n• İdtıba yok (omuz açma)\n• Normal tempo ile\n\n🙏 Tavaf sonrası:\n• Makam-ı İbrahim\'de 2 rekat\n• Zemzem içme\n• Sa\'y (gerekirse)\n• Dua ve şükür\n\n🔄 Tahallül-i Ekber:\n• Tavaftan sonra tam ihramdan çıkış\n• Eş ilişkisi de helal olur\n• Tüm yasaklar kalkar\n• Normal hayata dönüş\n\n📿 Sa\'y durumu:\n• Temettü haccında: Tekrar sa\'y\n• Kıran haccında: Sa\'y varsa gerekmez\n• İfrad haccında: Sa\'y gerekir\n\n⚠️ Önemli uyarı:\n• Bu tavafı kaçırmayın\n• Hac\'ın rüknüdür\n• Yapmayan haccı olmaz\n• Zamanında yapın' 
                        },
                        { 
                            step: 12, 
                            title: 'Mina\'da Son Günler', 
                            desc: '11-12 Zilhicce günleri Mina\'da kalın ve cemre atın', 
                            details: '🏕️ Mina\'da son günler:\n• 11-12-13 Zilhicce (Teşrik günleri)\n• En az 2 gün kalın\n• 3 cemreye de taş atın\n• Her gün 21 taş (3x7)\n\n🪨 Üç cemre sırası:\n1. Cemre-i Ûlâ (Küçük)\n2. Cemre-i Vustâ (Orta)\n3. Cemre-i Akabe (Büyük)\n\n⏰ Atış vakitleri:\n• Güneş meridyene geçtikten sonra\n• Öğle namazından sonra\n• Akşama kadar\n• Her cemre 7 taş\n\n🎯 Atış adabı:\n• Her cemreye sırayla\n• 7 taş tek tek\n• "Allahu Ekber" diyerek\n• İlk iki cemrede dua\n\n🤲 Cemre arası dualar:\n• 1. ve 2. cemre sonrası uzun dua\n• Kıbleye dönük\n• Eller açık\n• 3. cemre sonrası dua yok\n\n🕌 Mina\'da yapılacaklar:\n• 5 vakit namazı kıl\n• Kur\'an okumaya devam\n• Çok zikir ve istiğfar\n• Hac arkadaşlarıyla sohbet\n\n📅 Ayrılış kararı:\n• 12 Zilhicce gidebilirsiniz\n• 13 Zilhicce kalabilirsiniz (efdaldir)\n• Güneş batmadan karar verin\n• Kalanlar 13\'te de cemre atar\n\n💡 Son gün tavsiyeleri:\n• Sabırlı olun\n• Kalabalığa katlanın\n• Sevap için niyetinizi tazeleyin\n• Hac\'ın son günlerini değerlendirin' 
                        },
                        { 
                            step: 13, 
                            title: 'Tavaf-ı Vedâ', 
                            desc: 'Mekke\'den ayrılmadan önce veda tavafını yapın', 
                            details: '🔄 Tavaf-ı Vedâ:\n• Mekke\'den ayrılmanın şartı\n• Hac\'ın son farz ameli\n• Yapmayanın kefaret ödemesi gerekir\n• Muhteşem bir veda\n\n📋 Veda tavafı kuralları:\n• 7 şavt normal tavaf\n• Remel ve İdtıba yok\n• Makam-ı İbrahim\'de 2 rekat\n• Zemzem içme\n• Sa\'y yok\n\n⏰ Tavaf zamanı:\n• Mekke\'den ayrılmadan hemen önce\n• Tavaftan sonra alışveriş yapmayın\n• Doğruca yola çıkın\n• Son ibadet olsun\n\n🤲 Veda duaları:\n"Allahümme lâ tac\'alhû âhire\'l-ahdi min beytike\'l-harâm"\n(Allah\'ım! Bunu Beyt-i Haram\'dan son ahdim kılma)\n\n💧 Son Zemzem:\n• Bol miktarda için\n• Hediye için şişelere doldurun\n• Şifa niyetiyle\n• Tekrar gelme duasıyla\n\n😢 Duygusal anlar:\n• Kabe\'ye son bakış\n• Gözyaşları dökün\n• Pişmanlık ve özlem\n• Kabul duası yapın\n\n⚠️ Dikkat edilecekler:\n• Veda tavafından sonra Mekke\'de kalmayın\n• Alışveriş için geri dönmeyin\n• Bu gerçekten son olsun\n• Hediye alma işini önceden bitirin\n\n🎁 Hediye önerileri:\n• Zemzem suyu\n• Hurma\n• Tespih ve seccade\n• Kur\'an ve dini kitaplar' 
                        },
                        { 
                            step: 14, 
                            title: 'Medine Ziyareti ve Türkiye\'ye Dönüş', 
                            desc: 'Hz. Peygamber\'in şehri Medine\'yi ziyaret edin ve vatana dönün', 
                            details: '🕌 Medine\'nin fazileti:\n• Hz. Peygamber\'in şehri\n• İkinci kutsal şehir\n• Mescid-i Nebevi\n• Ravza-i Mutahhara\n\n📿 Medine\'de yapılacaklar:\n• Mescid-i Nebevi\'de namaz\n• Hz. Peygamber\'e selam verme\n• Ravza\'da dua etme\n• Sahabe kabristanı (Baki) ziyareti\n\n🙏 Ziyaret adabı:\n• Saygılı ve alçakgönüllü\n• Yüksek sesle konuşmayın\n• Tavaf yapmayın (bid\'at)\n• Dua ve salavat getirin\n\n🤲 Hz. Peygamber\'e selam:\n"Es-selâmu aleyke yâ Rasûlallah"\n"Es-selâmu aleyke yâ Nebiyyallah"\n"Es-selâmu aleyke yâ habîballah"\n\n🏛️ Ziyaret yerleri:\n• Ravza-i Mutahhara\n• Minber-i Şerif\n• Baki kabristanı\n• Kuba Mescidi\n• Uhud dağı\n\n📚 Medine\'de öğrenilecekler:\n• Hz. Peygamber\'in hayatı\n• Sahabe\'nin fedakarlıkları\n• İslam\'ın yayılış tarihi\n• Medine Anayasası\n\n✈️ Türkiye\'ye dönüş:\n• Son alışverişi yapın\n• Hediyelerinizi toplayın\n• Hac arkadaşlarınızla vedalaşın\n• Güvenli yolculuk duası\n\n🏠 Türkiye\'de yapılacaklar:\n• Aileyi ziyaret edin\n• Hac deneyimlerini paylaşın\n• Hediyelerinizi dağıtın\n• Şükür namazı kılın\n\n🤲 Dönüş duaları:\n• "Âyibûne tâibûne..."\n• Hac\'ın kabulü için\n• Aile ve yakınlar için\n• Tekrar gitme niyetiyle\n\n💡 Hacı olarak yaşam:\n• Günahlardan uzak durun\n• İbadetlere devam edin\n• Hac anılarını yaşatın\n• Başkalarına yardım edin' 
                        }
                    ]
                };
            }

            loadDailyHadith() {
                const today = new Date().getDate();
                const hadith = this.dailyContent.hadith[today % this.dailyContent.hadith.length];
                
                const hadithEl = document.getElementById('dailyHadith');
                const sourceEl = document.getElementById('dailyHadithSource');
                
                if (hadithEl) hadithEl.textContent = `"${hadith.text}"`;
                if (sourceEl) sourceEl.textContent = `— ${hadith.source}`;
            }

            loadDailyDua() {
                const today = new Date().getDate();
                const dua = this.dailyContent.duas[today % this.dailyContent.duas.length];
                
                const duaEl = document.getElementById('dailyDua');
                const effectEl = document.getElementById('dailyDuaEffect');
                
                if (duaEl) duaEl.textContent = `"${dua.text}"`;
                if (effectEl) effectEl.textContent = `Faydası: ${dua.effect}`;
            }

            loadHomeTours() {
                const container = document.getElementById('homeTours');
                if (!container) return;
                
                container.innerHTML = this.tours.slice(0, 3).map(tour => `
                    <div style="scroll-snap-align:start;flex-shrink:0;width:160px;min-height:120px;border:1px solid var(--border);background:var(--card2);border-radius:12px;overflow:hidden;cursor:pointer;transition:transform 0.2s ease" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'" onclick="appNavigation.go('tours')">
                        <div style="height:70px;background:linear-gradient(135deg,var(--tour),var(--gold));display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px">
                            <i class="fa-solid fa-${tour.type === 'hac' ? 'mosque' : 'kaaba'}" aria-hidden="true"></i>
                        </div>
                        <div style="padding:8px">
                            <div style="font-weight:700;font-size:11px;margin-bottom:3px">${tour.title}</div>
                            <div style="font-size:9px;color:var(--tx2);margin-bottom:3px">${tour.plan}</div>
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <div style="color:var(--gold);font-weight:800;font-size:10px">${tour.price}</div>
                                <div style="display:flex;align-items:center;gap:1px">
                                    <span style="color:var(--gold);font-size:8px">★</span>
                                    <span style="font-size:8px;color:var(--tx2)">${tour.rating}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            filterTours(category) {
                // Update filter buttons
                document.querySelectorAll('#tourFilters button').forEach(btn => {
                    btn.classList.toggle('primary', btn.dataset.filter === category);
                });

                this.renderTours(category);
            }

            renderTours(filter = 'all') {
                const container = document.getElementById('tourList');
                if (!container) return;

                const filtered = filter === 'all' ? this.tours : this.tours.filter(t => t.type === filter);

                container.innerHTML = filtered.map(tour => `
                    <div class="card">
                        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">
                            <h3 style="margin:0;flex:1">${tour.title}</h3>
                            <div class="badge">${tour.price}</div>
                        </div>
                        <div style="color:var(--tx2);margin-bottom:8px">${tour.date} • ${tour.plan}</div>
                        <div style="display:flex;align-items:center;gap:4px;margin-bottom:12px">
                            <span style="color:var(--gold)">★</span>
                            <span style="color:var(--tx2)">${tour.rating}</span>
                        </div>
                        <div class="grid g2">
                            <button class="btn primary" onclick="socialActions.openWhatsApp('🕌 ${tour.title} turu hakkında bilgi almak istiyorum.')">
                                <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp
                            </button>
                            <button class="btn" onclick="shareManager.share('${tour.title}', '${tour.title} - ${tour.date}\\n${tour.plan}\\nFiyat: ${tour.price}')">
                                <i class="fa-solid fa-share" aria-hidden="true"></i> Paylaş
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            filterMarket(category) {
                // Update filter buttons
                document.querySelectorAll('#marketFilters button').forEach(btn => {
                    btn.classList.toggle('primary', btn.dataset.filter === category);
                });

                this.renderMarket(category);
            }

            renderMarket(category = 'all') {
                const container = document.getElementById('marketContent');
                if (!container) return;

                let products = [];
                if (category === 'all') {
                    products = Object.values(this.market).flat();
                } else {
                    products = this.market[category] || [];
                }

                container.innerHTML = products.map(product => `
                    <div class="card">
                        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px">
                            <h3 style="margin:0;flex:1">${product.title}</h3>
                        </div>
                        <div style="color:var(--tx2);margin-bottom:12px">${product.desc}</div>
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <div>
                                <div class="badge">${product.price}</div>
                                <div style="display:flex;align-items:center;gap:4px;margin-top:4px">
                                    <span style="color:var(--gold)">★</span>
                                    <span style="font-size:12px;color:var(--tx2)">${product.rating}</span>
                                </div>
                            </div>
                            <button class="btn primary" onclick="socialActions.openWhatsApp('🛍️ ${product.title} ürününü sipariş etmek istiyorum. Fiyat: ${product.price}')">
                                <i class="fab fa-whatsapp" aria-hidden="true"></i> Sipariş
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            filterQuran(query) {
                const filtered = this.quranSuras.filter(sura => 
                    sura.name.toLowerCase().includes(query.toLowerCase()) ||
                    sura.meaning.toLowerCase().includes(query.toLowerCase())
                );
                this.renderQuran(filtered);
            }

            renderQuran(suras = this.quranSuras) {
                const container = document.getElementById('quranList');
                if (!container) return;

                container.innerHTML = suras.map(sura => `
                    <div class="card">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                            <h3 style="margin:0">${sura.number}. ${sura.name}</h3>
                            <div style="text-align:right">
                                <div style="font-size:18px;color:var(--gold)">${sura.arabic}</div>
                                <div style="font-size:12px;color:var(--tx2)">${sura.ayatCount} âyet</div>
                            </div>
                        </div>
                        <div style="color:var(--tx2);margin-bottom:12px">Anlam: ${sura.meaning}</div>
                        <button class="btn" onclick="utils.showToast('📖 ${sura.name} sûresi açılıyor...', 'info')">
                            <i class="fa-solid fa-book-open" aria-hidden="true"></i> Oku
                        </button>
                    </div>
                `).join('');
            }

            filterHadith(category) {
                // Update filter buttons
                document.querySelectorAll('#hadithFilters button').forEach(btn => {
                    btn.classList.toggle('primary', btn.dataset.filter === category);
                });

                this.renderHadith(category);
            }

            searchHadith(query) {
                const filtered = this.hadithCollection.filter(hadith =>
                    hadith.title.toLowerCase().includes(query.toLowerCase()) ||
                    hadith.text.toLowerCase().includes(query.toLowerCase())
                );
                this.renderHadithList(filtered);
            }

            renderHadith(category = 'all') {
                const filtered = category === 'all' ? this.hadithCollection : this.hadithCollection.filter(h => h.category === category);
                this.renderHadithList(filtered);
            }

            renderHadithList(hadiths) {
                const container = document.getElementById('hadithList');
                if (!container) return;

                container.innerHTML = hadiths.map(hadith => `
                    <div class="card">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                            <h3 style="margin:0">${hadith.title}</h3>
                            <button class="btn" onclick="shareManager.share('Hadis: ${hadith.title}','${hadith.text} -- ${hadith.source}')" style="padding:6px 8px">
                                <i class="fa-solid fa-share" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div style="color:var(--tx2);margin-bottom:8px">Kaynak: ${hadith.source}</div>
                        <div style="font-weight:600;margin-bottom:8px">"${hadith.text}"</div>
                        <div style="padding:12px;background:rgba(30,64,175,.15);border:1px solid var(--dua);border-radius:12px">
                            <div style="font-weight:600;margin-bottom:4px">
                                <i class="fa-solid fa-lightbulb" style="color:var(--dua)" aria-hidden="true"></i> Açıklama:
                            </div>
                            <div style="font-size:14px">${hadith.explanation}</div>
                        </div>
                    </div>
                `).join('');
            }

            openDuaCategory(category) {
                const container = document.getElementById('duaList');
                if (!container) return;

                const categoryTitles = {
                    sabah: 'Sabah/Akşam Duaları',
                    namaz: 'Namaz Sonrası Dualar',
                    uyku: 'Uyku Öncesi Dualar',
                    seyahat: 'Seyahat Duaları'
                };

                const duas = this.duaCategories[category] || [];

                container.innerHTML = `
                    <div class="card">
                        <h3 style="margin:0 0 16px">
                            <i class="fa-solid fa-hands-praying" style="color:var(--dua)" aria-hidden="true"></i> 
                            ${categoryTitles[category]}
                        </h3>
                        ${duas.map(dua => `
                            <div style="margin-bottom:16px;padding:16px;background:var(--card2);border:1px solid var(--border);border-radius:12px">
                                <div style="font-weight:700;margin-bottom:8px">${dua.title}</div>
                                <div style="font-weight:600;margin-bottom:8px;font-style:italic">${dua.dua}</div>
                                <div style="padding:8px 12px;background:rgba(30,64,175,.15);border:1px solid var(--dua);border-radius:8px;color:var(--dua);font-size:13px">
                                    ${dua.effect}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            openManasikGuide(type) {
                const guides = this.manasikGuides[type] || [];
                const title = type === 'hac' ? 'Hac Rehberi' : 'Umre Rehberi';
                
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:500px;max-height:95vh">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border)">
                            <h3 style="margin:0;color:var(--gold)">${title}</h3>
                            <button class="btn" onclick="this.closest('.modal').remove()" style="padding:6px 8px;min-height:32px">
                                <i class="fa-solid fa-times" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div style="max-height:70vh;overflow-y:auto;padding-right:6px">
                            ${guides.map(step => `
                                <div style="margin-bottom:16px;border:1px solid var(--border);border-radius:12px;overflow:hidden">
                                    <div style="padding:16px;background:var(--card2);cursor:pointer;display:flex;justify-content:space-between;align-items:center" onclick="this.parentElement.classList.toggle('open'); this.querySelector('i').style.transform = this.parentElement.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)'">
                                        <span style="color:var(--gold);font-weight:700">📋 ${step.step}. ${step.title}</span>
                                        <i class="fa-solid fa-chevron-down" style="transition:transform 0.2s;color:var(--tx2)" aria-hidden="true"></i>
                                    </div>
                                    <div style="padding:16px;background:var(--card);display:none">
                                        <div style="font-weight:600;margin-bottom:8px;color:var(--tx);font-size:14px">${step.desc}</div>
                                        <div style="line-height:1.6;font-size:13px;white-space:pre-line;color:var(--tx2)">${step.details}</div>
                                        <div style="margin-top:12px;text-align:right">
                                            <button class="btn" onclick="shareManager.share('${step.title}', '${step.desc}\\n\\n${step.details.replace(/'/g, "\\'")}');" style="padding:6px 12px;min-height:32px;font-size:12px">
                                                <i class="fa-solid fa-share" aria-hidden="true"></i> Paylaş
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top:16px;text-align:center;padding-top:12px;border-top:1px solid var(--border)">
                            <button class="btn primary" onclick="this.closest('.modal').remove()" style="padding:12px 24px">
                                <i class="fa-solid fa-check" aria-hidden="true"></i> Anladım, Kapatın
                            </button>
                        </div>
                    </div>
                `;
                
                // Add CSS for open state
                const style = document.createElement('style');
                style.textContent = `
                    .modal .open > div:last-child { display: block !important; }
                `;
                document.head.appendChild(style);
                
                document.body.appendChild(modal);
            }

            createGroup() {
                const groupId = 'UHC-' + Math.random().toString(36).slice(2, 7).toUpperCase();
                const statusEl = document.getElementById('groupStatus');
                if (statusEl) statusEl.textContent = 'Grup ID: ' + groupId;
                utils.showToast('✅ Grup oluşturuldu: ' + groupId, 'success');
            }

            shareInvite() {
                const statusEl = document.getElementById('groupStatus');
                const groupText = statusEl?.textContent || 'Grup bilgisi bulunamadı';
                
                if (groupText.includes('Grup ID:')) {
                    shareManager.share('UHC Grup Daveti', groupText);
                } else {
                    utils.showToast('❌ Önce grup oluşturun', 'warning');
                }
            }

            updateHijriCalendar() {
                // Simple Hijri calendar calculation
                const today = new Date();
                const gregorianEpoch = new Date('July 16, 622');
                const diffDays = Math.floor((today - gregorianEpoch) / (1000 * 60 * 60 * 24));
                
                const hijriYear = Math.floor(diffDays / 354.37) + 1;
                const remainingDays = diffDays % 354.37;
                
                const hijriMonths = [
                    'Muharrem', 'Safer', 'Rebîülevvel', 'Rebîülâhir', 
                    'Cemâziyelevvel', 'Cemâziyelâhir', 'Receb', 'Şaban',
                    'Ramazan', 'Şevval', 'Zilkade', 'Zilhicce'
                ];
                
                let currentMonth = 0;
                let currentDay = Math.floor(remainingDays);
                
                for (let i = 0; i < 12; i++) {
                    const monthDays = (i % 2 === 0) ? 30 : 29;
                    if (currentDay <= monthDays) {
                        currentMonth = i;
                        break;
                    }
                    currentDay -= monthDays;
                }
                
                if (currentDay <= 0) currentDay = 1;
                
                const hijriDateEl = document.getElementById('hijriDate');
                const hijriMonthEl = document.getElementById('hijriMonth');
                const hijriEventEl = document.getElementById('hijriEvent');
                const hijriEventDescEl = document.getElementById('hijriEventDesc');
                
                if (hijriDateEl) hijriDateEl.textContent = `${Math.floor(hijriYear)}/${String(currentMonth + 1).padStart(2, '0')}/${String(currentDay).padStart(2, '0')}`;
                if (hijriMonthEl) hijriMonthEl.textContent = hijriMonths[currentMonth];
                
                // Check for special Islamic days
                const specialDays = this.getSpecialIslamicDays(currentMonth, currentDay);
                if (hijriEventEl && hijriEventDescEl) {
                    if (specialDays.event) {
                        hijriEventEl.textContent = specialDays.event;
                        hijriEventDescEl.textContent = specialDays.description;
                    } else {
                        hijriEventEl.textContent = 'Özel Gün Bilgisi';
                        hijriEventDescEl.textContent = 'Bugün özel bir İslami gün bulunmuyor';
                    }
                }
            }

            getSpecialIslamicDays(month, day) {
                const specialDays = [
                    { month: 0, day: 1, event: 'Hicri Yılbaşı', description: 'Hicri takvimin ilk günü' },
                    { month: 0, day: 10, event: 'Aşure Günü', description: 'Hz. Hüseyin\'in şehadet günü, oruç tutulması müstehab' },
                    { month: 2, day: 12, event: 'Mevlid Kandili', description: 'Hz. Muhammed\'in doğum günü' },
                    { month: 6, day: 27, event: 'Regaib Kandili', description: 'İlk Cuma gecesi, ibadet ve dua gecesi' },
                    { month: 7, day: 15, event: 'Berat Kandili', description: 'Bağışlanma gecesi, ibadet ve istighfar' },
                    { month: 8, day: 1, event: 'Ramazan Başlangıcı', description: 'Mübarek Ramazan ayının ilk günü' },
                    { month: 8, day: 27, event: 'Kadir Gecesi', description: 'Kur\'an\'ın indirilmeye başlandığı gece' },
                    { month: 9, day: 1, event: 'Ramazan Bayramı', description: 'Şeker Bayramı - 3 gün sürer' },
                    { month: 11, day: 9, event: 'Arefe Günü', description: 'Hac\'cılar Arafat\'ta vakfe yapar' },
                    { month: 11, day: 10, event: 'Kurban Bayramı', description: 'Adha Bayramı - 4 gün sürer' }
                ];
                
                const today = specialDays.find(d => d.month === month && d.day === day);
                return today || { event: null, description: null };
            }
        }

        // ============ SHARE MANAGER ============
        class ShareManager {
            async shareDaily(type) {
                let content = '';
                
                if (type === 'hadith') {
                    const hadithText = document.getElementById('dailyHadith')?.textContent || '';
                    const hadithSource = document.getElementById('dailyHadithSource')?.textContent || '';
                    content = `${hadithText}\n\n${hadithSource}`;
                }

                await this.share('Günün Hadisi', content);
            }

            async shareTespihProgress() {
                const { count, text, target } = appState.tespih;
                const { todayTespih, totalTespih } = appState.user.stats;
                
                const content = `🤲 Bugün ${todayTespih} zikir yaptım\n📿 ${text}: ${count}/${target || '∞'}\n🏆 Toplam: ${totalTespih} zikir`;
                
                await this.share('Tespih İlerlemem', content);
            }

            async shareApp() {
                const content = `🕌 Umrah & Hac Companion Premium\n\n📱 Manevi yolculuğunuzun en iyi yoldaşı:\n• Akıllı Kıble Pusulası\n• Dijital Tespih & Zikir\n• Namaz Vakitleri\n• Hac & Umre Rehberi\n• Premium Turlar\n\n🌟 Hemen indirin ve başlayın!`;
                
                await this.share('UHC Premium Uygulaması', content);
            }

            async share(title, content) {
                const shareText = `${title}\n\n${content}\n\n📱 Umrah & Hac Companion Premium`;
                
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: title,
                            text: shareText
                        });
                    } catch (error) {
                        if (error.name !== 'AbortError') {
                            this.fallbackShare(shareText);
                        }
                    }
                } else {
                    this.fallbackShare(shareText);
                }
            }

            fallbackShare(text) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        utils.showToast('📋 Kopyalandı! Sosyal medyada paylaşabilirsiniz', 'success');
                    }).catch(() => {
                        utils.showToast('❌ Kopyalama başarısız', 'error');
                    });
                } else {
                    utils.showToast('📱 Paylaşım desteklenmiyor', 'warning');
                }
            }
        }

        // ============ SOCIAL ACTIONS ============
        const socialActions = {
            openWhatsApp(message) {
                const phoneNumber = '971551399811';
                const encodedMessage = encodeURIComponent(message);
                window.open(`https://wa.me/${phoneNumber}?text=${encodedMessage}`, '_blank');
            },

            openInstagram() {
                window.open('https://instagram.com/umrahacompanion', '_blank');
            }
        };

        // ============ LANGUAGE MANAGER ============
        const languageManager = {
            current: 'tr',
            
            translations: {
                tr: { app_title: 'UHC Premium', prayer_times: 'Namaz Vakitleri' },
                en: { app_title: 'UHC Premium', prayer_times: 'Prayer Times' },
                ar: { app_title: 'UHC Premium', prayer_times: 'أوقات الصلاة' }
            },

            setLanguage(lang) {
                this.current = lang;
                document.documentElement.lang = lang;
                
                if (lang === 'ar') {
                    document.body.classList.add('rtl');
                    document.documentElement.dir = 'rtl';
                } else {
                    document.body.classList.remove('rtl');
                    document.documentElement.dir = 'ltr';
                }
                
                const flags = { tr: '🇹🇷', en: '🇺🇸', ar: '🇸🇦' };
                const flagEl = document.getElementById('currentLangFlag');
                if (flagEl) flagEl.textContent = flags[lang];
                
                this.toggleMenu(); // Close menu
                
                localStorage.setItem('uhc_language', lang);
                utils.showToast(`🌐 ${['Türkçe', 'English', 'العربية'][['tr', 'en', 'ar'].indexOf(lang)]} seçildi`, 'success');
            },

            toggleMenu() {
                const menu = document.getElementById('langMenu');
                if (!menu) return;
                
                const isOpen = menu.style.display !== 'none';
                menu.style.display = isOpen ? 'none' : 'block';
                
                if (!isOpen) {
                    const closeHandler = (e) => {
                        if (!e.target.closest('.lang-selector')) {
                            menu.style.display = 'none';
                            document.removeEventListener('click', closeHandler);
                        }
                    };
                    setTimeout(() => document.addEventListener('click', closeHandler), 0);
                }
            },

            loadSaved() {
                const saved = localStorage.getItem('uhc_language');
                if (saved && this.translations[saved]) {
                    this.setLanguage(saved);
                }
            }
        };

        // ============ AUTH MANAGER ============
        const authManager = {
            auth(type) {
                if (type === 'guest') {
                    appState.update('user', {
                        type: 'guest',
                        name: 'Misafir Kullanıcı'
                    });
                    appNavigation.go('home');
                    utils.showToast('👋 Misafir olarak devam ediyorsunuz', 'info');
                } else {
                    appState.update('user', {
                        type: 'user',
                        name: type === 'google' ? 'Google Kullanıcı' : 'Apple Kullanıcı',
                        email: type === 'google' ? 'user@gmail.com' : 'user@icloud.com'
                    });
                    appNavigation.go('home');
                    utils.showToast(`✅ ${appState.user.name} olarak giriş yapıldı`, 'success');
                }
                this.updateProfileDisplay();
            },

            showEmailAuth() {
                document.getElementById('emailModal').classList.add('show');
            },

            closeEmailModal() {
                document.getElementById('emailModal').classList.remove('show');
            },

            switchEmailMode(mode) {
                const isLogin = mode === 'login';
                document.getElementById('loginBtn').classList.toggle('primary', isLogin);
                document.getElementById('registerBtn').classList.toggle('primary', !isLogin);
                document.getElementById('passwordConfirmInput').style.display = isLogin ? 'none' : 'block';
                document.getElementById('nameInput').style.display = isLogin ? 'none' : 'block';
                document.getElementById('authBtn').textContent = isLogin ? 'Giriş Yap' : 'Kayıt Ol';
            },

            processEmailAuth() {
                const email = document.getElementById('emailInput').value;
                const password = document.getElementById('passwordInput').value;
                const name = document.getElementById('nameInput').value;
                
                if (!email || !password) { 
                    utils.showToast('❌ E-posta ve şifre gerekli', 'error'); 
                    return; 
                }
                
                appState.update('user', {
                    type: 'user',
                    email: email,
                    name: name || email.split('@')[0]
                });
                
                this.closeEmailModal();
                appNavigation.go('home');
                utils.showToast(`✅ ${appState.user.name} olarak giriş yapıldı`, 'success');
                this.updateProfileDisplay();
            },

            upgradeToPremium() {
                if (appState.user.type === 'guest') {
                    utils.showToast('❌ Önce giriş yapmanız gerekiyor', 'warning');
                    return;
                }
                appState.update('user', { type: 'premium' });
                this.updateProfileDisplay();
                utils.showToast('🎉 Premium üyeliğe yükseltildi!', 'success');
            },

            logout() {
                appState.update('user', {
                    id: 'guest', 
                    name: 'Misafir Kullanıcı', 
                    email: '', 
                    type: 'guest'
                });
                this.updateProfileDisplay();
                appNavigation.go('auth');
                utils.showToast('👋 Çıkış yapıldı', 'info');
                localStorage.removeItem('uhc_app_state');
            },

            updateProfileDisplay() {
                const profileNameEl = document.getElementById('profileName');
                const profileStatusEl = document.getElementById('profileStatus');
                const profileAvatarEl = document.getElementById('profileAvatar');
                const userTotalDaysEl = document.getElementById('userTotalDays');
                const userTotalTespihEl = document.getElementById('userTotalTespih');
                const userStreakEl = document.getElementById('userStreak');

                if (profileNameEl) profileNameEl.textContent = appState.user.name;
                if (profileAvatarEl) {
                    profileAvatarEl.innerHTML = appState.user.type === 'guest' 
                        ? '<i class="fa-solid fa-user" aria-hidden="true"></i>' 
                        : '<i class="fa-solid fa-user-check" aria-hidden="true"></i>';
                }
                
                let status = 'Misafir kullanıcı';
                if (appState.user.type === 'user') status = 'Kayıtlı kullanıcı';
                if (appState.user.type === 'premium') status = 'Premium üye ⭐';
                
                if (profileStatusEl) profileStatusEl.textContent = status;
                if (userTotalDaysEl) userTotalDaysEl.textContent = appState.user.stats.totalDays || 0;
                if (userTotalTespihEl) userTotalTespihEl.textContent = appState.user.stats.totalTespih || 0;
                if (userStreakEl) userStreakEl.textContent = appState.user.stats.streak || 0;
            }
        };

        // ============ APP NAVIGATION ============
        const appNavigation = {
            currentView: 'home',
            views: ['auth', 'home', 'tespih', 'qibla', 'namaz', 'tours', 'market', 'quran', 'hadisler', 'dualar', 'social', 'profile'],

            // Navigation mapping for new tab structure
            tabMapping: {
                'home': 'home',
                'tespih': 'tespih',
                'qibla': 'qibla',
                'market': 'market',
                'tours': 'tours',
                'social': 'social',
                'profile': 'profile'
            },

            go(viewId) {
                // Map simplified tab names to actual views
                const actualViewId = this.tabMapping[viewId] || viewId;
                
                // Update view visibility
                this.views.forEach(id => {
                    const view = document.getElementById(id);
                    if (view) {
                        view.classList.toggle('active', id === actualViewId);
                    }
                });

                // Update tab states with reverse mapping
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                    tab.setAttribute('aria-selected', 'false');
                });

                // Find which tab should be active based on current view
                let activeTabClass = null;
                for (const [tabClass, targetView] of Object.entries(this.tabMapping)) {
                    if (targetView === actualViewId || (tabClass === 'ibadet' && ['tespih', 'namaz'].includes(actualViewId)) || (tabClass === 'kesfet' && ['tours', 'market', 'quran', 'hadisler', 'dualar', 'friends'].includes(actualViewId))) {
                        activeTabClass = tabClass;
                        break;
                    }
                }

                if (activeTabClass) {
                    const activeTab = document.querySelector(`.tab.${activeTabClass}`);
                    if (activeTab) {
                        activeTab.classList.add('active');
                        activeTab.setAttribute('aria-selected', 'true');
                    }
                }

                this.currentView = actualViewId;
                history.replaceState(null, '', '#' + actualViewId);

                // Trigger view-specific actions
                this.onViewChange(actualViewId);
            },

            onViewChange(viewId) {
                switch (viewId) {
                    case 'tespih':
                        tespihManager.renderTypes();
                        tespihManager.updateDisplay();
                        break;
                    case 'tours':
                        contentManager.renderTours('all');
                        break;
                    case 'market':
                        contentManager.renderMarket('all');
                        break;
                    case 'social':
                        if (typeof guideService !== 'undefined') guideService.renderGuides();
                        socialManager.initializeLocationMap();
                        break;
                    case 'quran':
                        contentManager.renderQuran();
                        break;
                    case 'hadisler':
                        contentManager.renderHadith();
                        break;
                    case 'profile':
                        authManager.updateProfileDisplay();
                        break;
                }
            }
        };

        // ============ CURRENCY SERVICE ============
        class CurrencyService {
            constructor() {
                this.rates = {
                    USD: { symbol: '$', rate: 34.25, change: '+0.15' },
                    EUR: { symbol: '€', rate: 37.80, change: '-0.08' },
                    SAR: { symbol: 'SR', rate: 9.13, change: '+0.03' }
                };
                this.lastUpdate = null;
            }

            async refreshRates() {
                utils.showToast('💱 Kurlar yenileniyor...', 'info');
                
                try {
                    // Simulate API call with mock data
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Mock rate updates
                    this.rates.USD.rate += (Math.random() - 0.5) * 0.2;
                    this.rates.EUR.rate += (Math.random() - 0.5) * 0.3;
                    this.rates.SAR.rate += (Math.random() - 0.5) * 0.1;
                    
                    // Update change indicators
                    this.rates.USD.change = Math.random() > 0.5 ? '+0.12' : '-0.08';
                    this.rates.EUR.change = Math.random() > 0.5 ? '+0.18' : '-0.11';
                    this.rates.SAR.change = Math.random() > 0.5 ? '+0.05' : '-0.03';
                    
                    this.lastUpdate = new Date();
                    this.renderRates();
                    
                    utils.showToast('✅ Kurlar güncellendi', 'success');
                } catch (error) {
                    console.warn('Currency refresh failed:', error);
                    utils.showToast('❌ Kurlar güncellenirken hata oluştu', 'error');
                }
            }

            renderRates() {
                const container = document.getElementById('currencyRates');
                const updateEl = document.getElementById('currencyUpdate');
                
                if (!container) return;

                container.innerHTML = Object.entries(this.rates).map(([code, data]) => `
                    <div style="text-align:center;padding:8px;background:var(--card2);border:1px solid var(--border);border-radius:8px">
                        <div style="font-weight:700;color:var(--tx);margin-bottom:2px">${code}</div>
                        <div style="font-size:11px;font-weight:700;color:#22c55e;margin-bottom:2px">₺${data.rate.toFixed(2)}</div>
                        <div style="font-size:9px;color:${data.change.startsWith('+') ? '#22c55e' : '#ef4444'}">${data.change}</div>
                    </div>
                `).join('');

                if (updateEl) {
                    updateEl.textContent = this.lastUpdate 
                        ? this.lastUpdate.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
                        : '--:--';
                }
            }

            loadInitialRates() {
                this.lastUpdate = new Date();
                this.renderRates();
            }
        }

        // ============ KABUL SAATLERI SERVICE ============
        class KabulSaatleriService {
            constructor() {
                this.kabulTimes = [
                    { name: 'Seher Vakti', time: '04:30', description: 'Sabah ezanından 40 dk önce', isActive: false },
                    { name: 'Ezanlar Arası', time: '05:15', description: 'Ezan okunurken', isActive: false },
                    { name: 'Güneş Doğumu', time: '06:45', description: 'İlk ışıkların çıkışı', isActive: false },
                    { name: 'Cuma Ezanı', time: '12:30', description: 'Cuma namaz ezanı', isActive: false },
                    { name: 'Asr-ı Şerif', time: '15:45', description: 'İkindi namazı sonrası', isActive: false },
                    { name: 'Akşam Ezanı', time: '18:20', description: 'Maghrib ezanında', isActive: false },
                    { name: 'İftar Vakti', time: '18:25', description: 'Ramazan ayında', isActive: false },
                    { name: 'Yatsı Sonrası', time: '20:30', description: 'İlk 1/3 gece', isActive: false }
                ];
                this.currentKabulStatus = null;
                this.nextKabulTime = null;
            }

            async loadKabulSaatleri() {
                this.updateKabulStatus();
                this.renderKabulSaatleri();
                
                // Update every minute
                if (!this.updateInterval) {
                    this.updateInterval = setInterval(() => {
                        this.updateKabulStatus();
                        this.renderKabulSaatleri();
                    }, 60000);
                }
            }

            updateKabulStatus() {
                const now = new Date();
                const currentMinutes = now.getHours() * 60 + now.getMinutes();
                
                // Check if currently in a kabul time
                let currentKabul = null;
                let nextKabul = null;
                
                for (let i = 0; i < this.kabulTimes.length; i++) {
                    const kabul = this.kabulTimes[i];
                    const [hour, minute] = kabul.time.split(':').map(Number);
                    const kabulMinutes = hour * 60 + minute;
                    
                    // Check if within 15 minutes of this kabul time
                    if (Math.abs(currentMinutes - kabulMinutes) <= 15) {
                        currentKabul = kabul;
                        kabul.isActive = true;
                    } else {
                        kabul.isActive = false;
                    }
                    
                    // Find next kabul time
                    if (!nextKabul && kabulMinutes > currentMinutes) {
                        nextKabul = kabul;
                    }
                }
                
                // If no next kabul today, take first one for tomorrow
                if (!nextKabul) {
                    nextKabul = this.kabulTimes[0];
                }
                
                this.currentKabulStatus = currentKabul;
                this.nextKabulTime = nextKabul;
            }

            renderKabulSaatleri() {
                const container = document.getElementById('kabulSaatleri');
                const nextTimeEl = document.getElementById('nextKabulTime');
                const statusEl = document.getElementById('currentKabulStatus');
                const adviceEl = document.getElementById('kabulAdvice');
                
                if (!container) return;

                // Render kabul times list
                container.innerHTML = `
                    <div style="max-height:120px;overflow-y:auto;margin-bottom:8px">
                        ${this.kabulTimes.map(kabul => `
                            <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 8px;margin-bottom:4px;background:${kabul.isActive ? 'rgba(147,51,234,.2)' : 'var(--card2)'};border:1px solid ${kabul.isActive ? '#9333ea' : 'var(--border)'};border-radius:8px;font-size:12px">
                                <div>
                                    <div style="font-weight:700;color:${kabul.isActive ? '#9333ea' : 'var(--tx)'};margin-bottom:1px">
                                        ${kabul.isActive ? '✨ ' : ''}${kabul.name}
                                    </div>
                                    <div style="font-size:10px;color:var(--tx2)">${kabul.description}</div>
                                </div>
                                <div style="font-weight:800;color:${kabul.isActive ? '#9333ea' : 'var(--gold)'};font-size:11px">
                                    ${kabul.time}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                // Update next kabul time
                if (nextTimeEl && this.nextKabulTime) {
                    nextTimeEl.textContent = this.nextKabulTime.time;
                }

                // Update current status
                if (statusEl && adviceEl) {
                    if (this.currentKabulStatus) {
                        statusEl.innerHTML = `✨ ${this.currentKabulStatus.name} - Müstecab Vakit!`;
                        adviceEl.textContent = `Şimdi dua etmek için mübarek zaman. ${this.currentKabulStatus.description}`;
                        
                        // Haptic feedback for active kabul time
                        if (navigator.vibrate) {
                            navigator.vibrate([200, 100, 200]);
                        }
                    } else {
                        statusEl.innerHTML = `📿 Müstecab Vakit Kontrolü`;
                        adviceEl.textContent = `Sonraki müstecab vakit: ${this.nextKabulTime?.name || 'Hesaplanıyor'} (${this.nextKabulTime?.time || '--:--'})`;
                    }
                }
            }

            getSpecialKabulTimes() {
                const now = new Date();
                const day = now.getDay();
                const specialTimes = [];

                // Cuma günü özel kabul vakitleri
                if (day === 5) { // Friday
                    specialTimes.push({
                        name: 'Cuma Hutbesi',
                        time: '12:15',
                        description: 'Hutbe okunurken',
                        isActive: false
                    });
                }

                // Ramazan ayı kontrolü (basit hesaplama)
                const hijriMonth = (Math.floor((now - new Date('2023-03-23')) / (1000 * 60 * 60 * 24 * 29.5)) % 12);
                if (hijriMonth === 8) { // Ramazan (yaklaşık)
                    specialTimes.push({
                        name: 'Sahur Vakti',
                        time: '04:00',
                        description: 'Sahur yemeği zamanı',
                        isActive: false
                    });
                }

                return specialTimes;
            }

            stopUpdates() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
            }
        }

        // ============ APP INITIALIZATION ============
        class App {
            constructor() {
                this.isInitialized = false;
            }

            async init() {
                if (this.isInitialized) return;

                try {
                    // Initialize app state
                    appState.load();

                    // Initialize services
                    await this.initializeServices();

                    // Setup UI
                    this.setupUI();

                    // Load content
                    await this.loadInitialContent();

                    // Setup event listeners
                    this.setupEventListeners();

                    // Start auto-update services
                    this.startAutoUpdates();

                    // Handle initial route
                    this.handleInitialRoute();

                    this.isInitialized = true;
                    utils.showToast('✅ Uygulama başlatıldı', 'success', 2000);

                } catch (error) {
                    console.error('App initialization failed:', error);
                    utils.showToast('❌ Uygulama başlatılamadı', 'error');
                }
            }

            async initializeServices() {
                // Initialize global services
                window.locationService = new LocationService();
                window.prayerService = new PrayerService();
                window.weatherService = new WeatherService();
                window.tespihManager = new TespihManager();
                window.qiblaManager = new QiblaManager();
                window.contentManager = new ContentManager();
                window.shareManager = new ShareManager();
                window.currencyService = new CurrencyService();
                window.kabulSaatleriService = new KabulSaatleriService();
                window.appNavigation = appNavigation;
            }

            setupUI() {
                // Setup dark mode
                this.setupDarkMode();
                
                // Setup language
                languageManager.loadSaved();
            }

            async loadInitialContent() {
                // Load prayer times
                await prayerService.loadPrayerTimes();
                
                // Load weather
                await weatherService.loadWeather();
                
                // Load daily content
                contentManager.loadDailyHadith();
                contentManager.loadDailyDua();
                contentManager.updateHijriCalendar();
                contentManager.loadHomeTours();
                
                // Load nearby mosques
                await locationService.refreshMosques();
            }

            setupEventListeners() {
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key) {
                            case '1':
                                e.preventDefault();
                                appNavigation.go('home');
                                break;
                            case '2':
                                e.preventDefault();
                                appNavigation.go('tespih');
                                break;
                            case '3':
                                e.preventDefault();
                                appNavigation.go('qibla');
                                break;
                            case '4':
                                e.preventDefault();
                                appNavigation.go('namaz');
                                break;
                        }
                    }
                });

                // Handle visibility change for battery optimization
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.onAppHidden();
                    } else {
                        this.onAppVisible();
                    }
                });

                // Handle online/offline
                window.addEventListener('online', () => {
                    utils.showToast('🌐 İnternet bağlantısı restored', 'success');
                    this.loadInitialContent();
                });

                window.addEventListener('offline', () => {
                    utils.showToast('📵 İnternet bağlantısı yok', 'warning');
                });
            }

            setupDarkMode() {
                const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (isDark) {
                    document.documentElement.classList.add('dark');
                }

                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    document.documentElement.classList.toggle('dark', event.matches);
                });
            }

            startAutoUpdates() {
                // Start prayer times auto-update
                prayerService.startAutoUpdate();

                // Update weather every 10 minutes
                setInterval(() => {
                    if (!document.hidden) {
                        weatherService.loadWeather();
                    }
                }, 600000);

                // Refresh prayer times daily
                setInterval(() => {
                    prayerService.loadPrayerTimes();
                }, 86400000);
            }

            handleInitialRoute() {
                const hash = location.hash.slice(1);
                if (hash && appNavigation.views.includes(hash)) {
                    appNavigation.go(hash);
                }
            }

            onAppHidden() {
                // Optimize for battery when app is hidden
                qiblaManager.stopTracking();
                locationService.stopWatching();
                prayerService.stopAutoUpdate();
            }

            onAppVisible() {
                // Resume services when app becomes visible
                if (appNavigation.currentView === 'qibla' && appState.qibla.isActive) {
                    qiblaManager.startTracking();
                }
                locationService.startWatching();
                prayerService.startAutoUpdate();
                
                // Refresh content
                this.loadInitialContent();
            }
        }

        // ============ LIVE STREAMS MANAGER ============
        const liveStreams = {
            openKabaStream() {
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:95vw;max-height:95vh;padding:0;background:#000">
                        <div style="position:relative;width:100%;height:70vh">
                            <iframe 
                                src="https://www.youtube.com/embed/fSMct2kvDcw?autoplay=1&mute=0&controls=1&showinfo=1&rel=0&modestbranding=0"
                                style="width:100%;height:100%;border:none"
                                allowfullscreen
                                allow="autoplay; encrypted-media">
                            </iframe>
                            <button onclick="this.closest('.modal').remove()" 
                                    style="position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.8);color:#fff;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;z-index:1000">
                                ✕
                            </button>
                        </div>
                        <div style="padding:16px;color:#fff">
                            <h3 style="margin:0 0 8px;color:var(--gold)">🕋 Kabe-i Şerif Canlı Yayını</h3>
                            <p style="margin:0;color:#ccc;font-size:14px">Mescid-i Haram • Mekke-i Mükerreme • 7/24 Kesintisiz Yayın</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Add dark backdrop click to close
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                utils.showToast('🕋 Kabe-i Şerif canlı yayını açılıyor...', 'info');
            },

            openMedinaStream() {
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:95vw;max-height:95vh;padding:0;background:#000">
                        <div style="position:relative;width:100%;height:70vh">
                            <iframe 
                                src="https://www.youtube.com/embed/TpT8b8JFZ6E?autoplay=1&mute=0&controls=1&showinfo=1&rel=0&modestbranding=0"
                                style="width:100%;height:100%;border:none"
                                allowfullscreen
                                allow="autoplay; encrypted-media">
                            </iframe>
                            <button onclick="this.closest('.modal').remove()" 
                                    style="position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.8);color:#fff;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;z-index:1000">
                                ✕
                            </button>
                        </div>
                        <div style="padding:16px;color:#fff">
                            <h3 style="margin:0 0 8px;color:var(--gold)">🕌 Mescid-i Nebevi Canlı Yayını</h3>
                            <p style="margin:0;color:#ccc;font-size:14px">Ravza-i Mutahhara • Medine-i Münevvere • 7/24 Kesintisiz Yayın</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Add dark backdrop click to close
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                utils.showToast('🕌 Mescid-i Nebevi canlı yayını açılıyor...', 'info');
            }
        };

        // ============ GLOBAL APP STATE AND INITIALIZATION ============
        const appState = new AppState();
        const app = new App();

        // Initialize PWA and app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', async () => {
                await pwaManager.init();
                await app.init();
                
                // Show PWA features notification
                setTimeout(() => {
                    if (!pwaManager.isStandalone()) {
                        utils.showToast('📱 Ana ekranınıza ekleyebilirsiniz!', 'info', 5000);
                    }
                }, 10000);
            });
        } else {
            (async () => {
                await pwaManager.init();
                await app.init();
                
                // Show PWA features notification
                setTimeout(() => {
                    if (!pwaManager.isStandalone()) {
                        utils.showToast('📱 Ana ekranınıza ekleyebilirsiniz!', 'info', 5000);
                    }
                }, 10000);
            })();
        }

        // ============ NAMAZ SERVICE ============
        class NamazService {
            constructor() {
                this.namazTypes = [
                    { id: 'sabah', name: 'Sabah', icon: '☀️', rekats: '2+2', steps: 4 },
                    { id: 'ogle', name: 'Öğle', icon: '🌞', rekats: '4+2+2', steps: 8 },
                    { id: 'ikindi', name: 'İkindi', icon: '🌤️', rekats: '4+2', steps: 6 },
                    { id: 'aksam', name: 'Akşam', icon: '🌆', rekats: '3+2+2', steps: 7 },
                    { id: 'yatsi', name: 'Yatsı', icon: '🌙', rekats: '4+2+3', steps: 9 }
                ];
                
                this.dailyTracker = {
                    sabah: false, ogle: false, ikindi: false, aksam: false, yatsi: false
                };
                
                this.namazSteps = {
                    sabah: [
                        { step: 1, title: 'Niyet', action: 'Sabah namazı için niyet edin', detail: '"Sabah namazının iki rekat farzını Allah rızası için kılıyorum"' },
                        { step: 2, title: 'Tekbir', action: 'Ellerinizi kulak hizasına kaldırıp "Allahu Ekber" deyin', detail: 'Namaza başlama tekbiri' },
                        { step: 3, title: 'Kıraet', action: 'Fatiha ve sûre okuyun', detail: '1. rekatta Fatiha + kısa sûre, 2. rekatta aynısı' },
                        { step: 4, title: 'Selam', action: 'Namazı selam vererek tamamlayın', detail: 'Sağa-sola selam verin ve duaya geçin' }
                    ]
                };
            }

            loadDailyTracker() {
                const container = document.getElementById('dailyPrayerTracker');
                if (!container) return;

                container.innerHTML = `
                    <div class="grid g5" style="grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:16px">
                        ${this.namazTypes.map(namaz => `
                            <button class="prayer-tracker-btn ${this.dailyTracker[namaz.id] ? 'completed' : ''}" 
                                    onclick="namazService.togglePrayer('${namaz.id}')"
                                    style="display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px 6px;border:1px solid var(--border);border-radius:12px;background:${this.dailyTracker[namaz.id] ? 'rgba(124,58,237,.15)' : 'var(--card2)'};transition:var(--transition);cursor:pointer;text-align:center">
                                <div style="font-size:18px">${namaz.icon}</div>
                                <div style="font-size:11px;font-weight:700;line-height:1.2">${namaz.name}</div>
                                <div style="font-size:9px;color:var(--tx2)">${namaz.rekats}</div>
                                ${this.dailyTracker[namaz.id] ? '<i class="fa-solid fa-check" style="color:var(--namaz);font-size:12px"></i>' : ''}
                            </button>
                        `).join('')}
                    </div>
                    <div style="padding:12px;background:rgba(124,58,237,.1);border:1px solid var(--namaz);border-radius:12px;text-align:center">
                        <div style="font-weight:700;color:var(--namaz);margin-bottom:4px">
                            Bugün: ${Object.values(this.dailyTracker).filter(Boolean).length}/5 namaz
                        </div>
                        <div style="font-size:13px;color:var(--tx2)">
                            Her namaz için butona basarak tamamlayın
                        </div>
                    </div>
                `;
            }

            togglePrayer(namazId) {
                this.dailyTracker[namazId] = !this.dailyTracker[namazId];
                this.loadDailyTracker();
                
                const namaz = this.namazTypes.find(n => n.id === namazId);
                if (this.dailyTracker[namazId]) {
                    utils.showToast(`✅ ${namaz.name} namazı işaretlendi`, 'success');
                    
                    // Haptic feedback
                    if (navigator.vibrate) navigator.vibrate(100);
                } else {
                    utils.showToast(`❌ ${namaz.name} namazı işareti kaldırıldı`, 'info');
                }

                // Update user stats
                const completedCount = Object.values(this.dailyTracker).filter(Boolean).length;
                appState.update('user', {
                    stats: {
                        ...appState.user.stats,
                        dailyPrayers: completedCount
                    }
                });
            }

            loadNamazTypes() {
                const container = document.getElementById('namazTypeSelector');
                if (!container) return;

                container.innerHTML = this.namazTypes.map(namaz => `
                    <button class="btn" onclick="namazService.showNamazSteps('${namaz.id}')"
                            style="padding:8px 16px;min-height:auto;background:var(--card2);border:1px solid var(--border);border-radius:20px;margin-right:8px;white-space:nowrap">
                        <div style="display:flex;align-items:center;gap:6px">
                            <span>${namaz.icon}</span>
                            <span style="font-weight:700">${namaz.name}</span>
                            <span style="font-size:10px;color:var(--tx2)">${namaz.rekats}</span>
                        </div>
                    </button>
                `).join('');
            }

            showNamazSteps(namazId) {
                const namaz = this.namazTypes.find(n => n.id === namazId);
                const steps = this.namazSteps[namazId] || this.namazSteps.sabah;
                
                const container = document.getElementById('namazStepsContainer');
                if (!container) return;

                container.innerHTML = `
                    <div class="card">
                        <h3 style="margin:0 0 16px;color:var(--namaz)">
                            ${namaz.icon} ${namaz.name} Namazı Rehberi
                        </h3>
                        <div style="margin-bottom:16px;padding:12px;background:rgba(124,58,237,.1);border:1px solid var(--namaz);border-radius:12px">
                            <div style="font-weight:700;color:var(--namaz);margin-bottom:4px">📋 Namaz Bilgisi</div>
                            <div style="font-size:13px;color:var(--tx2)">
                                Rekatlar: ${namaz.rekats} • Toplam ${namaz.steps} adım
                            </div>
                        </div>
                        ${steps.map(step => `
                            <div style="margin-bottom:12px;padding:16px;background:var(--card2);border:1px solid var(--border);border-radius:12px">
                                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                                    <div style="width:28px;height:28px;border-radius:50%;background:var(--namaz);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:12px">
                                        ${step.step}
                                    </div>
                                    <h4 style="margin:0;color:var(--namaz)">${step.title}</h4>
                                </div>
                                <div style="font-weight:600;margin-bottom:6px">${step.action}</div>
                                <div style="font-size:13px;color:var(--tx2);font-style:italic">${step.detail}</div>
                            </div>
                        `).join('')}
                        <div style="text-align:center;margin-top:16px">
                            <button class="btn primary" onclick="namazService.markPrayerCompleted('${namazId}')" style="padding:12px 24px">
                                <i class="fa-solid fa-check" aria-hidden="true"></i> ${namaz.name} Namazını Tamamladım
                            </button>
                        </div>
                    </div>
                `;
            }

            markPrayerCompleted(namazId) {
                this.dailyTracker[namazId] = true;
                this.loadDailyTracker();
                
                const namaz = this.namazTypes.find(n => n.id === namazId);
                utils.showToast(`🙏 ${namaz.name} namazı tamamlandı!`, 'success');
                
                // Clear the steps display
                const container = document.getElementById('namazStepsContainer');
                if (container) {
                    container.innerHTML = `
                        <div class="card" style="text-align:center;padding:24px">
                            <div style="font-size:48px;margin-bottom:12px">🙏</div>
                            <h3 style="margin:0 0 8px;color:var(--namaz)">Mâşallah!</h3>
                            <p style="color:var(--tx2);margin:0">Namazınız kabul olsun</p>
                        </div>
                    `;
                }
            }
        }

        // ============ SOCIAL MANAGER ============
        const socialManager = {
            groupId: null,
            isLocationSharing: false,
            members: [],
            
            initializeLocationMap() {
                // Auto show map when group is active
                if (this.groupId) {
                    this.showLocationMap();
                }
            },

            showLocationMap() {
                const mapEl = document.getElementById('groupLocationMap');
                if (mapEl) {
                    mapEl.style.display = 'block';
                    this.updateMapMarkers();
                    this.updateLocationSummary();
                }
            },

            hideLocationMap() {
                const mapEl = document.getElementById('groupLocationMap');
                if (mapEl) {
                    mapEl.style.display = 'none';
                }
            },

            updateMapMarkers() {
                const markersContainer = document.getElementById('mapMarkers');
                if (!markersContainer) return;

                // Clear existing markers
                markersContainer.innerHTML = '';

                // Add group member markers
                this.members.forEach((member, index) => {
                    const x = 20 + (index * 25) + Math.random() * 30; // Random-ish positioning
                    const y = 25 + Math.random() * 50;
                    
                    const marker = document.createElement('div');
                    marker.style.cssText = `
                        position: absolute;
                        left: ${x}%;
                        top: ${y}%;
                        width: 24px;
                        height: 24px;
                        border-radius: 50%;
                        background: ${member.isYou ? 'var(--social)' : 'var(--gold)'};
                        border: 2px solid white;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: 800;
                        font-size: 10px;
                        cursor: pointer;
                        animation: pulse${member.isYou ? 'Self' : ''} 2s infinite;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                        z-index: ${member.isYou ? 20 : 10};
                    `;
                    marker.textContent = member.name.charAt(0);
                    marker.title = `${member.name} - ${member.location}`;
                    
                    // Add click event to show member info
                    marker.onclick = () => this.showMemberLocationInfo(member);
                    
                    markersContainer.appendChild(marker);
                });

                // Add pulse animation styles
                if (!document.getElementById('mapAnimations')) {
                    const style = document.createElement('style');
                    style.id = 'mapAnimations';
                    style.textContent = `
                        @keyframes pulseSelf {
                            0% { transform: scale(1); box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 0 0 var(--social); }
                            50% { transform: scale(1.1); box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 0 8px rgba(236,72,153,0.3); }
                            100% { transform: scale(1); box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 0 0 var(--social); }
                        }
                        @keyframes pulse {
                            0% { transform: scale(1); }
                            50% { transform: scale(1.05); }
                            100% { transform: scale(1); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            },

            updateLocationSummary() {
                const summaryEl = document.getElementById('groupLocationSummary');
                if (!summaryEl) return;

                if (this.members.length === 0) {
                    summaryEl.textContent = 'Konum paylaşımı aktif olduğunda grup üyelerinin konumları görünecek';
                    return;
                }

                const activeMembers = this.members.filter(m => !m.isYou);
                if (activeMembers.length === 0) {
                    summaryEl.innerHTML = `
                        <div style="color:var(--social)">📍 Sen: Konum paylaşımı aktif</div>
                        <div style="color:var(--tx2);margin-top:4px">Diğer üyeler henüz konum paylaşmıyor</div>
                    `;
                } else {
                    const closestMember = activeMembers[0]; // Simulate closest
                    summaryEl.innerHTML = `
                        <div style="color:var(--social)">📍 ${activeMembers.length} üye konum paylaşıyor</div>
                        <div style="color:var(--tx2);margin-top:4px">
                            En yakın: <span style="color:var(--gold);font-weight:700">${closestMember.name}</span> (${closestMember.location.split(' - ')[1] || '150m'})
                        </div>
                    `;
                }
            },

            showMemberLocationInfo(member) {
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:350px">
                        <div style="text-align:center;margin-bottom:16px">
                            <div style="width:60px;height:60px;border-radius:50%;background:${member.isYou ? 'var(--social)' : 'var(--gold)'};display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-size:24px;color:#fff;font-weight:800">
                                ${member.name.charAt(0)}
                            </div>
                            <h3 style="margin:0 0 4px;color:${member.isYou ? 'var(--social)' : 'var(--gold)'}">
                                ${member.name}
                                ${member.isYou ? '<span style="font-size:12px;background:var(--social);color:#fff;padding:2px 6px;border-radius:8px;margin-left:8px">SİZ</span>' : ''}
                            </h3>
                            <div style="color:var(--tx2)">${member.role}</div>
                        </div>

                        <div style="margin-bottom:16px">
                            <div style="padding:12px;background:rgba(${member.isYou ? '236,72,153' : '201,168,106'},.1);border:1px solid ${member.isYou ? 'var(--social)' : 'var(--gold)'};border-radius:8px">
                                <div style="font-weight:700;color:${member.isYou ? 'var(--social)' : 'var(--gold)'};margin-bottom:4px">📍 Konum Bilgisi</div>
                                <div style="font-size:14px;margin-bottom:4px">${member.location}</div>
                                <div style="font-size:12px;color:var(--tx2)">Son güncelleme: ${this.formatLastSeen(member.lastSeen)}</div>
                            </div>
                        </div>

                        <div class="grid g2">
                            ${!member.isYou ? `
                                <button class="btn primary" onclick="socialManager.contactMember('${member.id}'); this.closest('.modal').remove();">
                                    <i class="fab fa-whatsapp" aria-hidden="true"></i> Mesaj
                                </button>
                                <button class="btn" onclick="utils.showToast('🗺️ ${member.name} konumuna yol tarifi açılıyor...', 'info'); this.closest('.modal').remove();">
                                    <i class="fa-solid fa-route" aria-hidden="true"></i> Yol
                                </button>
                            ` : `
                                <button class="btn primary" onclick="socialManager.refreshMap(); this.closest('.modal').remove();">
                                    <i class="fa-solid fa-refresh" aria-hidden="true"></i> Güncelle
                                </button>
                                <button class="btn" onclick="this.closest('.modal').remove()">Kapat</button>
                            `}
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            refreshMap() {
                utils.showToast('🗺️ Harita yenileniyor...', 'info');
                
                // Simulate refreshing member locations
                this.members.forEach(member => {
                    if (!member.isYou) {
                        member.lastSeen = new Date();
                        // Simulate location updates
                        const distances = ['120m', '250m', '340m', '580m', '1.2km'];
                        const distance = distances[Math.floor(Math.random() * distances.length)];
                        member.location = member.location.includes('-') 
                            ? member.location.split(' - ')[0] + ` - ${distance} uzakta`
                            : `${member.location} - ${distance} uzakta`;
                    }
                });
                
                setTimeout(() => {
                    this.updateMapMarkers();
                    this.updateLocationSummary();
                    this.renderMembers();
                    utils.showToast('✅ Harita güncellendi', 'success');
                }, 1500);
            },

            centerMap() {
                // Simulate centering map on user location
                utils.showToast('🎯 Harita konumunuza odaklandı', 'info');
                
                // Add visual feedback by pulsing user marker
                const userMarker = document.querySelector('#mapMarkers > div[style*="var(--social)"]');
                if (userMarker) {
                    userMarker.style.animation = 'pulseSelf 1s ease-out 3';
                }
            },

            async createGroup() {
                this.groupId = 'UHC-' + Math.random().toString(36).slice(2, 7).toUpperCase();
                
                // Update UI
                const statusEl = document.getElementById('socialGroupStatus');
                if (statusEl) {
                    statusEl.innerHTML = `
                        <div style="color:var(--social);font-weight:700;margin-bottom:4px">
                            <i class="fa-solid fa-users" aria-hidden="true"></i> Grup Aktif: ${this.groupId}
                        </div>
                        <div style="font-size:12px;color:var(--tx2)">
                            Davet kodu: <span style="font-weight:700;color:var(--tx)">${this.groupId}</span>
                        </div>
                    `;
                }

                // Show group members card
                const membersCard = document.getElementById('groupMembersCard');
                if (membersCard) {
                    membersCard.style.display = 'block';
                    this.addMember('Sen', 'Admin', true);
                }

                utils.showToast('✅ Grup başarıyla oluşturuldu', 'success');
                
                // Davet linkini paylaş
                setTimeout(() => {
                    shareManager.share('UHC Grup Daveti', 
                        `🕌 Umrah & Hac Companion grup davetiniz!\n\n` +
                        `Gruba katılmak için kodu kullanın: ${this.groupId}\n\n` +
                        `Güvenli konum paylaşımı ve acil durum desteği ile tur arkadaşlarınızla bağlı kalın.`
                    );
                }, 1000);
            },

            async joinGroup() {
                // Custom prompt modal
                this.showJoinGroupModal();
            },

            showJoinGroupModal() {
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:400px">
                        <h3 style="margin:0 0 16px;color:var(--social)">
                            <i class="fa-solid fa-sign-in-alt" aria-hidden="true"></i> Gruba Katıl
                        </h3>
                        <p style="color:var(--tx2);margin:0 0 16px">Grup davet kodunu girin:</p>
                        <input class="input" id="joinGroupInput" placeholder="UHC-XXXXX" style="margin-bottom:16px;text-transform:uppercase" maxlength="9">
                        <div class="grid g2">
                            <button class="btn primary" onclick="socialManager.processJoinGroup()">
                                <i class="fa-solid fa-sign-in-alt" aria-hidden="true"></i> Katıl
                            </button>
                            <button class="btn" onclick="this.closest('.modal').remove()">İptal</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Focus input
                setTimeout(() => {
                    const input = document.getElementById('joinGroupInput');
                    if (input) input.focus();
                }, 100);
            },

            processJoinGroup() {
                const input = document.getElementById('joinGroupInput');
                const code = input?.value.trim().toUpperCase();
                
                if (!code || !code.startsWith('UHC-') || code.length !== 9) {
                    utils.showToast('❌ Geçersiz grup kodu', 'error');
                    return;
                }

                this.groupId = code;
                
                // Update UI
                const statusEl = document.getElementById('socialGroupStatus');
                if (statusEl) {
                    statusEl.innerHTML = `
                        <div style="color:var(--social);font-weight:700;margin-bottom:4px">
                            <i class="fa-solid fa-users" aria-hidden="true"></i> Gruba Katıldınız: ${code}
                        </div>
                        <div style="font-size:12px;color:var(--tx2)">
                            Grup üyeleri ile konum paylaşımı aktif
                        </div>
                    `;
                }

                // Show group members
                const membersCard = document.getElementById('groupMembersCard');
                if (membersCard) {
                    membersCard.style.display = 'block';
                    this.loadGroupMembers();
                }

                // Close modal
                document.querySelector('.modal.show').remove();
                
                utils.showToast('✅ Gruba başarıyla katıldınız', 'success');
            },

            addMember(name, role, isYou = false) {
                this.members.push({
                    id: Math.random().toString(36).slice(2),
                    name: name,
                    role: role,
                    isYou: isYou,
                    lastSeen: new Date(),
                    location: isYou ? 'Konumunuz' : 'Konum paylaşıyor'
                });
                this.renderMembers();
            },

            loadGroupMembers() {
                // Simulate loading group members
                this.members = [
                    { id: '1', name: 'Sen', role: 'Üye', isYou: true, lastSeen: new Date(), location: 'Konumunuz' },
                    { id: '2', name: 'Ahmet Yılmaz', role: 'Üye', isYou: false, lastSeen: new Date(Date.now() - 60000), location: 'Harem - 150m uzakta' },
                    { id: '3', name: 'Fatma Demir', role: 'Üye', isYou: false, lastSeen: new Date(Date.now() - 300000), location: 'Mescid-i Nabevi - 2.5km uzakta' }
                ];
                this.renderMembers();
            },

            renderMembers() {
                const container = document.getElementById('groupMembersList');
                if (!container) return;

                container.innerHTML = this.members.map(member => `
                    <div style="display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:8px;background:${member.isYou ? 'rgba(236,72,153,.15)' : 'var(--card2)'};border:1px solid ${member.isYou ? 'var(--social)' : 'var(--border)'};border-radius:12px">
                        <div style="width:40px;height:40px;border-radius:50%;background:${member.isYou ? 'var(--social)' : 'var(--gold)'};display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800">
                            ${member.name.charAt(0)}
                        </div>
                        <div style="flex:1">
                            <div style="font-weight:700;color:${member.isYou ? 'var(--social)' : 'var(--tx)'};margin-bottom:2px">
                                ${member.name}
                                ${member.isYou ? '<span style="font-size:10px;background:var(--social);color:#fff;padding:2px 6px;border-radius:8px;margin-left:8px">SİZ</span>' : ''}
                            </div>
                            <div style="font-size:12px;color:var(--tx2);margin-bottom:2px">${member.location}</div>
                            <div style="font-size:11px;color:var(--tx2)">
                                Son görülme: ${this.formatLastSeen(member.lastSeen)}
                            </div>
                        </div>
                        ${!member.isYou ? `
                            <button class="btn" onclick="socialManager.contactMember('${member.id}')" style="padding:6px 8px;min-height:32px">
                                <i class="fab fa-whatsapp" style="color:#25D366" aria-hidden="true"></i>
                            </button>
                        ` : ''}
                    </div>
                `).join('');
            },

            formatLastSeen(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) return 'Şimdi';
                if (diffMins < 60) return `${diffMins} dakika önce`;
                const diffHours = Math.floor(diffMins / 60);
                if (diffHours < 24) return `${diffHours} saat önce`;
                return date.toLocaleDateString('tr-TR');
            },

            contactMember(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (member) {
                    socialActions.openWhatsApp(`🕌 Merhaba ${member.name}! UHC grubundan yazıyorum. Nasılsınız?`);
                }
            },

            async toggleLocationSharing() {
                if (!this.isLocationSharing) {
                    // Enable location sharing
                    const hasLocation = await locationService.requestLocation();
                    if (!hasLocation) return;
                    
                    this.isLocationSharing = true;
                    
                    // Update UI
                    const statusEl = document.getElementById('locationStatus');
                    const toggleEl = document.getElementById('locationToggle');
                    
                    if (statusEl) statusEl.textContent = 'Aktif';
                    if (toggleEl) {
                        toggleEl.innerHTML = '<i class="fa-solid fa-location-crosshairs" aria-hidden="true"></i> Kapat';
                        toggleEl.style.background = '#ef4444';
                        toggleEl.style.color = '#fff';
                    }
                    
                    utils.showToast('📍 Konum paylaşımı açıldı', 'success');
                    
                    // Start location updates
                    this.startLocationUpdates();
                    
                } else {
                    // Disable location sharing
                    this.isLocationSharing = false;
                    
                    // Update UI
                    const statusEl = document.getElementById('locationStatus');
                    const toggleEl = document.getElementById('locationToggle');
                    
                    if (statusEl) statusEl.textContent = 'Kapalı';
                    if (toggleEl) {
                        toggleEl.innerHTML = '<i class="fa-solid fa-location-crosshairs" aria-hidden="true"></i> Aç';
                        toggleEl.style.background = '';
                        toggleEl.style.color = '';
                    }
                    
                    utils.showToast('📍 Konum paylaşımı kapatıldı', 'info');
                    
                    this.stopLocationUpdates();
                }
            },

            startLocationUpdates() {
                // Update location every 30 seconds
                this.locationInterval = setInterval(() => {
                    if (this.isLocationSharing) {
                        // In real app, would send location to server
                        console.log('Location updated for group members');
                    }
                }, 30000);
            },

            stopLocationUpdates() {
                if (this.locationInterval) {
                    clearInterval(this.locationInterval);
                    this.locationInterval = null;
                }
            },

            async sendEmergencyAlert() {
                if (!this.groupId) {
                    utils.showToast('❌ Önce bir gruba katılın', 'warning');
                    return;
                }

                // Show confirmation
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:400px">
                        <h3 style="margin:0 0 16px;color:#ef4444">
                            <i class="fa-solid fa-exclamation-triangle" aria-hidden="true"></i> Acil Durum Bildirimi
                        </h3>
                        <p style="color:var(--tx2);margin:0 0 16px">
                            Bu bildirim tüm grup üyelerine gönderilecek ve otomatik olarak konum bilginiz paylaşılacak.
                        </p>
                        <div style="padding:12px;background:rgba(239,68,68,.1);border:1px solid #ef4444;border-radius:8px;margin-bottom:16px;color:#ef4444;font-weight:600;text-align:center">
                            ⚠️ Sadece gerçek acil durumlarda kullanın
                        </div>
                        <div class="grid g2">
                            <button class="btn" onclick="socialManager.confirmEmergencyAlert()" style="background:#ef4444;color:#fff;border:none">
                                <i class="fa-solid fa-sos" aria-hidden="true"></i> Gönder
                            </button>
                            <button class="btn" onclick="this.closest('.modal').remove()">İptal</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            async confirmEmergencyAlert() {
                // Close modal
                document.querySelector('.modal.show').remove();
                
                // Get current location
                const hasLocation = await locationService.requestLocation();
                const location = hasLocation ? `${appState.location.lat}, ${appState.location.lon}` : 'Konum alınamadı';
                
                // Send WhatsApp message to all group members
                const message = `🆘 ACİL DURUM UYARISI\n\nGrup: ${this.groupId}\nKişi: ${appState.user.name}\nZaman: ${new Date().toLocaleString('tr-TR')}\nKonum: ${location}\n\n⚠️ Yardıma ihtiyacım var!`;
                
                socialActions.openWhatsApp(message);
                
                utils.showToast('🚨 Acil durum bildirimi gönderildi', 'error');
                
                // Auto-enable location sharing
                if (!this.isLocationSharing) {
                    await this.toggleLocationSharing();
                }
            },

            callEmergency() {
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:400px">
                        <h3 style="margin:0 0 16px;color:#ef4444">
                            <i class="fa-solid fa-phone" aria-hidden="true"></i> Acil Çağrı
                        </h3>
                        <p style="color:var(--tx2);margin:0 0 16px">Bulunduğunuz ülkenin acil durum numarasını arayın:</p>
                        <div style="display:grid;gap:8px;margin-bottom:16px">
                            <button class="btn" onclick="window.open('tel:112')" style="background:#ef4444;color:#fff;border:none;justify-content:flex-start">
                                <div>
                                    <div style="font-weight:700">🇹🇷 Türkiye: 112</div>
                                    <div style="font-size:12px;opacity:0.8">Genel acil durum</div>
                                </div>
                            </button>
                            <button class="btn" onclick="window.open('tel:999')" style="justify-content:flex-start">
                                <div>
                                    <div style="font-weight:700">🇸🇦 Suudi Arabistan: 999</div>
                                    <div style="font-size:12px;color:var(--tx2)">Acil durum hattı</div>
                                </div>
                            </button>
                            <button class="btn" onclick="window.open('tel:+905551399811')" style="background:var(--gold);color:#000;border:none;justify-content:flex-start">
                                <div>
                                    <div style="font-weight:700">🕌 UHC Destek: +90 555 139 98 11</div>
                                    <div style="font-size:12px;opacity:0.8">7/24 tur desteği</div>
                                </div>
                            </button>
                        </div>
                        <button class="btn" onclick="this.closest('.modal').remove()" style="width:100%">Kapat</button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        };

        // Guide rental service
        const guideService = {
            guides: [
                {
                    id: 'mehmet-guide',
                    name: 'Mehmet Özkan',
                    experience: '15 yıl deneyim',
                    languages: ['Türkçe', 'Arapça', 'İngilizce'],
                    specialty: 'Hac & Umre Rehberliği',
                    rating: 4.9,
                    price: '2.500₺/gün',
                    image: '👨‍🏫',
                    available: true,
                    description: 'Lisanslı rehber, 50+ başarılı tur'
                },
                {
                    id: 'fatma-guide',
                    name: 'Fatma Yıldırım',
                    experience: '12 yıl deneyim',
                    languages: ['Türkçe', 'Arapça'],
                    specialty: 'Kadın Grup Rehberliği',
                    rating: 4.8,
                    price: '2.200₺/gün',
                    image: '👩‍🏫',
                    available: true,
                    description: 'Kadın grupları için özel rehberlik'
                },
                {
                    id: 'ahmed-guide',
                    name: 'Ahmed Al-Rashid',
                    experience: '20 yıl deneyim',
                    languages: ['Arapça', 'Türkçe', 'İngilizce', 'Urduca'],
                    specialty: 'Mekke-Medine Özel Turları',
                    rating: 5.0,
                    price: '3.500₺/gün',
                    image: '🧔',
                    available: false,
                    description: 'Premium rehberlik hizmeti'
                }
            ],

            renderGuides() {
                const container = document.getElementById('guidesList');
                if (!container) return;

                container.innerHTML = this.guides.map(guide => `
                    <div class="card" style="margin-bottom:16px;${!guide.available ? 'opacity:0.7' : ''}">
                        <div style="display:flex;gap:16px;margin-bottom:12px">
                            <div style="width:60px;height:60px;border-radius:50%;background:var(--card2);display:flex;align-items:center;justify-content:center;font-size:24px;border:2px solid var(--gold)">
                                ${guide.image}
                            </div>
                            <div style="flex:1">
                                <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:4px">
                                    <h4 style="margin:0;color:var(--gold)">${guide.name}</h4>
                                    <div class="badge" style="${guide.available ? 'background:rgba(34,197,94,.15);color:#22c55e;border-color:#22c55e' : 'background:rgba(239,68,68,.15);color:#ef4444;border-color:#ef4444'}">
                                        ${guide.available ? 'Müsait' : 'Meşgul'}
                                    </div>
                                </div>
                                <div style="font-size:13px;color:var(--tx2);margin-bottom:4px">${guide.experience} • ${guide.specialty}</div>
                                <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
                                    <div style="display:flex;align-items:center;gap:2px">
                                        <span style="color:var(--gold)">★</span>
                                        <span style="font-size:12px;font-weight:700">${guide.rating}</span>
                                    </div>
                                    <div style="font-weight:700;color:var(--gold)">${guide.price}</div>
                                </div>
                                <div style="font-size:12px;color:var(--tx2)">${guide.languages.join(', ')}</div>
                            </div>
                        </div>
                        
                        <div style="padding:12px;background:rgba(201,168,106,.1);border:1px solid var(--gold);border-radius:8px;margin-bottom:12px">
                            <div style="font-size:13px;color:var(--tx2)">${guide.description}</div>
                        </div>
                        
                        <div class="grid g2">
                            <button class="btn ${guide.available ? 'primary' : ''}" 
                                    onclick="guideService.contactGuide('${guide.id}')"
                                    ${!guide.available ? 'disabled style="opacity:0.5"' : ''}>
                                <i class="fab fa-whatsapp" aria-hidden="true"></i> 
                                ${guide.available ? 'İletişim' : 'Müsait Değil'}
                            </button>
                            <button class="btn" onclick="guideService.showGuideDetails('${guide.id}')">
                                <i class="fa-solid fa-info-circle" aria-hidden="true"></i> Detaylar
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            contactGuide(guideId) {
                const guide = this.guides.find(g => g.id === guideId);
                if (!guide || !guide.available) return;

                const message = `🕌 Merhaba ${guide.name}!\n\nUmrah & Hac Companion uygulaması üzerinden yazıyorum.\n\n` +
                    `Rehberlik hizmetiniz hakkında bilgi almak istiyorum:\n` +
                    `• ${guide.specialty}\n` +
                    `• ${guide.price}\n\n` +
                    `Müsaitlik durumunuz nedir?`;

                socialActions.openWhatsApp(message);
            },

            showGuideDetails(guideId) {
                const guide = this.guides.find(g => g.id === guideId);
                if (!guide) return;

                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:450px">
                        <div style="text-align:center;margin-bottom:20px">
                            <div style="width:80px;height:80px;border-radius:50%;background:var(--gold);display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-size:36px;color:#000">
                                ${guide.image}
                            </div>
                            <h3 style="margin:0 0 4px;color:var(--gold)">${guide.name}</h3>
                            <div style="color:var(--tx2)">${guide.experience} • ${guide.specialty}</div>
                        </div>

                        <div style="margin-bottom:16px">
                            <div style="display:flex;justify-content:space-between;margin-bottom:12px">
                                <span style="color:var(--tx2)">Derecelendirme:</span>
                                <div style="display:flex;align-items:center;gap:4px">
                                    <span style="color:var(--gold)">★</span>
                                    <span style="font-weight:700">${guide.rating}/5.0</span>
                                </div>
                            </div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:12px">
                                <span style="color:var(--tx2)">Günlük Ücret:</span>
                                <span style="font-weight:700;color:var(--gold)">${guide.price}</span>
                            </div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:12px">
                                <span style="color:var(--tx2)">Durum:</span>
                                <span style="color:${guide.available ? '#22c55e' : '#ef4444'};font-weight:700">
                                    ${guide.available ? '✅ Müsait' : '❌ Meşgul'}
                                </span>
                            </div>
                        </div>

                        <div style="margin-bottom:16px">
                            <div style="font-weight:700;margin-bottom:8px">🌍 Konuştuğu Diller:</div>
                            <div style="display:flex;gap:6px;flex-wrap:wrap">
                                ${guide.languages.map(lang => `
                                    <span style="background:var(--card2);padding:4px 8px;border-radius:12px;font-size:12px;border:1px solid var(--border)">${lang}</span>
                                `).join('')}
                            </div>
                        </div>

                        <div style="padding:12px;background:rgba(201,168,106,.1);border:1px solid var(--gold);border-radius:12px;margin-bottom:16px">
                            <div style="font-weight:700;color:var(--gold);margin-bottom:4px">📋 Hizmetler:</div>
                            <div style="font-size:13px;color:var(--tx2);line-height:1.4">
                                • Manasik rehberliği ve eğitim<br>
                                • Ziyaret noktaları hakkında bilgi<br>
                                • Dua ve zikir eşliği<br>
                                • Alışveriş rehberliği<br>
                                • 7/24 destek hattı<br>
                                • Acil durum yardımı
                            </div>
                        </div>

                        <div class="grid g2">
                            <button class="btn primary" onclick="guideService.contactGuide('${guide.id}'); this.closest('.modal').remove();"
                                    ${!guide.available ? 'disabled style="opacity:0.5"' : ''}>
                                <i class="fab fa-whatsapp" aria-hidden="true"></i> İletişim
                            </button>
                            <button class="btn" onclick="this.closest('.modal').remove()">Kapat</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        };

        // Load guides when DOM is ready and initialize guide rendering
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize guides on page load
            if (typeof guideService !== 'undefined') {
                setTimeout(() => {
                    guideService.renderGuides();
                }, 500);
            }
        });

        // Also initialize when social view is accessed
        const originalOnViewChange = appNavigation.onViewChange;
        appNavigation.onViewChange = function(viewId) {
            originalOnViewChange.call(this, viewId);
            if (viewId === 'social' && typeof guideService !== 'undefined') {
                setTimeout(() => {
                    guideService.renderGuides();
                }, 100);
            }
        };

        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            utils.showToast('❌ Beklenmeyen bir hata oluştu', 'error');
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            utils.showToast('❌ Ağ hatası oluştu', 'warning');
            event.preventDefault();
        });

    </script>
</body>
</html>